[REF_hajime]章で述べたように整合性とは意味的な文書のまとまりの良さのことであり，これを実現するためには適切に話題間の繋がりを扱うことが重要であると考える．
ここで話題とは同じ対象について述べている一つのまとまりのことである．
物語では時間の経過や舞台となる場所の移動によって区切られる場面という大きなまとまりが考えられるが，本稿では話題を場面よりも小さな単位と捉え，一つの場面は複数の話題から構成されていると考える．
本稿で提案する手法の流れを図[REF_flow]に示す．
提案手法は要約生成のための3つの手順と，その手順において利用する人物辞書を構築するための登場人物抽出で構成される．
登場人物抽出では人物辞書の他に未知語として出現した登場人物表現を登録した形態素辞書を作成する．
この形態素辞書は要約生成の各手順で行う処理に利用する．
要約生成に関する手順について説明する．
まず一つ目は物語中にいくつか存在する場面内において話題が一貫した箇所（以降トピック・ブロックと呼ぶ）があると仮定して，トピック・ブロック抽出を行う．
文を単位とする既存の要約手法では文間の関係が考慮されず，そのために一連の事象が複数の文に渡って記述されている場合に正しく要約を抽出することができない．
よってトピック・ブロックの導入により話題が一貫した単位を要約の最小単位として，不用意に話題を切断しないことが期待できる．
二つ目としてトピック・ブロックから要約に必要となる重要なトピック・ブロック（以降重要ブロックと呼ぶ）を選択するために，登場人物辞書を用いて登場人物を軸とした重要度を提案する．
これは登場人物が物語のストーリーの理解に重要な要素である[CITE]という観点から，トピック・ブロック中に登場人物の活動が記述されている文があるものを重要とする．
三つ目として重要箇所として取り出されたトピック・ブロック間の話題の整合性を補完するための文（以降ブロック連結文と呼ぶ）を抽出する．
これは重要箇所の抽出というタスクは取り出した文の整合性やまとまりを求めるというタスクと直交していることが原因であり，重要ブロックのみを取り出しても，ブロック間に不整合が生じるためである．
この処理は文を単位として行う．
これは不整合の解消には場面の切り替えや主人公の移動などの話題間の繋がりを示唆する文が物語には存在するはずで，それらは大抵1文単位で記述されていることが期待できるからである（図[REF_segments]）．
生成する要約の要約率と重要ブロックとブロック連結文の割合はパラメータとして人手で設定する．
重要ブロックの割合を大きくすれば物語に重要な文を多く含む要約を生成し，逆にブロック連結文の割合を大きくすれば，整合性のある要約を生成する．
次の[REF_extract]節で登場人物抽出について述べた後，[REF_topic]節でトピック・ブロック抽出について述べる．
[REF_select]節で重要ブロック抽出について説明し，[REF_connectsentence]節でブロック連結文の抽出について説明する．
登場人物を抽出するというタスクにおける問題は以下の2点である．
登場人物はその物語に固有の表現であるものが多く，それらは単語として一般的な辞書に登録されていない．
(a)と関連しているが『さるかに合戦』に登場する``うす''のように人名でないものが人物化することがある．
従って，登場人物の抽出に際して人名辞書などの既存の辞書に頼った方法では抽出漏れが生じてしまう．
そこで本研究では物語文から次の2段階の手法で登場人物を推定する．
文字列中から登場人物候補を文字種情報と形態素情報を利用して獲得し，辞書登録を行う．
登録した辞書を用いた係り受け解析器で文を解析し，登場人物候補の単語の係り先の動詞の意味から人物表現を同定する．
馬場ら[CITE]は形態素解析で得られた品詞情報を利用した人物抽出の手法を採用している．
また網羅性の向上のために人名辞典から人名を収集し形態素辞書に登録している．
この手法は対象とする物語のジャンルを限定すれば有効である．
これに対して本研究では対象のジャンルを限定しない．
そのため，辞書を利用した手法ではなく，物語における登場人物表現の出現の仕方に着目した手法を提案する．
上記の2段階の手法について具体的に記述する．
まず物語文から登場人物候補を取り出すために文字n-gramを利用して頻度の高い部分文字列を獲得する．
n-gramの単位を形態素ではなく文字にしている理由は，登場人物表現が辞書に登録されていないために生じる形態素解析誤りの影響を抑えるためである．
これによって例えば『さるかに合戦』で``〜とこがには〜''などの表記から``こがに''という正しい候補を獲得することができる．
次に，得られた部分文字列に対してMeCabによる形態素解析を行ってから，以下のフィルタリングを行い残ったものを登場人物候補としてMeCabの辞書に登録する．
平仮名，カタカナの小文字から始まっていない
句読点，カギ括弧，``！''，``？''を含まない
文字列中に接続詞，連体詞，代名詞を含まない
複数の形態素で構成されている
文章中に``は''を接続した形で出現する
上記のルールにより，単語としてあり得ない文字列や，例えば``そして杜子春''，``杜子春は''などのように人物表現の周辺でよく使われる表現を含んだ文字列を人物候補から削除できる．
フィルタリングで残った候補に対して，同頻度で出現したn-gram文字列で他の文字列の部分文字列であるような候補は削除し，残った候補をMeCabの辞書に``名詞，固有名詞，一般''として追加する．
これにより既に形態素辞書に登録されてある人物候補と同様に物語固有の人物表現を扱うことができる．
ここで作成した形態素辞書は以降で説明する要約生成に関する処理にも利用する．
ここで登場人物が現れる際の文の特徴について考える．
登場人物は物語において重要な役割を担っているため，主題として取り上げられることが多い[CITE]．
また，登場人物は意志を持つものであるため，意志性のある動作を記述している文の動作主として現れることが多い．
意志性のある動作とはその動作の実現に対して動作主が能動的に関与しているとみなせる動作のことである．
この傾向を利用して，文中の名詞が登場人物として出現しているかどうかを推定する．
具体的には物語の地の文に対して，更新した辞書を用いたCaboChaによる係り受け解析を行い，主題化する機能を持つ副助詞``は''を後接して複数回出現する名詞で，その文の述部となる動詞に一つでも意志性のある動作を示すものがあれば，その名詞を登場人物と推定する．
意志性のある動作を示す動詞の判定には日本語和語動詞LCS [CITE]を利用した．
これは日本語和語動詞を中心に約1000個の動詞に関してその語彙概念構造を記述を試みたものであり，実際にLCSが付与されている延べ742項目の動詞を利用した．
『風の又三郎』に対する人物抽出の例を付録[REF_humanexample]に示す．
人物抽出の精度を計るために[REF_eval]章の評価実験で用いた物語9編を使用した予備実験を行った．
複数の被験者に登場人物を列挙してもらい，そのうち過半数の被験者が登場人物と認定したものを正解とした．
部分文字列を獲得する際のnの範囲は2〜10とし，出現頻度が2以上の部分文字列のみを対象とした．
実験の結果，平均の再現率は0.74，適合率は0.68となった．
人手で作成した正解の例と実験の詳細な結果を付録[REF_humexp]に示す．
物語文に対して話題がある程度まとまった範囲で出現する部分を仮定しトピック・ブロックとして抽出する．
ある文書の話題は何か，そしてその話題の切れ目はどこかという課題は大変難しい問題であり，例えば単語の共起と単語の重要度を利用した手法[CITE]や，語の反復距離を使用した手法[CITE]などが提案されているが決定的な手法はまだ確立していない．
本稿では作者が記した1文の表現に着目し，1文単位の主題を仮定してそれが連続する文をまとめることでトピック・ブロックを作成する．
厳密な連続でトピック・ブロックを作成すると，小さなトピック・ブロックが多く作られ，本来は1つのまとまりであるべき箇所が過分割される可能性がある．
これを防ぐため，ウィンドウ幅を設定し，その中での連続を見る．
本稿ではこのウィンドウ幅を前2文とした．
従って，別の主題の文を間に挟んで同じ主題を持つ文は同じトピック・ブロックに属する．
1文の主題とは文中に出てきた単語で表現するならば主語が有力な候補であり，特に副助詞``は''は主語を取り上げて主題化する機能を有している．
そこで副助詞``は''が後接する名詞を1文の主題と見なし，ない場合は助詞``が''が後接する名詞を主題とする．
ただし，``今日は''，``このごろは''など``は''と接続して副詞的な働きを持つ名詞は主題とは考えにくいので，MeCabを利用して副詞可能となる名詞は排除する．
また，主題は省略されやすく，同じ主題が連続する場合は後に続く文において明示的に現れないことが多い[CITE]．
従って，文中に助詞``は''と``が''がない場合は，それが省略されているとみなし前文における主題をその文の主題とする．
助詞``は''，``が''を後接している名詞が代名詞の場合，センタリング理論に基づいた単純な照応解析を行う[CITE]．
具体的には代名詞が出現した文の1つ前の文に出現する名詞を先行詞候補とし，その候補が接続する助詞について以下の優先順に従って先行詞を決定する．
\makeatletter  \makeatother
は＞が＞に＞を＞その他
具体例を『杜子春』（芥川龍之介）の一部から示す．
{するとどこからやって来たか、突然彼の前へ足を止めた、片目眇の老人があります。
それが夕日の光を浴びて、大きな影を門へ落すと、じっと杜子春の顔を見ながら、「お前は何を考えているのだ」と、横柄に声をかけました。
}
2文目にある代名詞``それ''の先行詞の候補として1文目から下線部の5個の名詞が挙げられる．
このうち上記の優先順から助詞``は''を後接している``老人''を``それ''の先行詞とみなす．
センタリング理論に基づいた照応解析の精度を計るため，本稿の評価実験で用いた物語9編を対象に予備実験を行った．
助詞``は''，``が''を後接する代名詞に対して出力された先行詞を人手で正否を判定した．
実験の結果，照応解析の平均の精度は0.41(134/330)であった．
1文ごとの主題を抽出した後，設定した幅のウィンドウの中で連続した主題の文をまとめることでトピック・ブロックを作成する．
このときウィンドウ幅内で全く同じ主題が連続した文だけでなく，同じ主題に挟まれた文も同一のトピック・ブロックに含める．
これは1文ごとの主題は主語を手がかりに獲得しているが，話の展開においては連続しない場合があるためである．
上記の操作はすべて会話文は考慮せず，いわゆる地の文のみを対象とする．
このとき会話文は直前の地の文と同じトピック・ブロックに属することとする．
これは会話の途中で話題が転換することはほとんどないと考えられるからである．
例えば，『赤ずきんちゃん』（グリム兄弟）において以下に示す部分では途中でおばあさんの台詞が入っているが，おおかみを中心に話が展開している．
従って，この部分をひとまとまりのトピック・ブロックとみなす．
{ところが、このあいだに、すきをねらって、おおかみ（主題）は、すたこらすたこら、おばあさんのおうちへかけていきました。
そして、とんとん、戸をたたきました。
「おや、どなた。
」
「赤ずきんちゃんよ。
お菓子とぶどう酒を、おみまいにもって来たのよ。
あけてちょうだい。
」
「とっ手をおしておくれ。
おばあさんはご病気でよわっていて、おきられないのだよ。
」
おおかみ（主題）は、とっ手をおしました。
}
さらに1文が多重のトピック・ブロックに所属することを認める．
具体的にはある文[MATH]に対してその文からウィンドウ幅分だけ前の文のトピック・ブロック中で主題が同じ文が存在すれば，その文が属するトピック・ブロックに[MATH]も属するとする．
同時にその文と[MATH]間の文も同じトピック・ブロックに属する．
これは，ある文が示す主題には助詞``は''や``が''によって明示的に示されるものと文脈から推定できるものの2種類が考えられ，その文はそれぞれの主題で構成される話題の一部分とみなせると考えるからである．
ウィンドウ内に主題が同じ文がなければその文を新しいトピック・ブロックに加える．
例をあげて説明する．
文[MATH]から[MATH]があり，その主題が表[REF_example]のようであったとき，ここから抽出されるトピック・ブロックは図[REF_tbexample]のようになる．
文[MATH]，[MATH]は前に同じ主題を持つ文が存在しないためそれぞれ新しいトピック・ブロックに割り当てる．
文[MATH]はウィンドウ幅内に同じ主題を持つ文[MATH]が存在するため，その文が属するトピック・ブロック[MATH]に加える．
さらにその間にある文[MATH]も[MATH]に加える．
一方，文[MATH]は文[MATH]と同じ主題を持つが，[MATH]がウィンドウ幅内にないので新しいトピック・ブロックに属することになる．
抽出したトピック・ブロックについて物語におけるストーリーへの関与度を評価し，関与しているものが高いものを重要ブロックとして要約に採用する．
手法としてはまず重要度の評価尺度を導入し（[REF_importance]節参照），次に物語の構成や接続詞情報を考慮して重要ブロックの抽出を行う（[REF_extracttb]節参照）．
物語においては，登場人物が行動を起こし，それによって状況が変化するような箇所が重要であると考えられる．
これに基づいてトピック・ブロックの重要度を定義する．
まずトピック・ブロック内の各文のスコア付けについて説明し，その後ブロック全体の重要度を求める．
トピック・ブロック内を構成する文に対して，登場人物や動作主の変化に関する動詞が含まれている場合は評価が高くなるようにスコア付けを行う．
具体的には以下の式で決定する．
[MATH]は文[MATH]に対するスコアであり，[MATH]は[MATH]中に出現する単語である．
[MATH]は単語[MATH]の文書全体における重要度を示しており，[MATH]が登場人物である場合にその頻度を重要度とする．
[MATH]は単語[MATH]の文[MATH]における主題性に基づく重みである．
[MATH]は文[MATH]の述部における動詞に着目して，動作主体が変化を伴うような動詞であれば重要度を高くするように設定する．
この判定には竹内ら[CITE]の語彙概念構造辞書を利用する．
この辞書では``主体の変化''という分類があり，例えば``寝る''，``振り向く''といった動詞が分類されている．
トピック・ブロック[MATH]の重要度[MATH]は上記で決めた文の重要度を利用して以下の式で求める．
ここで[MATH]は[MATH]中の文の数である．
これにより正規化することで長さに依存しないスコアとなる．
トピック・ブロックに対して求めた重要度に基づいて重要ブロックを決定する．
基本的には要約率を満たすまで重要度の高いトピック・ブロックから選んでいくが，その前にどのような物語でも比較的重要と考えられるトピック・ブロックを重要ブロックとして選ぶ．
物語では，登場人物表現が最初に出現する文はその登場人物の説明であることが多く，登場人物表現が最後に出現する文はその登場人物の最終状況を説明している文であることが多い．
そこで，重要度の高いものからトピック・ブロックを選択する前に，登場人物表現が最初に出現するトピック・ブロックと最後に出現するトピック・ブロックを重要ブロックとして抽出し，残りのトピック・ブロックに対して重要度の上位から順に要約率分だけ抽出する．
物語のあらすじにとって関与が低い要素を省くために，抽出した重要ブロックに対して文の連接関係に着目した要約を行う．
ここで不必要な要素とは同じことを繰り返して述べていたり，補足説明をしている要素のことである．
連接関係の推定には接続詞と文末表現を利用する．
接続関係の分類は永野[CITE]による7種類の関係（表[REF_connect]）を利用した．
具体的な手法について述べる．
あらかじめ接続詞と文末表現のそれぞれに対して，それが示す連接関係との対応を作成しておく．
一部の関係について対応の例を表[REF_conexample]に示す．
隣接する2文に対して，後文に出現する接続詞と文末表現から作成した対応を利用し連接関係を推定する．
後文に連接関係の推定に使用する接続詞や文末表現がなかった場合は2文間の連接関係は``展開''とする．
推定した連接関係が``補足''，``同格''と判定されたものについて，その後文を削除する．
隣接する重要ブロック間での整合性を保つために，その間において生じた状況の変化を示すような文を挿入する．
状況の変化とは時間経過や場所移動による場面転換や，登場人物の心境や取り巻く環境の変化などのことである．
物語中でこのような状況の変化が起こったとき，それを示すような文がなければ読者はそれに気付かず，読み進めていくにつれて違和感を覚えたり，物語本文を読んだときに得られる理解と異なる理解をする可能性がある．
このような状況の変化を示す文をブロック連結文と呼び，要約に挿入することで重要ブロック間の整合性を損なわないようにする．
本稿では重要ブロックと原文においてその間に存在するトピック・ブロックでの登場人物表現の出現を基にした局所的な重要度を定義し，これを利用してブロック連結文を抽出する．
隣接する重要ブロックにおいて片方に出現し，且つ，もう片方には出現していないような登場人物があれば，その登場人物は重要ブロック間の状況の変化に関わっていると考えられる．
そのような登場人物について記述してある文をブロック連結文として抽出するために，隣接する重要ブロック間での出現の仕方によって登場人物の局所的な重要度を決定し，それを基にして重要ブロック間における文の重要度を決定する．
隣接する重要ブロック[MATH]，[MATH]に対して，この間における登場人物[MATH]の局所的重要度を以下の式で求める．
[MATH]は文[MATH]における登場人物表現[MATH]の出現頻度であり，[MATH]は単語[MATH]がセグメントの連結に対する有効性を表す重みである．
[MATH]と[MATH]間の文の集合を[MATH]とする．
この単語の重要度と[REF_importance]節で利用した動詞の意味分類を用いて，重要ブロック[MATH]，[MATH]間の文[MATH]の局所的重要度[MATH]を以下のように定める．
[MATH]は重要ブロックの決定で用いた動詞の意味による重みである．
これは動詞の意味分類において動作主体の変化を表す動詞として分類されているものであり，これらの動詞が出現した文には重要ブロック間で起きた状況の変化が記述されてある可能性が高いためスコアを少し上げる．
局所的な重要度に基づいて抽出するブロック連結文を決定する．
要約として抽出した隣接する重要ブロック[MATH]，[MATH]について，その間にある文の局所的重要度を上記の式[MATH]によって計算し，下記に示すブロック連結文の量[MATH]以下で[MATH]の高いものから順にブロック連結文として抽出する．
ブロック連結文は要約として抽出された重要ブロックに属していない文から選択する．
生成する要約の要約率[MATH]とする．
要約率は原文書の文字数に対する要約文書の文字数の割合で与えられ，以下の式から求める．
要約における重要ブロックの割合を[MATH]とすると，隣接する重要ブロック[MATH]，[MATH]間の文集合[MATH]に対して取り出すべき文の量[MATH]は以下のようになる．
ここで[MATH]は[MATH]に属する文の量である．
割合[MATH]を大きくすると限られた要約率の中で重要ブロックを多く抽出することを意味し，反対に[MATH]を小さくすると整合性を重視して連結文を多く取り出すことを意味する．
本手法によって生成した要約中に出現するブロック連結文の例を図[REF_conrei]に示す．
下線部が抽出したブロック連結文であり，その前後は要約として抽出した重要ブロックの一部である．
図[REF_conrei]に示すように“郊外の家へ帰ろうと思った。
”という部分から主人公の龍介が“通りを出た。
”までに汽車に乗り損ねたことが推論できる内容が補完されている．
