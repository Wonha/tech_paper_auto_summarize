ダイアログナビの構成 \label{sec:ダイアログナビの構成}


ダイアログナビにおいて使用するリソースを以下に示す．

\begin{table}
 \caption{ダイアログナビで用いるテキスト知識ベース}
 \label{tab:text_collection}
 \begin{center} \footnotesize
  \begin{tabular}{c|rrl} \hline
   知識ベース & \multicolumn{1}{c}{件数} &
   \multicolumn{1}{c}{文字数} & \multicolumn{1}{c}{マッチング対象} \\ \hline
   用語集           & 4,707  & 700,000    & 見出し(1文) \\
   ヘルプ集         & 11,306 & 6,000,000  & タイトル(1文) \\
   サポート技術情報 & 23,323 & 22,000,000 & 文書全体(複数文) \\ \hline
  \end{tabular}
 \end{center}
\end{table}

\begin{figure}
  \begin{center}
   \tiny
   \begin{tabular}{|p{12cm}|} \hline
    \\
    {\small\bf 音声認識ソフトウェアがインストールされた環境でページ違反が発生する} \\
    \\
    最終更新日: 1999/08/18 \\
    文書番号: J049655 \\
    \\
    この資料は以下の製品について記述したものです。
    \begin{itemize}

     \item Microsoft(R) Internet Explorer Version 5 (以下 Internet Explorer 5)
     \item Microsoft(R) Windows 98 (以下 Windows 98)
    \end{itemize}
    \\
    {\bf 概要} \\
    この資料は、Windows 98 上に Internet Explorer 5 がインストール
    された環境で、音声認識ソフトウェアが起動されていると、Internet Explorer
    5 を起動した際に、ページ違反が発生する現象について説明したものです。 \\
    \\
    {\bf 内容} \\
    以下の条件を満たすときに Internet Explorer 5 を起動すると、ユー
    ザー補助プログラムの OLEACC.DLL が不正なメモリ領域を参照することにより、
    ページ違反が発生する場合があります。
    \begin{itemize}
     \item Windows 98 にユーザー補助プログラムがインストールされている
     \item 音声認識ソフトウェアが起動している
    \end{itemize}
    \\
    {\bf 回避方法} \\
    Windows 98 システムアップデートモジュールをインストールします。
    システムアップデートモジュールには、新しい OLEACC.DLL が含まれており、こ
    の不具合が修正されていることを確認しております。これは Windows 98
    Service Pack 1 に含まれるモジュールとなっており、Windows Update からダウ
    ンロードすることができます。 \\
    \\
    {\bf 入手方法}
    \begin{enumerate}
     \item \ [スタート]メニューから[Windows Update]をクリックします。
     \item 画面の指示に従い "Windows Update へようこそ" が表示されたら、"製
	   品の更新" をクリックします。
     \item "ソフトウェアの選択" 画面にて、"Windows 98 System Update" にチェッ
	   クをつけ、 " ダウンロード" ボタンを押します。
     \item 画面の指示に従い、モジュールをインストールします。
    \end{enumerate}
    \\
    \hline
   \end{tabular}
   \caption{マイクロソフト・サポート技術情報の例}
   \label{fig:マイクロソフト・サポート技術情報の例}
  \end{center}
\end{figure}



\begin{itemize}
 \item {\bf 知識ベース}

       マイクロソフトがすでに一般に公開しているテキスト知識ベースをその
       まま用いる．その種類と規模を表\ref{tab:text_collection} に示す．
       また，知識ベースのうちサポート技術情報に含まれるテキストの例を図
       \ref{fig:マイクロソフト・サポート技術情報の例} に示す．

 \item {\bf 同義表現辞書}(\ref{subsubsec:同義表現辞書}項，図\ref{fig:同義表現辞書})

       ユーザ質問文と知識ベースの間の表現のずれを吸収するために，同義語
       や同義フレーズをグループ化した辞書を用いる．現在，ダイアログナビ
       の同義表現辞書には，919グループの同義表現が存在し，3512語・217フ
       レーズが登録されている．

\begin{figure}
 \begin{center}
  \footnotesize
  \begin{tabular}{|c@{}p{10cm}|} \hline
   \multicolumn{2}{|l|}{[発生する]} \\
   \hspace{5mm} & 発生する，起きる，おきる，起こる，おこる \\
   \multicolumn{2}{|l|}{[読む]} \\
   \hspace{5mm} & 読む，よむ，読める，よめる，読み込む，よみこむ，読み込める，よみこめる \\
   \multicolumn{2}{|l|}{[メール]} \\
   \hspace{5mm} & メール，メイル，電子メール，電子メイル，Mail，E-Mail \\
   \multicolumn{2}{|l|}{[メールを読む]} \\
   \hspace{5mm} & メールを読む，メールを受信する，メールを見る，メールを受ける，メッ
   セージを受信する，メッセージを受ける \\
   \multicolumn{2}{|l|}{[パソコンを起動する]} \\
   \hspace{5mm} & パソコンを起動する，Windowsを起動する，電源を入れる，電源をオン
   する，ブートする，パソコンを立ち上げる，スイッチを入れる \\
   \hline
  \end{tabular}

  \caption{同義表現辞書の例} \label{fig:同義表現辞書}
 \end{center}
\end{figure}

 \item {\bf 上位・下位語辞書}(\ref{subsubsec:上位・下位語辞書}項，図\ref{fig:
       上位下位関係})

       上位・下位の関係にある語(「ブラウザ」と「Internet Explorer」など) 
       を関係づけた辞書を用いる．現在，200語が登録されている．

\begin{figure}
 \begin{center}
\epsfile{file=fig/jouikai.eps,scale=0.75}
  \caption{上位・下位語辞書の例}
 \label{fig:上位下位関係}
 \end{center}
\end{figure}

 \item {\bf 対話カード}(\ref{subsec:対話カードを用いた聞き返し}節，図\ref{fig:
       対話カードの例})

       曖昧なユーザ質問文のうち典型的なものに対して，どのような聞き返し
       を行うかを記述したカードを利用する．

\begin{figure}[t]
 \begin{center}
  \footnotesize
   \begin{tabular}{|p{12cm}|}
    \hline
    {\tt $<$CARD$>$} \\
    {\tt $<$ID$>$}エラー \\
    {\tt $<$UQ$>$}エラーが発生する \\
    {\tt $<$REPLY$>$}エラーはいつ発生しますか？ \\
    {\tt $<$SEL action=CARD card\_id={\rm ``エラー/Windows起動中''}$>$} Windows起動中 \\
    {\tt $<$SEL action=CARD card\_id={\rm ``エラー/ログイン時''}$>$} ログイン時 \\
    {\tt $<$SEL action=CARD card\_id={\rm ``エラー/印刷時''}$>$} 印刷中 \\
    $\cdots$ \\
    {\tt $<$/CARD$>$} \\
    \\
    \hline
    \multicolumn{1}{c}{}\\
    \hline
    {\tt $<$CARD$>$} \\
    {\tt $<$ID$>$}エラー/Windows起動中 \\
    {\tt $<$UQ$>$}Windowsの起動中にエラーが発生する \\
    {\tt $<$REPLY$>$}あなたがお使いのWindowsを選んでください． \\
    {\tt $<$SEL action=RET phrase={\rm ``Windows 95の起動中にエラーが発生する''}$>$} Windows 95 \\
    {\tt $<$SEL action=RET phrase={\rm ``Windows 98の起動中にエラーが発生する''}$>$} Windows 98 \\
    $\cdots$ \\
    {\tt $<$SEL action=RET phrase={\rm ``Windows XPの起動中にエラーが発生する''}$>$} Windows XP \\
    {\tt $<$/CARD$>$} \\
    \\
    \hline
   \end{tabular}
  \caption{対話カードの例} \label{fig:対話カードの例}
 \end{center}
\end{figure}



\end{itemize}


ダイアログナビの内部の処理と，ユーザとの対話の関係を図
\ref{fig:architecture}に示す．基本的な流れは，対話カードに基づくユーザと
の対話によってユーザの質問が具体化され(図\ref{fig:architecture}の左側の
ループ)，具体化された質問によって知識ベースが検索され(右側の処理へ移行)，
検索結果が自動編集され選択肢の形でユーザに提示される．ユーザの最初の質問
が具体的な場合は，対話カードとはマッチせずに右側の処理へ移行し，はじめか
ら知識ベースの検索結果が提示される．

図\ref{fig:architecture}中の各モジュールの働きは以下の通りである(詳細は
次節以降に示す)．

\begin{itemize}
 \item {\bf 入力解析モジュール}

       質問文を3種類の質問タイプ(Symptom型，How型，What型)に分類し，質問
       文の内容表現を抽出する．さらに，構文解析，キーワードと同義表現の
       抽出などを行う．

 \item {\bf テキスト検索モジュール}

       対話カードおよび知識ベース(以下，これらを総称して{\bf テキスト}と
       いう)とユーザ質問文のマッチングを行い，スコアの高いテキストを返す．
       マッチングの際には，同義表現辞書，上位・下位語辞書を用いて表現の
       ずれを吸収する．

 \item {\bf 状況説明文抽出モジュール}

       知識ベース中のユーザ質問文とマッチした文の，マッチした部分の周囲
       を抽出することによって，ユーザにとって簡潔でわかりやすい選択肢を
       提示する．

\end{itemize}


\begin{figure}
 \begin{center}
\epsfile{file=fig/flow_chart.eps,scale=0.6}
  \caption{ダイアログナビのフローチャート} \label{fig:architecture}
 \end{center}
\end{figure}



テキストの検索 \label{sec:テキストの検索}

質問応答システムにおいてまず重要なことは，質問の答えを含むと思われるテキ
ストを十分な精度で検索できることである．そのために，質問タイプとプロダク
ト名による知識ベースの絞り込みを行う．また，表現のずれを吸収するために同
義表現辞書(図\ref{fig:同義表現辞書})を利用したマッチングを行う．さらに，
スコア計算において，「ファイル→開く」のような係り受け関係に加点すること
によって，検索の精度を向上させる\cite{CLARIT}．


\subsection{マッチングの前処理} \label{subsec:マッチングにおける文節の扱い}

ユーザ質問文とテキスト内の文(以下，{\bf テキスト文}という)は，それぞれ構
文解析を行って文節単位の係り受け構造に変換した上でマッチングを行う．この
節では，マッチングを行うまでの前処理についてまとめる．


\subsubsection{構文解析とキーワード抽出}

ユーザ質問文とテキスト文の両者について，JUMAN\cite{JUMAN}，KNP\cite{KNP} 
によって構文解析を行い，各文節に含まれるキーワードを抽出する．JUMANにお
いて，普通名詞・固有名詞・人名・地名・組織名・数詞・動詞・形容詞・形容動
詞・副詞・カタカナ・アルファベットと解析された語の原形をキーワードとみな
す．ただし，一般的な語彙「する」「ある」「行う」「おこなう」「行く」「い
く」「なる」「下さる」「くださる」「ございます」「できる」「出来る」は，
キーワードとしない．


\subsubsection{文節の分割・併合処理} \label{subsubsec:文節の分割・併合処理}

マッチングのスコアを計算する際，KNPが出力した文節をそのまま用いることに
は問題がある．例えば，「画面をコピーできない」は2文節，「画面コピーをす
ることができない」は4文節と解析されるが，両者は同じことを表現している．
これを適切に扱うためには，両者の単位をそろえる必要がある．

本システムは，下記のルールに従って文節を分割・併合する(図\ref{fig:文節の
分割・併合処理の例})．
\begin{enumerate}
 \item 複数のキーワードを含む文節は，1キーワード毎に分割する．分割された
       隣り合う文節同士は，係り受けの関係にあるものとする．ただし，カタ
       カナ語・アルファベット・数詞が隣接している箇所では分割しない．こ
       のような語同士が隣接する場合は，「ウィンドウズ98SE」のようにプロ
       ダクト名などを表していることが多いからである．

 \item 「(〜に)ついて」「(〜)こと」などの複合辞・形式名詞・副詞的名詞か
       らなる文節，キーワードを含まない文節は，直前の文節に併合する．
\end{enumerate}



\begin{figure}
 \begin{center}
\epsfile{file=fig/divide_merge.eps,scale=0.5}
 \caption{文節の分割・併合処理と否定フラグの付与}
 \label{fig:文節の分割・併合処理の例}
  \end{center}
\end{figure}



\subsubsection{否定フラグの付与}

ユーザ質問文とテキスト文のマッチングの際に否定表現のバリエーションを吸収
するために，文節にフラグを付与する．具体的には，形容詞「ない」，助動詞
「ぬ」，または形容動詞「不可能だ」を含む場合に否定フラグを付与する(図
\ref{fig:文節の分割・併合処理の例}右)．


\subsubsection{ユーザ質問文のタイプ推定と文末表現の削除}

\begin{table}
 \caption{「話し言葉検索」の質問文タイプ} \label{tab:「話し言葉検索」のログ分析結果}
 \begin{center}
  \footnotesize
  \begin{tabular}{c|p{4cm}|p{4cm}|c} \hline
   質問文タイプ & 説明 & 質問文の例(文末表現パターン) & 割合 \\ \hline \hline
   What型 & 用語の意味や定義などをたずねる質問 
   & 〜って何ですか，〜の説明をして，〜の意味を教えて
   & 約10\,\% \\ \hline
   How型 & 操作の方法などをたずねる質問 
   & 〜方法を教えて，〜にはどうしたらいいの，〜の使い方
   & 約35\,\% \\ \hline
   Symptom型 & 遭遇している問題や症状を述べ，その解決策をたずねる質問
   & 〜してしまう，〜が使えません，〜ができない
   & 約50\,\% \\ \hline
   その他 & ------------------ & ------------------ & 約5\,\% \\ \hline
  \end{tabular}
 \end{center}
\end{table}


「話し言葉検索」の検索ログを分析した結果，表\ref{tab:「話し言葉検索」の
ログ分析結果}に示すようにユーザの質問には主に3つのタイプが存在することが
わかった．本システムでは，表\ref{tab:「話し言葉検索」のログ分析結果}の文
末表現パターンを用いて，ユーザ質問文の質問タイプ(What型，How型，Symptom 
型，タイプなしのいずれか)を推定する．また，文末表現パターンのうち，「〜っ
て何ですか」「〜方法を教えて」のようにテキスト検索においてノイズとなるも
のについては，ユーザ質問文から削除する．


\subsection{表現のずれの吸収} \label{subsec:同義表現辞書の利用}

適切なテキストを検索するためには，ユーザ質問文とテキストの間の表現のずれ
が大きな問題となる．本システムでは，{\bf 同義表現辞書}と{\bf 上位・下位
語辞書}を用いることによってこの問題に対処する．


\subsubsection{同義表現辞書} \label{subsubsec:同義表現辞書}

表現のずれは語のレベルだけでなく，「パソコンを起動する」「Windowsを起動
する」「電源を入れる」のように，2文節以上のフレーズレベルにおいても多数
存在する．そこで，同義語だけでなくフレーズレベルのものも含んだ同義表現を
グループ化した{\bf 同義表現辞書}を作成し，これを用いて同義表現のマッチン
グを行う．

同義表現辞書の例は図\ref{fig:同義表現辞書}に示した．本辞書の作成は，「話
し言葉検索」のログを解析し，頻出する同義表現をグループ化することによって
行った．また，和語動詞(「戻る」など) の可能形(「戻れる」) や読み(「もど
る」「もどれる」)も同義表現として登録した．


なお，同義表現辞書には再帰的な関係が含まれているため，これをあらかじめ展
開しておく．図\ref{fig:同義表現辞書の再帰的展開}においては，「メールを読
む」には2つのキーワード「メール」「読む」が含まれるが，「メール」には同
義語「メイル」「E-mail」が存在し，「読む」には同義語「読み込む」が存在す
る．この場合，「メールを読む」というフレーズを$3 \times 2 = 6 通り$ に展
開する．


\begin{figure}
 \begin{center}
\epsfile{file=fig/expand_syndic.eps,scale=0.5}
 \caption{同義表現辞書の再帰的展開} 
\label{fig:同義表現辞書の再帰的展開}
 \end{center}
\end{figure}


マッチングの際には，ユーザ質問文とテキストの両者について，同義表現辞書を
調べて，そこに含まれる同義表現グループを抽出し，同一グループのものがあれ
ばマッチするとみなす．ただし，\ref{subsec:転置インデックス}節で述べるよ
うに，テキストについてはあらかじめ同義表現グループを抽出しておく．

図\ref{fig:ユーザ質問文と同義表現データベースの照合}に，ユーザ質問文と同
義表現辞書の照合の例を示す．この例では，4つの同義表現グループ{\bf [使う]，
[メール]，[読む]，[メールを読む]}が抽出される．

\begin{figure}
 \begin{center}
\epsfile{file=fig/extract_syn.eps,scale=0.5}
  \caption{ユーザ質問文と同義表現辞書の照合}  \label{fig:ユーザ質問文と同義表現データベースの照合}
  \end{center}
\end{figure}



\subsubsection{上位・下位語辞書} \label{subsubsec:上位・下位語辞書}

同義表現辞書ではうまく扱えない表現のずれも存在する．例えば，「ブラウザ」
$\Longleftrightarrow$「IE6」，「ブラウザ」$\Longleftrightarrow$「IE5」と
いった表現のずれに対して，「ブラウザ」「IE5」「IE6」をすべて同義語として
扱うことは問題である．なぜなら，「IE5」に関する質問に対して，「IE6」に関
するテキストを示すことは適切でないからである．

そこで，図\ref{fig:上位下位関係}に示すような上位・下位語辞書を作成し，テ
キストに現れるキーワードの上位語・下位語を，キーワードと同様に扱うことに
よってこの問題に対処する．例えば，「IE6」がテキストに現れる場合はその上
位語「IE」「ブラウザ」もキーワードとして扱い，「IE」がテキストに現れる場
合はその上位語「ブラウザ」と下位語「IE3」「IE4」「IE5」「IE6」もキーワー
ドとして扱う．ユーザ質問文についてはこの扱いを行わないことによって，
「IE5」と「IE6」がマッチすることが避けられる．



\subsection{転置インデックスの利用} \label{subsec:転置インデックス}

テキストを高速に検索するために，前もってテキストからキーワード・同義表現
グループの抽出と，キーワードの上位・下位語の展開を行い，転置インデックス
を作成しておく．

本システムは，ユーザ質問文から抽出されたキーワードと同義表現グループにつ
いて転置インデックスを参照し，1個以上のキーワードまたは同義表現が一致す
るテキストを，次節で述べる質問タイプ・プロダクト名による絞り込みの対象と
する．



\subsection{知識ベースの絞り込み} \label{subsec:テキスト集合の絞り込み}

テキスト検索の精度を向上させるために，質問タイプとプロダクト名による知識
ベースの絞り込みを行う．

\subsubsection{質問タイプによる絞り込み} \label{subsubsec:質問タイプによる絞り込み}

テキスト検索モジュールは，入力解析モジュールによって推定された質問パター
ンにもとづいて，表\ref{tab:質問タイプによるテキスト集合の絞り込み}に示す
ようにテキスト集合を絞り込む．原則として，用語集はWhat型，ヘルプ集はHow 
型の質問に対応させる．サポート技術情報についてはSymptom型・How型を示すタ
グが付与されているので，これを利用する．

なお，What型の質問については必ずしも用語集を用いて答えればよいとは限らな
い．例えば，「コントロールパネルについて教えて」のような質問はWhat型に分
類されるが，用語の定義ではなく操作方法などについて聞いていると解釈するこ
ともできる．よって，全てのテキストを検索対象とした上で，複数の知識ベース
のテキストがユーザ質問とマッチした場合には用語集のテキストを最初に提示す
る．

\begin{table}
 \caption{質問タイプによるテキスト集合の絞り込み} \label{tab:質問タイプ
 によるテキスト集合の絞り込み}
 \begin{center}
  \footnotesize
  \begin{tabular}{@{\hspace{1mm}}l@{\hspace{2mm}}l|c@{\hspace{2mm}}c@{\hspace{2mm}}c@{\hspace{2mm}}c@{\hspace{1mm}}} \hline
   & & \multicolumn{4}{|c}{質問タイプ} \\
   \multicolumn{2}{c|}{テキスト集合} & What型 & How型 & Symptom型 &
   タイプなし \\ \hline
   用語集           & (What型)     & o &   &   & o \\ \hline
   ヘルプ集         & (How型)      & o & o &   & o \\ \hline
   サポート技術情報 & (Symptom型)  & o &   & o & o \\
                    & (How型)      & o & o &   & o \\
                    & (タイプなし) & o & o & o & o \\ \hline
  \end{tabular}
 \end{center}
\end{table}


\subsubsection{プロダクト名による絞り込み} \label{subsubsec:プロダクト名による絞り込み}

ヘルプ集・サポート技術情報については，図\ref{fig:マイクロソフト・サポー
ト技術情報の例}に示したようにすべてのテキストに対象プロダクト名が明示さ
れているので，これを利用してテキストの絞り込みを行う．

質問文にプロダクト名(Windows NT，Word，Excelなど)が出現する場合は，その
プロダクトを対象とするテキストを検索対象とする．質問文に複数のプロダクト
名が出現する場合(「\underline{Excel}で作った表が\underline{Word}で読み込
めない」など) は，いずれかのプロダクトを対象とするテキストを検索対象とす
る．




\subsection{テキストのスコア計算} \label{subsec:スコアの計算}


転置インデックスを参照して得られ，さらに質問タイプ・プロダクト名によって
絞り込まれた各テキストを対象として，ユーザ質問文との間で係り受け関係まで
考慮した類似度計算を行う．ただし，絞り込まれたテキスト数が1000個を超える
場合は，転置インデックスにおいて一致したキーワード・同義表現グループの数
の多い順に，上位1000個までを対象とする．


\subsubsection{文類似度の計算}

ユーザ質問文とテキスト文の2文の類似度の計算は，\ref{subsec:マッチングに
おける文節の扱い}節で述べた文節を単位として行う．2文の互いに対応する文節
と係り受け関係の割合({\bf 被覆率})をそれぞれ計算し，その積を2文の類似度
とする．

まず，2文間で，以下の条件によって文節・係り受け関係を対応づける．その際，
対応する文節・係り受け関係に{\bf 対応度}(0以上，1以下の値)を付与する．
\begin{enumerate}
 \item ユーザ質問文の文節{\bf A}に含まれるキーワードと，テキスト文の文節
       {\bf A'}に含まれるキーワード(あるいはその上位・下位語)のいずれか
       が一致する場合，{\bf A}と{\bf A'}を対応づける．対応度は，以下のよ
       うに計算する．
       \begin{itemize}
	\item[(a)] {\bf A，A'}に共通のキーワードが含まれる場合は，以下の計算
	      式によって対応度を計算する．
	      \[
	      (対応度) = \frac{(共通して含まれるキーワード数)}{(\mbox{\bf A，
	      A'}のうちの多い方のキーワード数)}
	      \]
	      例えば，「Windows 98 SE」(3語)と「Windows 98」(2語)につい
	      ては，2語「Windows」「98」が共通して含まれるので，対応度は
	      $2/3 (\simeq 0.67)$となる．ただし，多くの場合，文節は1キー
	      ワードのみを含むので，対応度は1.0となる．

	\item[(b)] {\bf A}のキーワードと，{\bf A'}のキーワードの上位語または
	      下位語が一致する場合は，対応度は0.9とする．
	\item[(c)] {\bf A}と{\bf A'}の否定フラグが一致しない場合は，対応度は
	      一致する場合の0.6倍とする．
       \end{itemize}
 \item ユーザ質問文内の係り受け関係{\bf A$\rightarrow$B}とテキスト文内の
       係り受け関係{\bf A'$\rightarrow$B'}について，文節{\bf A，A'}と文
       節{\bf B，B'}がそれぞれ対応する場合，それらを対応づける．{\bf
       A$\rightarrow$B}の対応度は{\bf A，A}の対応度と{\bf B，B}の対応度
       の積とする．
 \item ユーザ質問文から抽出された同義表現グループとテキスト文から抽出さ
       れた同義表現グループが一致する場合，それらが抽出された文節・係り
       受け関係を対応づける(図\ref{fig:同義表現の対応づけ})．対応度は1.0
       とする．
\end{enumerate}
以上の処理の結果，両者の文節・係り受け関係に対応度が付与される．複数の対
応を持つ文節・係り受け関係については，いずれか大きな対応度をその対応度と
する．

\begin{figure}
 \begin{center}
\epsfile{file=fig/synmatch.eps,scale=0.5}
  \caption{同義表現の対応づけ} 
\label{fig:同義表現の対応づけ}
  \end{center}
\end{figure}


ユーザ質問文，テキスト文の{\bf 被覆率}は，それぞれ以下の式によって計算す
る．
\[
 (被覆率) = \frac{(文節の対応度の和) + (係り受け関係の対応度の和) \times 2}
  {(文節の総数) + (係り受け関係の総数) \times 2}
\]
ユーザ質問文，テキスト文の両者の被覆率の積を，両者の類似度とする．

図\ref{fig:スコア計算}においては，ユーザ質問文，テキスト文ともに3つの文
節と2つの係り受け関係が対応を持っており，対応度はすべて1.0である．両者の
被覆率はそれぞれ1.0，0.54であるので，類似度は0.54となる．

\begin{figure}
 \begin{center}
\epsfile{file=fig/score_calc2.eps,scale=0.6}
  \vspace*{5mm}
  \begin{tabular}{ccccc}
   3.0 & ------ & {\bf 文節の対応度の和} & ------ & 3.0 \\
   2.0 & ------ & {\bf 係り受け関係の対応度の和} & ------ & 2.0 \\
   3 & ------ & {\bf 文節の総数} & ------ & 5 \\
   2 & ------ & {\bf 係り受け関係の総数} & ------ & 4 \\
   1.0 & ------ & {\bf 被覆率} & ------ & 0.54 \\
  \end{tabular}
  \vspace*{-4mm}

  \underline{{\bf 類似度} $ = 1.0 \times 0.54 = 0.54$ }
  \vspace*{4mm}
  \caption{ユーザ質問文とテキスト文の対応づけと類似度の計算} \label{fig:スコア計算}
  \end{center}
\end{figure}



\subsubsection{テキストのスコアと代表文} \label{subsubsec:テキストのスコアと代表文}

各テキスト中でもっとも類似度の大きな文をテキストの{\bf 代表文}とし，その
類似度をテキストのスコアとする．


\subsubsection{サポート技術情報の扱い}

サポート技術情報は，表\ref{tab:text_collection}に示したようにテキスト全
体の複数文がマッチングの対象となるため，特別な扱いをしている．

\begin{itemize}
 \item テキスト文の長さが一様ではないので，テキスト文の被覆率を考慮しな
       い．すなわち，ユーザ質問文とテキスト文の類似度は，ユーザ質問文の
       被覆率とする．
 \item 一つの事象を複数文で説明している場合が多いので，前後の文とのマッ
       チングを考慮する．ユーザ質問文とテキスト文$S_n$の間で類似度を計算
       する場合は，ユーザ質問文の文節・係り受け関係と，$S_n$の前後の文
       ($S_{n-1}$，$S_{n+1}$)の文節・係り受け関係の対応にも，対応度0.5
       を与える．
 \item サポート技術情報のテキストには，図\ref{fig:マイクロソフト・サポー
       ト技術情報の例}に示したように，セクションが存在する．これらのセク
       ションのうち，「タイトル」「概要」「現象」「症状」セクションには，
       ユーザが頻繁に質問することがらが書かれていることが多い．そこで，
       文の存在するセクションに応じて，類似度に下記の係数を掛け合わせる．

       \[
	\begin{array}{llc}
	 - & タイトル・概要 & 1.0倍 \\
	 - & 現象・症状     & 0.8倍 \\
	 - & 上記以外       & 0.6倍 \\
	\end{array}
       \]


\end{itemize}


\subsection{選択肢の絞り込み}

テキスト検索モジュールは，3つのテキスト集合(用語集・ヘルプ集・サポート技
術情報) ごとに，テキストのスコアに基づいてユーザに提示する選択肢を絞り込
む．

テキストをスコアの大きい順に整列し，上位$n$個までをユーザに提示する選択
肢とする．ただし，スコアが閾値$t$を下回るものは対象外とする．また，同じ
スコアの複数のテキストが$n$位前後で並ぶ場合は，それらをすべて含める．$n$，
$t$ の値は，表\ref{tab:選択肢の絞り込みのパラメータ}に示すようにテキスト
集合ごとに定めた．

複数のテキスト集合から選択肢が得られた場合は，用語集，ヘルプ集，サポート
技術情報の順で提示する．

\begin{table}
 \caption{選択肢の絞り込みのパラメータ} \label{tab:選択肢の絞り込みのパラメータ}
 \footnotesize
 \begin{center}
  \begin{tabular}{c|cc} \hline
   & 最大選択肢数 & スコア閾値 \\
   テキスト集合     & $n$ & $t$ \\ \hline
   用語集           & 2   & 0.8 \\
   ヘルプ集         & 5   & 0.3 \\
   サポート技術情報 & 10  & 0.1 \\ \hline
   対話カードの{\tt $<$UQ$>$}(\ref{subsec:対話カードを用いた聞き返し}節) & 1 & 0.8 \\
   \hline
  \end{tabular}
 \end{center} 
\end{table}



ユーザのナビゲート \label{sec:ユーザのナビゲート}

ユーザが自分の知りたいことを普通に表現しても，それで一意に適切なテキスト
が決まることは少ない．例えば「Windows98で起動時にエラーが発生した」とい
う比較的具体的な質問であっても，いくつかの原因と対策があり，それぞれにテ
キストが存在する．ユーザの質問がさらに曖昧であったり抽象的であったりする
場合には，より多くのテキストが候補として選ばれる．いずれにせよ，ユーザが，
複数のテキスト候補の中から，自分の状況に一番適切なものを選択することが必
要になる．

WWWのサーチエンジンは，テキスト中から検索語を含む部分を抽出してユーザに
提示することによって，ユーザのテキスト選択を補助している．本システムでは，
この考え方を一歩進め，ユーザの質問(遭遇している問題)をより具体化するよう
な説明文をテキスト中から自動的に抽出し，それらを選択肢として提示するとい
う形でユーザへの聞き返しを行う．

しかし，ユーザの質問が非常に曖昧な場合には上記の方法はうまく機能しない．
そこで，頻繁に尋ねられる曖昧な質問に対して，それをどのように対話的に具体
化するかを対話カードという形式で体系化した．例えば，図\ref{fig:ユーザの
ナビゲート}に示すように，ユーザが「エラーが発生した」という質問をした場
合，「エラーが発生したのはいつですか」「使っているWindowsのバージョンは
何ですか」などの聞き返しを行って，ユーザの問題を具体化する．


\begin{figure}
 \begin{center}
\epsfile{file=fig/hierarchy.eps,scale=0.45}
  \caption{ユーザのナビゲート} 
\label{fig:ユーザのナビゲート}
 \end{center}
\end{figure}



\subsection{状況説明文の抽出} \label{subsec:状況説明文の抽出}

ユーザ質問とマッチした知識ベース中の文では，その中のマッチしなかった部分
に，ユーザの問題をより具体化する状況説明が与えられていると考えられる(こ
のような部分を状況説明文とよぶ)．たとえば，ユーザが「ページ違反が発生す
る」と質問し，これが「IE5を起動した際にページ違反が発生する」という文に
マッチした場合，マッチしていない「IE5を起動した際に」という部分が状況説
明文となる．ユーザの質問にマッチした複数の文からそれぞれ状況説明文を抽出
し，ユーザに選択肢として提示すれば，ユーザは自分の状況に適合するものを容
易に選択することが可能となる．

状況説明文抽出のアルゴリズムを以下に示す．

\begin{enumerate}
 \item 「この資料では，(〜)」「以下の」「(〜する) 問題について説明し
       ています」など，頻出する冗長な表現をパターンマッチにより削除す
       る．
 \item 文を次の箇所で分割する．分割された各部をセグメントと呼ぶ．
       \begin{itemize}
	\item 連用修飾節
	\item 「〜とき」「〜際」「〜場合」「〜最中」など
	\item 読点を伴うデ格
       \end{itemize}
 \item セグメントのうち，すべての文節がユーザ質問文中の文節と対応するも
       のを削除する(同義表現として対応する文節も含む)．
 \item 末尾(削除されたセグメントを除く)のセグメントを状況説明文の核とす
       る．
 \item 核のセグメントと，それに直接係るセグメントのみを，状況説明文とし
       て選択する．
\end{enumerate}


アルゴリズムの適用例を図\ref{fig:選択肢テキストからの状況説明文の抽出}に
示す．まず，左の文は2つのセグメント{\bf A・B}，右の文は3つのセグメント
{\bf C・D・E}に分割される．このうち，左の文のセグメント{\bf B}と，右の文
のセグメント{\bf C・E}は，すべての文節がユーザ質問文と対応するため削除さ
れる．結果としてセグメント{\bf A}と{\bf D} が状況説明文の核となり，「IE5 
を起動した際に」と「タスクスケジューラを使うと」が状況説明文として出力さ
れる．

\begin{figure}
 \begin{center}
\epsfile{file=fig/extract_description.eps,scale=0.5}
  \caption{選択肢テキストからの状況説明文の抽出} 
  \label{fig:選択肢テキストからの状況説明文の抽出}
 \end{center}
\end{figure}

サポート技術情報のテキストについては，各選択肢テキストの代表文から状況説
明文を抽出する．用語集・ヘルプ集のテキストについては，各テキストの見出し
語・タイトル自体が簡潔な説明文となっているので，この処理の対象とはしない．



\subsection{対話カードを用いた聞き返し} \label{subsec:対話カードを用いた聞き返し}





ユーザの質問が非常に曖昧な場合には，テキスト検索の精度が低くなり，多くの
不適切なテキストがマッチしてしまう．このような場合に状況説明文の抽出を行っ
ても，誤りを含んだ多くの選択肢が得られることになり，ユーザの助けとはなら
ない．

そこで，頻繁に尋ねられる曖昧な質問に対して，それを対話的に具体化する手順
を対話カードという形式で体系化した．1枚の対話カードは，あるユーザ
質問に対して，どのような聞き返しをすればよいかを記述したもので，以下の要
素から構成されている(図\ref{fig:対話カードの例})．

\begin{description}
 \item[\tt $<$ID$>$:] 対話カードのID．
 \item[\tt $<$UQ$>$:] ユーザ質問文．この部分がユーザの質問文と
       マッチすればこの対話カードが利用される．
 \item[\tt $<$REPLY$>$:] システムからユーザへの聞き返し発話．
 \item[\tt $<$SEL action=CARD/SHOW/RET ... $>$:] 聞き返しの際，ユーザに
	    提示する選択肢．それぞれの選択肢にはユーザがそれを選んだ場合
	    のシステムの動作が記述されている．{\tt action=CARD}の場合に
	    は{\tt card\_id=}で示された対話カードに移る．{\tt
	    action=SHOW} の場合には{\tt url}で示されたwebページ(マイクロ
	    ソフトのサイトの種々のドキュメント) または{\tt text\_id}で示
	    された知識ベースのテキストを表示する．{\tt action=RET}の場合
	    には{\tt phrase}で示された質問文によって知識ベースを検索する．
\end{description}


対話カードの利用例を図\ref{fig:user_interface}によって説明する．まずユー
ザが「エラーが発生した」という質問をすると，質問文と各対話カードの{\tt
$<$UQ$>$} の部分とのマッチングを\ref{sec:テキストの検索}節で述べたアルゴ
リズムによって行う．この結果，図\ref{fig:対話カードの例}上段の対話カード
が選ばれる．システムはこのカードに従って，「エラーはいつ発生しますか?」
という聞き返しを，選択肢を示して行う．ユーザが「Windows 起動中」を選ぶと，
システムは図\ref{fig:対話カードの例}下段の[エラー/Windows 起動中]の対話
カードに移って，「あなたがお使いのWindowsを選んでください」という聞き返
しを行う．ここでユーザが「Windows 98」を選ぶと，「Windows 98の起動中にエ
ラーが発生する」を質問文として知識ベースのテキストの検索を行う．


対話カードはこのように階層的に構成されており，そのすべてのカードの{\tt
$<$UQ$>$}が検索対象となっている．すなわち，図\ref{fig:ユーザのナビゲート} 
で示したさまざまなレベルの曖昧性・抽象度の質問を全体的にカバーするように
設計されている．たとえば，ユーザが「Windowsを起動中にエラーが発生する」
と質問した場合には，はじめから図\ref{fig:対話カードの例}下段のカードを用
いた対話が行われることになる．

また，対話カードの枠組みは，「U:こんにちは S:こんにちわ」「U:このシステ
ム使いやすいですね S:ありがとうございます」のようなドメインとは関係のな
い例外的な対応を行う場合にも利用している(この場合は{\tt $<$SEL$>$}のない
カードとなる)．このような対応ができなければ，通常の検索，すなわち知識ベー
スに対して「このシステム使いやすいですね」で検索を行ってしまい，「システ
ム」や「使う」を含む知識ベースを提示するということが起こってしまう．ユー
ザの例外的な発話に対する不適切な動作を防ぎ，正常な対話を維持するという意
味で，対話カードによる例外処理は重要である(このような例外的な対話は次節
では「範囲外」の対話と扱っている)．


