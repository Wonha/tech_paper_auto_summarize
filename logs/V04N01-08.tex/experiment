\section{評価実験}
\label{sec:評価実験}

本論文で提案した手法の評価実験を行った．
まず，EDRコーパスの207,802例文のうち，約10分の1に相当する
20,000例文をランダムに選んでテストデータとし，残りを訓練データとした．
そして，訓練データからPCFGを抽出し，抽出したPCFGを用いて
テストデータの例文を統語解析することにより，
抽出したPCFGの品質を評価した．
\subsection{文法抽出実験}
\label{sec:文法抽出実験}
文法抽出を以下の手順で行った．
\begin{enumerate}
\item
  訓練データの例文の品詞を細分化した．(\ref{sec:品詞の細分化} 節)

  また，文末の助動詞に対する構造を統一した．
  (\ref{sec:助動詞に関する修正} 節)

\item
  【文法抽出アルゴリズム】に従って訓練データから
  PCFGを抽出した．
  (\ref{sec:ラベルの決定方法} 節，\ref{sec:同一品詞列} 節)


\item
  【冗長規則削除アルゴリズム】に従って冗長な規則を削除した．
  (\ref{sec:文法サイズの縮小} 節)
\item
  式(\ref{eq:規則の確率})より各規則の確率を推定した．
  (\ref{sec:規則の確率の推定} 節)
\end{enumerate}
コーパスから抽出したPCFGの概要を表\ref{tab:抽出したPCFG} に示す．
\begin{center}
  \tblcap{抽出したPCFG}{tab:抽出したPCFG}

  \begin{tabular}{|c||r|r|r|} \hline
    \makebox[10mm]{~} &
    \makebox[18mm]{非終端記号数} &
    \makebox[18mm]{終端記号数}   &
    \makebox[18mm]{規則数}       \\ \hline
    $G_0$ & 41~~ & 149~~ & 15206~~ \\ \hline
    $G_1$ & 41~~ & 149~~ &  2219~~ \\ \hline
  \end{tabular}
  \bigskip
\end{center}
$G_1$ は上述の手続きによって訓練データから抽出されたPCFG，
$G_0$ は冗長規則を削除する前のPCFGである．
冗長規則を削除したことにより文法サイズを約85\%縮小することができた．
\subsection{統語解析実験}
\label{sec:統語解析実験}

得られたPCFGを用いてテストデータの例文の統語解析を行った．
統語解析は一般化LR法~\cite{tomita86a} により行った．
LRパーザをSun Sparc Station 10/51(主記憶64Mbyte)上に実装した．
結果を表\ref{tab:統語解析結果(枝刈りなし)} に示す．
\begin{center}
  \tblcap{統語解析結果}{tab:統語解析結果(枝刈りなし)}
  \begin{tabular}{|r|r|r||r|} \hline
    \makebox[17mm][c]{受理} &
    \makebox[17mm][c]{不受理} &
    \makebox[17mm][c]{メモリ不足} &
    \makebox[17mm][c]{合計} \\ \hline
    12,658 文 & 23 文 & 7,319 文 & 20,000 文 \\ \hline
  \end{tabular}
  \bigskip
\end{center}
「受理」はパーザが解析に成功して1個以上の解析木を出力したことを，
「不受理」は解析に失敗したことを，
「メモリ不足」はメモリ不足のためにパーザが解析を中断したことを示す．
全体の約36\%に当たる7,319文がメモリ不足のために解析できなかった．
そこで，これらの文については，生成確率の低い部分木を解析途中で
破棄する枝刈りを行いながら再度統語解析を行った．
その結果を表\ref{tab:統語解析結果(枝刈りあり)} に示す．
\begin{center}
  \tblcap{枝刈りを行う統語解析結果}
         {tab:統語解析結果(枝刈りあり)}
  \begin{tabular}{|r|r|r||r|} \hline
    \makebox[17mm][c]{受理} &
    \makebox[17mm][c]{不受理} &
    \makebox[17mm][c]{メモリ不足} &
    \makebox[17mm][c]{合計} \\ \hline
    5,822 文 & 562 文 & 935 文 & 7,319 文 \\ \hline
  \end{tabular}
  \bigskip
\end{center}
これにより，$12,658 + 5,822 = 18,480$ 文を受理することができた．
受理した文の平均単語数は24.45単語であった．
また，生成した解析木数の1文当たりの平均は
$3.24 \times 10^9$ であった．
非常に多くの解析木が生成されているが，
PCFGにより解析木の生成確率を計算し，
その上位何位かを出力することによって
解析結果の候補数を絞り込むことが可能である．

まず，文法の適用範囲の広さを示す尺度として，受理率を次のように定義する．
\[
  受理率 ~=~ 
  \frac{\displaystyle 受理した文の数}
       {\displaystyle 統語解析した文の数}
\]
受理率は$18480/20000 ~\simeq~ 0.924$ となり，
適用範囲の広い文法が得られたことがわかる．
また，受理しなかった1520文のうち935文(約61.5\%)が
メモリ不足によるものである．
したがって，パーザの使用メモリを増やすことができれば
受理率はさらに向上することが予想される．

次に，パーザが出力した解析木の評価を行った．
出力された解析木がどれだけ正しいかを評価するための
尺度として，括弧付けの再現率，括弧付けの適合率，文の正解率を
それぞれ以下のように定義した．
\smallskip
\[
  括弧付けの再現率
  ~=~ \frac{\displaystyle 正しい括弧付けの数}
           {\displaystyle コーパスの構文構造に含まれる括弧付けの数}
\]
\smallskip
\[
  括弧付けの適合率
  ~=~ \frac{\displaystyle 矛盾しない括弧付けの数}
           {\displaystyle 解析木に含まれる全ての括弧付けの数}
\]
\smallskip
\[
  文の正解率
  ~=~ \frac{\displaystyle
            出力した解析木の中に正しい解析木が含まれる文の数}
           {\displaystyle 受理した文の数}
\]
\smallskip
ここで「正しい括弧付け」とは，コーパスに付加された構文構造の括弧付けと
完全に一致している解析木中の括弧付けを表し，
「矛盾しない括弧付け」とは，コーパスに付加された構文構造の全ての
括弧付けと交差していない括弧付けを表す~\cite{pereira92a}．
また「正しい解析木」とは，
解析木中の全ての括弧付けが矛盾していない解析木を表す．
解析木の評価方法としては，
コーパスの各例文に付加された構文構造を正解とみなし，
これと同じ構造を持つ解析木を正しい解析結果とする方法も考えられる．
しかしながら，\ref{sec:文法サイズの縮小} 節で述べたように，
EDRコーパスの括弧付けの中には
多くの要素を1つの括弧で括ってしまうものも含まれている．
これに対し，冗長な規則すなわち右辺長の比較的長い規則を削除したPCFGは，
EDRコーパスに付加された括弧付けよりも細かく括弧付けする傾向を持っている．
したがって，コーパスの構文構造と単純に比較して
正しい解析結果か否かを判断するのは適切であるとは言えない．
「括弧付けの適合率」及び「文の正解率」を計算する際に，
コーパスに付加された構文構造と完全に一致していなくても，
「矛盾しない括弧付け」及び「矛盾する括弧付けを含まない解析木」を
正解としたのはこのためである．

まず，生成確率が1位の解析木について，
括弧付けの再現率，括弧付けの適合率，文の正解率の値を計算した．
結果を表\ref{tab:解析結果の評価(1位のみ)} に示す．
\begin{center}
  \tblcap{解析結果の評価(1位のみ)}{tab:解析結果の評価(1位のみ)}

  \begin{tabular}{|r|r|r|} \hline
    \makebox[27mm][c]{括弧付けの再現率} &
    \makebox[27mm][c]{括弧付けの適合率} &
    \makebox[27mm][c]{文の正解率}     \\ \hline
    54.30\%~~ & 65.74\%~~ &  8.47\%~~ \\ \hline
  \end{tabular}
  \smallskip
\end{center}
Schabesらは，英語の括弧付きコーパス(Wall Street Journal Corpus)から
Inside-Outsideアルゴリズムにより獲得した文法を用いた統語解析実験を行い，
20〜30単語のテスト文に対して括弧付けの適合率が71.5\%，
文の正解率が6.8\%であったと報告している\footnote{
  彼らは括弧付けの再現率は示していない．
}\cite{schabes93b}．
我々の実験の結果は，括弧付けの適合率ではSchabesらの結果に劣るが
文の正解率では優っている．
しかしながら，本研究とは使用しているコーパスや対象言語が
異なるため，単純な比較はできない．

表\ref{tab:解析結果の評価(1位のみ)} では，
生成確率が1位の解析木についてのみ評価を行ったが，
生成確率は統語的にみた解析木の尤もらしさを示しており，
係り受け関係などの意味的な関係を考えた場合，生成確率の
最も高い解析木が必ずしも正しい解析結果を表わしているわけではない．
正しい解析結果を選択するのには何らかの意味解析が必要であるが，
統語解析の結果出力される全ての解析結果の候補に対して
意味解析を行うのは現実的ではない．
統語解析を，意味解析を行う解析結果の候補の数を絞り込み，
意味解析にかかる負担を軽減するための前処理と考えるなら，
正解となる解析木の生成確率が1位とならなくても，
生成確率の上位何位かに含まれていれば十分であろう．
そこで，生成確率の上位$k$ 位の解析木を出力し，
その中から矛盾する括弧付けの最も少ない解析木を選んで評価した．
結果を表\ref{tab:統語解析結果の評価(上位k位)} に示す．
\begin{center}
  \tblcap{統語解析結果の評価(上位$k$ 位)}
         {tab:統語解析結果の評価(上位k位)}

  \begin{tabular}{|c||r|r|r|} \hline
    $k$ &
    \makebox[27mm][c]{括弧付けの再現率} &
    \makebox[27mm][c]{括弧付けの適合率} &
    \makebox[27mm][c]{文の正解率}     \\ \hline\hline
     1 & 54.30\%~~ & 65.74\%~~ &  8.47\%~~ \\ \hline
     5 & 57.60\%~~ & 69.04\%~~ & 16.23\%~~ \\ \hline
    10 & 59.53\%~~ & 71.10\%~~ & 21.11\%~~ \\ \hline
    20 & 61.46\%~~ & 73.18\%~~ & 26.51\%~~ \\ \hline
    30 & 62.48\%~~ & 74.13\%~~ & 29.06\%~~ \\ \hline
  \end{tabular}
  \smallskip
\end{center}
上位30位までの解析木を出力した場合，その中に正解となる解析木が
含まれている文の割合は8.47\%から29.06\%に向上することがわかった．

最後に，統語解析を行う文法のサイズを変化させ，
受理率と正解率および生成される解析木数との相関を調べる実験を行った．
まず，$G_1$ の中からある一定の閾値$P$ 以下の確率を持つ
文法を除去し，サイズの小さい文法$G_2$〜$G_5$ を抽出した
\footnote{
  実際には，閾値以下の規則を削除した後，
  残された規則の出現回数をもとに各規則の確率の推定をやり直した．
}．
次に，テストデータの中から枝刈りなしで受理した12,658文
(表\ref{tab:統語解析結果(枝刈りなし)} 参照)を
$G_2$〜$G_5$ を用いて統語解析し，結果を比較した．
テスト文をこのように限定したのは，
パーザがメモリ不足によって統語解析を中断した場合には
文法が生成する解析木の数を測定することができないからである．
解析した文の平均単語数は19.01単語であった．

実験結果を表\ref{tab:文法サイズと解析結果の変化} に示す．
メモリ不足によって解析に失敗した文はなかった．
括弧付けの再現率，括弧付けの適合率，文の正解率は，
生成確率の1位の解析木のみについて評価した．
表\ref{tab:文法サイズと解析結果の変化} により，
文法サイズが小さくなるにつれて受理率が低下していることがわかる．
また，受理率の低下に伴い平均解析木数も減少する傾向が見られる．
これに対し，受理率が変化しても
括弧付けの再現率，適合率，文の正解率はほとんど変化していない．
このことから，受理率を向上させるために文法サイズを大きくして，
その結果得られる解析木の数が増大しても，
生成確率の上位の解析木のみを出力すれば
正解率はほとんど変わらないということがいえる．

\begin{center}
  \tblcap{文法サイズと解析結果の変化}{tab:文法サイズと解析結果の変化}
  \begin{tabular}{|c||r|r|r|r|r|} \hline
    \makebox[27mm]{文法} &
    \makebox[18mm]{$G_1$} &
    \makebox[18mm]{$G_2$} &
    \makebox[18mm]{$G_3$} &
    \makebox[18mm]{$G_4$} &
    \makebox[18mm]{$G_5$} \\[-1mm]
    \multicolumn{1}{|c||}{(閾値$P$)}  &
    \multicolumn{1}{|c|}{( --- )}     &
    \multicolumn{1}{|c|}{($10^{-5}$)} &
    \multicolumn{1}{|c|}{($10^{-4}$)} &
    \multicolumn{1}{|c|}{($10^{-3}$)} &
    \multicolumn{1}{|c|}{($10^{-2}$)} \\ \hline\hline
    非終端記号数 &    41 &    37 &  34 &  23 &  15 \\ \hline
    終端記号数   &   111 &    80 &  57 &  33 &  23 \\ \hline
    規則数       & 2,219 & 1,289 & 871 & 390 & 115 \\ \hline\hline
    受理率 &
      100\%   & 99.39\% & 95.57\% & 76.74\% & 34.22\% \\ \hline
    平均解析木数 & $2.730 \times 10^7$ & 
      $1.810 \times 10^7$ & $1.071 \times 10^7$ &
      $9.841 \times 10^5$ & $4.485 \times 10^4$ \\ \hline
    括弧付けの再現率 &
      62.71\% & 62.73\% & 62.66\% & 62.91\% & 60.11\% \\ \hline
    括弧付けの適合率 &
      75.59\% & 75.62\% & 75.68\% & 76.58\% & 73.64\% \\ \hline
    文の正解率 &
      12.07\% & 12.00\% & 12.25\% & 13.38\% & 11.45\% \\ \hline
  \end{tabular}
  \smallskip
\end{center}
