Linear-chain CRFに基づく症状・診断名抽出システム
\label{chp:baseline_system}

本章では，症状・診断名の抽出のためにベースとするシステムを説明する．本
研究では，用語抽出の処理を症状・診断名からなる固有表現を抽出するタスク
とみなし，系列ラベリングとして定式化する．
また，固有表現の抽出は，機械学習アルゴリズムlinear-chain CRFを用いて行う
（以降，本研究で用いたlinear-chain CRFを指す場合，単にCRFと呼ぶ）．さら
に，CRFで抽出を行った出力に，人手で作成したルールを用いて抽出誤り訂正の
後処理を行うことで，より誤りの少ない抽出を実現する．


\subsection{MedNLP「症状と診断タスク」の定義}
\label{sec:mednlp_taskdef}

NTCIR-10 MedNLP (Medical Natural Language Processing) タスク
\cite{morita2013overview}は，医療分野における情報抽出技術の評価を目的
として実施されたタスクである．診療記録から症状・診断名を抽出する「症状
と診断タスク」を含む3つのサブタスクが定義された．本研究では，MedNLP
タスクで使用されたデータセット（MedNLPテストコレクション）を使用し，
症状と診断タスクと同様の設定で症状・診断名の抽出を行う．以下，MedNLP
テストコレクションおよび症状と診断タスクについてそれぞれ説明する．


\subsubsection*{MedNLPテストコレクション}

MedNLPテストコレクションは，医師により書かれた架空の患者の病歴要約50文書
からなるデータセットであり，2対1の比率で訓練データとテストデータに分割
されている．同テストコレクションには，患者の個人情報および診療情報が
アノテーションされている．個人情報は患者の名前，年齢，性別と，日時，地名，
医療機関名からなり，診療情報は患者の症状や医師の診断（症状・診断名）を指す．
このうち，症状と診断タスクで対象とされたのは後者の診療情報である．

症状・診断名には，医師の認識の程度などを表すモダリティ属性が定義されて
おり，それぞれ症状の罹患の肯定，否定，推量（可能性の存在）を表す
positive，negation，suspicionに加え，症状が患者の家族の病歴として
記述されていることを表すfamilyの4種類からなる．

以下，{\tt <n></n>，<s></s>，<f></f>}で囲まれた範囲をそれぞれモダリティ属性が
negation，suspicion，familyである症状・診断名であるとして，
各モダリティ属性が付与された症状・診断名の例を示す．
\renewcommand{\labelenumi}{}
\begin{enumerate}
 \item {\tt「<n>糖尿病</n>は\underline{認めず}」}
 \item {\tt「<n>関節症状</n>は\underline{改善した}」}
 \item {\tt「<s>神経疾患</s>の\underline{疑いにて}」}
 \item {\tt「<s>味覚異常</s>の\underline{可能性を考え}」}
 \item {\tt「<n>胆嚢炎</n>を\underline{疑わせる所見を認めず}」}
 \item {\tt「\underline{母親}；<f>気管支喘息</f>」}
 \item {\tt「\underline{父}：<f>狭心症</f>、<f>心筋梗塞</f>」}
 \item {\tt「\underline{娘}３人は鼻粘膜の<f>易出血性</f>があり」}
\end{enumerate}
negation，suspicion属性については，(a)〜(d)に示すように，症状・診断名の
係り先の文節が特定の表現を含む場合に，その表現に対応するモダリティ属性と
なることが多い．ただし，(e)のように，直接の係り先がsuspicionを示す表現を
含んでいても，後方に否定表現が現れることによりnegationとなることがある．
family属性の症状・診断名は，(f)，(g)のように，続柄名の後に症状・診断名を
列挙する形で記述された場合が該当する他，(h)のように，文全体の主語が続柄
である場合も該当する．
なお，positive属性は，negation，suspicionおよびfamilyであることを示す
表現と共起しない症状・診断名に対して付与される属性とみなせる．

\begin{table}[b]
\caption{訓練データにおけるモダリティ属性の分布}
\label{tab:medtr_tag}
\input{01table01.txt}
\end{table}

表\ref{tab:medtr_tag}に，訓練データにおける各モダリティ属性の出現回数
（``\#''の列）を示す．出現回数はモダリティ属性の種類により偏りがあり，
positiveが7割程度を占めているのに対し，suspicion，familyは非常に少数
となっている．


\subsubsection*{症状と診断タスク}

症状と診断タスクは，テストコレクションから，患者に関連する症状・診断名
\footnote{文献の引用など，症状・診断名への言及が注目している患者の
症状・診断を表すものではない場合には，抽出の対象とされない．}
を抽出し，モダリティ属性を決定するタスクとして定義された．評価は，訓練
データを用いて開発されたシステムに対して，テストデータでの抽出性能を
測ることで行われ，評価尺度として，$F$値 ($\beta=1$) が使用された．
$F$値は，適合率 (Precision) と再現率 (Recall) の調和平均であり，次式で定義される．
\[
 \frac{2\cdot \mbox{Presicion} \cdot \mbox{Recall}}{\mbox{Precision}+\mbox{Recall}}
\]
また，評価方法として，モダリティ属性の分類を
考慮する評価と，考慮しない評価の2通りの方法で評価が行われた．前者の方法では，
抽出された固有表現が正しい属性に分類されないと正解とならないのに対して，
後者の方法は，属性が誤っていても，抽出された固有表現の範囲がアノテーション
された正解情報と一致していれば正解とみなされる．


\subsection{固有表現抽出タスクの定式化}
\label{sec:ner_formulation}

本研究では，各モダリティ属性が付与された症状・診断名を異なるカテゴリの
固有表現とみなして固有表現抽出を行うことで，症状・診断名の抽出範囲および
モダリティ属性の決定を行う．
固有表現抽出は，入力文中の固有表現部分を同定するタスクであり，系列ラベ
リングとして定式化されることが多い．系列ラベリングとは，入力系列に対し
てラベルの系列を出力する問題である．固有表現抽出では，トークンの系列で
ある文を入力として，トークンごとに固有表現の種類等を表すラベルを推定し，
それらラベルの列を出力する．本研究では，形態素をトークンとする系列ラベ
リングとして固有表現抽出の定式化を行う．

定式化の際には，同一の固有表現（チャンク）中の位置を表すためのチャンキ
ング方式として，IOB2フォーマット\cite{sang1999representing}を使用した．
IOB2では，タグ
はB (Begin)，I (Inside)，O (Outside) の3種類があり，それぞれチャンク
の先頭，チャンクの先頭を除く内部，チャンクの外側を表す．なお，複数のカ
テゴリの固有表現が存在する場合，B，Iはカテゴリ名と併せて使用される．た
とえば，「嘔吐／B-c\_pos~~出現／I-c\_pos~~した／O」のようにラベルを付与
することで，「嘔吐出現」がc\_pos（肯定のモダリティ属性を持つ症状・診断
名）というカテゴリの固有表現であることを表す．なお，入力文の形態素解析
には，linear-chain CRFに基づく日本語形態素解析器であるMeCab
\cite{kudo2004applying} (Ver.~0.996) およびIPADIC (Ver.~2.7.0) を用いた．


\subsection{CRFによる分類}
\label{sec:crf}

本システムでは，機械学習アル
ゴリズムとしてlinear-chain CRFを用いた．
linear-chain CRFは，分類アルゴリズムである最大エントロピー法を出力が
構造を有する問題（構造学習）に拡張したモデルである．
品詞タギング\cite{lafferty2001conditional}，基本名詞句同定\cite{sha2003shallow}，
形態素解析\cite{kudo2004applying}など，構造学習，特に，系列ラベリングとして
定式化できる自然言語処理の様々な問題に適用され，高い性能が報告されている．
また，固有表現抽出の研究においても広く使用され\cite{mccallum2003early,jiang2011study}，
NTCIR-10 MedNLPタスクでも最もよく用いられた
\cite{imaichi2013comparison,laquerre2013necla,miura2013incorporating}．

linear-chain CRFの実装としては，C++ で記述されたオープンソースソフトウェア
であるCRF++ 
\footnote{http://crfpp.googlecode.com/svn/trunk/doc/index.html} (Ver.~0.58) を利用した．CRF++ は，準ニュートン法の一種であ
るL-BFGS (Limited-memory BFGS) を使用して数値最適化を行っており，省メモ
リで高速な学習を実現している．また，素性テンプレートという素性の記述形
式が定義されており，テンプレートを利用することで多様な素性を容易に学習
に組み込むことができるという特長がある．

CRF++ の素性テンプレートでは，出力ラベル系列についてのunigram素性およびbigram
素性が利用可能である．出力ラベルunigram素性は，入力系列についての任意の情報
（系列中の特定のトークンの形態素自体や品詞など）と現在のトークンのラベルの組
からなる素性を指し，出力ラベルbigram素性は，入力系列の任意の情報，現在の
トークンのラベルおよび 1 つ前のトークンのラベルの三つ組からなる素性を指す．
本研究では，すべての素性に対して出力ラベルunigram素性およびbigram素性の両方
を使用することとした．たとえば，品詞素性を$-2$から2までのウィンドウ
で用いると述べた場合，注目するトークンの 2 つ前方から 2 つ後方に位置する
トークンの品詞について，それぞれで出力ラベルunigram素性およびbigram素性を
使用することを意味する．

なお，指定した値未満の出現回数である素性を学習に使用しないことを意味する
素性のカットオフの閾値は1とし，訓練データに出現したすべての素性を使用する
ことにした．また，正則化には$L2$正則化を用いた．


\subsection{抽出に用いる素性}
\label{sec:features}

本システムでは，症状・診断名抽出のための素性として，「形態素」，「形態
素基本形」，「品詞」，「品詞細分類」，「字種」，「辞書マッチング情報」，
「モダリティ表現」の7種類の情報を用いた．
注目するトークンを起点にどこまでの範囲のトークンの情報を素性に用いるか
を表すウィンドウサイズについては，モダリティ素性を除き，
\ref{chp:experiments}章で述べる実験により最適な値を決定する．
モダリティ素性のウィンドウサイズについては後述する．


\subsubsection*{形態素，基本形，品詞，品詞細分類素性}

形態素素性はトークン自体であり，基本形，品詞，品詞細分類素性は，それぞ
れ各形態素の基本形，品詞，品詞細分類である．たとえば，「言っ」の基本形
は「言う」，「速く」の基本形は「速い」となる．品詞は，名詞，動詞，形容
詞，接続詞など10数種類存在し，品詞細分類は，名詞であれば「固有名詞」，
「形容動詞語幹」などがある．
これら四つの素性には，形態素解析器MeCabの出力を利用した\footnote{異なる
  品詞間の同名の細分類を区別するため，「名詞／一般」，「副詞／一般」の
  ように「品詞／品詞細分類」の形で細分類素性を記述した．また，品詞細分
  類がさらに細分化されている場合は，「固有名詞・人名・姓」のように最上
  層から最下層までのすべての細分類を「・」記号で併記し，1 つの品詞細分
  類という扱いとした．}．なお，MeCabではデフォルトの辞書としてIPADICが
採用されており，IPADICで使用されている品詞および品詞細分類は，
IPA品詞体系として定義されている．


\subsubsection*{字種素性}

字種素性は，トークンを構成する文字の字種パターンを表す．本研究では，ひ
らがな，カタカナ，漢字，英大文字，英小文字，ギリシャ文字，数値，記号と
これらの組合せからなる字種パターンを定義した．たとえば，「レントゲ
ン」は「カタカナ」，「考え」は「$\text{ひらがな}+\text{漢字}$」，「ＭＲＩ」は「英大文字」
が字種パターンとなる．なお，「$\text{ひらがな}+\text{漢字}$」では，1 つのトークン中にひ
らがなと漢字が出現していればこのパターンに相当するものとし，各文字の出
現順は無視した．複数字種の組合せからなるパターンの扱いは，他のパター
ンについても同様であ
\linebreak
る．


\subsubsection*{辞書素性}

辞書素性は，専門用語辞書など外部の語彙資源を利用した素性であり，入力文
中の形態素列が辞書中の語句と一致したか否かという情報を表す．本研究では，
症状・診断名の抽出のために病名等の用語から構成される辞書を使用し，入力
文中のトークン列で，辞書中の語句とマッチした部分にIOB2フォーマットに
基づくタグを付与した．
たとえば，「腎機能障害」という語句が辞書中に含まれる場合，「腎／機能／
障害／の／増悪」と分割された形態素列に対して「B／I／I／O／O」というタグ
が付与される．
なお，辞書マッチは文字数についての最左最長一致で判定し，マッチした範囲
の境界が形態素の内部にある場合，マッチ範囲に完全に包含される形態素に
対してのみタグを付与した．


\subsubsection*{モダリティ素性}

モダリティ素性は，症状・診断名のモダリティ属性を示す表現（モダリティ
表現）を捉えるための素性である．
モダリティ表現の具体例として，先行する
症状・診断名のモダリティがnegationであることを示す「〜なし」や「〜を認
めず」，同様にsuspicionであることを示す「〜疑い」や「〜を考え」などが
ある．また，「母」「息子」など続柄を表す表現は，共起する症状・診断名の
モダリティ属性がfamilyであることを示すモダリティ表現であるといえる．

本素性では，negation，suspicionおよびfamily属性を対象に，モダリティ属性推定
の手がかりとなる表現を正規表現で記述し，文中の各トークンについて，
最左最長一致で正規表現とマッチした範囲の端に位置するトークンまでの距離
（形態素数）と，マッチした表現が表すモダリティ属性を示すタグを付与した．
なお，positive属性は，negation，suspicionおよびfamilyであることを示す
表現と共起しない症状・診断名に対して付与される属性とみなせるため，
これらのモダリティ表現が周辺に存在しないことがpositive属性と推定する
ための手がかりとなる．

例として，negationのモダリティ表現を捉える正規表現の 1 つとして
次の(a)を
使用している\footnote{``$X|Y$''は$X$または$Y$との一致，``[$X_1 X_2 \dots
  X_N$]''は$X_1,X_2,\dots,X_N$のいずれかとの一致，``()''はパターンのグ
  ループ化，``?''は直前のパターンの0または1回の出現を表す．}．
\renewcommand{\labelenumi}{}
\begin{enumerate}
 \item \![はがを]?(([認め$|$みとめ$|$見$|$み$|$得$|$え)(ら
  れ)?)?([無な](い$|$く$|$かっ)$|$せ?ず)
\end{enumerate}
この正規表現を用いると，「運動／麻痺／は／み／られ／ず」という入力に対
して「はみられず」という部分がマッチし，マッチした範囲の先頭トークン
「は」までの距離は，「麻痺」で1，「運動」で2となる．
negationとsuspicionのモダリティ表現は症状・診断名の右側に出現するため，
モダリティ表現が右側に出現しているトークンにのみ，出現を示すタグを
付与した．反対に，familyの表現は「母：脳梗塞」のように左側に出現するた
め，モダリティ表現が左側に出現しているトークンにのみタグを付与した．

なお，negationの正規表現は上述の(a)を含む4件，suspicionの正規表現は
以下の(b)を含む2件，familyの正規表現は以下の(c)~1件を使用した
\footnote{``[父母]''に後続する``(?![指趾])''というパターンは，
医療用語である「母指」や「母趾」とのマッチを防ぐために用いた．}．
モダリティ素性として使用した正規表現の全リストは付録\ref{sec:modal_regex}に記載する．
\begin{enumerate}
\setcounter{enumi}{1}
 \item の?(疑い$|$うたがい)
 \item {[祖伯叔]?[父母](?![指趾])親?$|$お[じば]$|$[兄弟姉妹娘]$|$息子$|$従(兄弟$|$姉妹)}
\end{enumerate}
\renewcommand{\labelenumi}{}

また，過学習を抑制する目的で，モダリティ属性ごとに距離のグループ化を
行った．negationとsuspicionでは，距離1〜2（近くに出現），3〜4（やや近く
に出現），5〜8（やや遠くに出現），9〜12（遠くに出現）の4通りの距離を考慮し，
familyでは$-\infty$〜$-13$，$-12$〜$-9$，$-8$〜$-5$，
$-4{\rm〜}-1$の4通りとした．なお，距離は，注目するトークンの右側にモダリティ
表現が出現している場合に正数，左側に出現している場合に負数で表しており，
距離の絶対値は，注目するトークンから同一文中の任意のモダリティ表現（正規表現
とマッチしたトークン列）内の最も近いトークンまでのトークン数に相当する．
また，``$-\infty$〜''は文の左端以降での出現を意味している．
以上のモダリティ素性の定義に基づくと，前述の例に対しては，
「運動」および「麻痺」に``neg1\_2''，それ以外のトークンに
モダリティ表現の非出現を表すタグ``O''が付与される．

なお，モダリティ素性として付与したタグは，注目しているトークンのタグのみ
学習・推定に用いた（つまり，ウィンドウサイズを1とした）．
トークンに付与される素性タグにより，トークンの周辺文脈の情報が表現
されており，実質的に12以上先のトークンまで考慮していることになる．


\subsection{抽出誤り訂正のための後処理ルール}
\label{sec:postprocess}

著者らは，NTCIR-10 MedNLPタスクに参加し，構造化
パーセプトロン\cite{collins2002discriminative}およびlinear-chain CRF
に基づく固有表現抽出システムを開発してきた
\cite{higashiyama2013clinical,higashiyama2013developing}．
開発したシステムについてエラー分析を行ったところ，
観測された誤りの中で，モダリティ属性の分類誤りが大きな割合を占めること
がわかった．この種の誤りは単純なルールで修正できるため，モダリティ属性
の分類誤りに焦点を当て，誤り訂正のためのルールを作成することにした．
観測されたモダリティ属性分類誤りは，さらに次の2通りに大別できたため，
それぞれの誤りに対応する訂正ルールとして，2 つのルールを作成した．
\begin{itemize}
 \item 固有表現の周辺に（非positive属性の）モダリティ表現が存在し，
       かつ推定された属性が同表現が表す属性と異なっている
       （主にpositiveとなっている）誤り
 \item 固有表現の周辺にモダリティ表現が存在せず，
       かつ推定された属性がpositive以外となっている誤り
\end{itemize}
\vspace{8pt}

作成した 2 つのルールを以下に示す．
``［］''の外側（左側）にnegationおよび
suspicion属性に対する条件，``［］''の内側にfamily属性に対する条件を
記述した．正しい推定に対して修正ルールを適用してしまうことを防ぐため，
後述する$d_1$および$d_2$の値は，$d_1=2$，$d_2=8$として，ルールの
適用基準を厳しく設定した．ただし，family属性のモダリティ表現が出現
する文中の症状・診断名が患者の家族に対する言及でないというケースは
極めて少ないとの考えの下，familyに対する距離は$d_1=d_2=\infty$，
つまり，該当位置から到達可能な同一文内の最大トークン数とした．


\subsubsection*{モダリティ属性分類誤り修正のためのルール}

\begin{enumerate}
 \item 固有表現$e$の末尾［先頭］のトークンから右［左］方向に距離（トークン数）
       $d_1$以内に（非positive属性の）モダリティ表現$m$が存在する場合，
       $e$の推定ラベルのモダリティ属性を表現$m$が表す属性$a$に更新する．
       \begin{itemize}
	\item[*] 距離$d_1$以内に複数のモダリティ表現が存在する場合は，
	      family，negation，suspicionの順に優先する．
       \end{itemize}
 \item 固有表現$e$の末尾［先頭］のトークンから右［左］方向に距離$d_2$以内に
       モダリティ表現が存在しない場合，推定ラベルの属性をpositiveに更新する．
\end{enumerate}

なお，上記のルールを導入することは，
固有表現$e$から$e$の最も近くのモダリティ表現までの距離$d$を，
(a)近い ($d \leq d_1$)，
(b)中程度の距離である ($d_1 < d \leq d_2$)，
(c)遠い，あるいはモダリティ表現が存在しない ($d > d_2$)
の3通りに分け，距離$d$に応じてモダリティ属性決定の挙動を変えていることに対応する．
ルールが適用される(a)および(c)の条件下では，CRFで推定されたモダリティ属性を
ルールで上書きしているため，ルールによりモダリティ属性を決定しているのと等価である．
一方，固有表現から中程度の距離までの範囲内にモダリティ表現が存在する(b)の場合
には，CRFによる推定結果をそのまま採用し，モダリティ属性の決定を学習の結果に委ねた．


医療用語資源の語彙拡張と症状・診断名抽出への利用
\label{chp:util_resources}

用語抽出への語彙資源の利用は，
訓練データに少数回しか出現しない用語やまったく出現しない用語の認識に有
効であり，医療用語辞書などの語彙資源を用いた医療用語抽出研究が行われて
いる
\cite{imaichi2013comparison,laquerre2013necla,miura2013incorporating}．
しかし，診療記録では症状・診断名として多様な複合語が使用されるため，テ
キスト中の語句に対して辞書中の用語と単純にマッチングを行うだけではマッ
チしない複合語が存在し，辞書利用の効果は限定的となる．そこで，本章では，
語彙資源中の複合語から構成語彙を獲得する方法と，構成語彙を組み合わせて
より多くの複合語にマッチする拡張マッチングの方法を述べ，これらの方法に
基づく語彙資源を活用した症状・診断名の抽出手法を提案する．


\subsection{基本的な考え：医療用語の構成語彙への分解}
\label{sec:basic_idea}

症状・診断名は，複数の医療用語から構成される複合語であることが多い．た
とえば，「水痘肺炎」という用語は「水痘」と「肺炎」から構成され，「甲状
腺出血」は「甲状腺」と「出血」から構成される．診療記録では，多様な構成
語彙を組み合わせた複合語が用いられる一方で，実際に用いられる複合語の中
には辞書中には含まれないものも多い．例として，「水痘感染」と「甲状腺腫
大」は，診療記録コーパスMedNLPテストコレクション中で用いられ，医療用語
辞書MEDIS病名マスター中に存在しなかった症状・診断名である．ただし，上述
の用語の各構成語彙に注目すると，「水痘」，「感染」，「甲状腺」，「腫大」
を構成語彙として含む用語は同辞書中に多数存在した（表\ref{tab:medterm_constituent}）．

\begin{table}[t]
 \hangcaption{複合語「水痘感染」，「甲状腺腫大」の構成語彙と，MEDIS病名マスターにおける各構成語彙からなる複合語数} 
 \label{tab:medterm_constituent}
\input{01table02.txt}
\end{table}

したがって，症状・診断名の抽出に，既存の辞書中に含まれる用語をそのまま
用いて対応するには限界があるといえる．また，症状・診断名としてありうる
構成語彙の組合せは膨大な数に上ると考えられ，それらを網羅的に含むような
辞書を構築することも現実的ではない．一方で，症状・診断名の構成語彙とな
る語の多くは，辞書中の用語の部分文字列として辞書に含まれている可能性が
高い．

そこで，本研究では，既存の医療用語資源から症状・診断名の構成語彙となる
語句を獲得し，得られた構成語彙を組み合わせた柔軟なマッチング方法「拡張
マッチング」に基づく症状・診断名の抽出手法を提案する．なお，マッチした
結果は，機械学習の素性（辞書素性）として用いる．語彙資源を活用した拡張
マッチングによって，辞書素性タグが付与される語句が増加し，元の辞書に含
まれない語彙にも対応した抽出が可能になると考えられる．


\subsection{主要語辞書と修飾語辞書に基づく拡張マッチング}
\label{sec:ext_match}

症状・診断名の構成語彙の獲得にあたり，構成語彙には，単独で症状・診断名
として用いられる「主要語」と，主要語と隣接して現れたときにのみ症状・診
断名の一部となる「修飾語」の2種類が存在すると仮定す
る．\ref{sec:basic_idea}節で述べた例では，「水痘」，「感染」，「腫大」
が主要語に相当し，「甲状腺」が修飾語となる．「水痘感染」や「甲状腺腫大」
のように，構成語彙に分解される前の元の用語自体も主要語とみなす．主要語
と修飾語の具体的な獲得方法は次節以降で後述することにし，本節では，主要
語辞書と修飾語辞書の2種類の辞書を用いた症状・診断名のマッチング方法「拡
張マッチング」を説明する．

以下，「消化管悪性腫瘍の$\cdots$」という入力文が与えられた場合を例に，
拡張マッチングの手順を述べる．主要語辞書には「消化管障害」，「腫瘍」，
「悪性腫瘍」が含まれ，修飾語辞書には「消化管」，「悪性」が含まれている
ものとする．


\subsubsection*{拡張マッチングの処理}

\begin{figure}[t]
\begin{center}
\includegraphics{22-2ia1f1.eps}
\end{center}
\caption{入力文「消化管悪性腫瘍の$\cdots$」に対する拡張マッチングの処理} \label{fig:twodic_matcing}
\end{figure}

入力文を文字の列とみなし，主要語辞書中にマッチする文字列がないか検索する処理を
先頭の文字から末尾の文字まで繰り返し行う．
例の入力文に対しては，次のようにマッチング範囲の探索が行われる．
\begin{enumerate}
\item 入力文1文字目の「消」を読み込み，主要語辞書の検索を行う（図 \ref{fig:twodic_matcing}, a1）．「消化管悪」まで検索した時点で主要
  語が存在しないことが判明するため (a2)，主要語検索を終了して2文字目以
  降について検索を続ける．
 \begin{itemize}
 \item[*] 2文字目「化」および3文字目「管」の検索においてマッチする主要語は
   ない．
 \end{itemize}
\item 4文字目の「悪」を読み込み，主要語辞書の検索を行う (b1)．検索した
  結果，「悪性腫瘍」が主要語辞書とマッチする (b2)．
\item 続いて，マッチした範囲「悪性腫瘍」の左右両側について，修飾語辞書
  中にマッチする文字列がないか検索する．検索した結果，元の範囲の左側の
  「消化管」が修飾語辞書とマッチする (b3) ．
\item マッチした範囲を「消化管悪性腫瘍」に拡張し，引き続き，拡張された
  範囲のさらに左側について，修飾語辞書を検索する．しかし，これ以上マッ
  チする語はないため，「消化管悪性腫瘍」をマッチした範囲として記憶し，
  入力文5文字目以降について検索を続ける．
 \begin{itemize}
 \item[*] 5文字目「性」の検索においてマッチする主要語はない．
 \end{itemize}
\item 6文字目の「腫」を読み込み (c1) ，同様の処理を行った結果，主要語辞
  書で「腫瘍」(c2) ，修飾語辞書で「悪性」および「消化管」がマッチし
  (c3，c4)，「消化管悪性腫瘍」をマッチした範囲として記憶する．入力
  文7文字目以降の文字についても同様に検索を続ける．
 \begin{itemize}
 \item[*] 7文字目以降の検索においてマッチする主要語はなかったものとし，入
   力文に対する検索の処理を終了する．
 \end{itemize}
\end{enumerate}
上述の辞書探索処理の結果，例では「消化管悪性腫瘍」がマッチ
した範囲として（二重に）得られる．複数のマッチング範囲が得られ，得られ
た範囲間に重なりがある場合は，範囲内の文字数が最も多いものを残し，残り
を破棄する．例では，得られた 2 つの範囲が同一であるため，残される範囲も
元の範囲と同じものとなる．

以上が拡張マッチングの処理である．
最終的に得られたマッチング範囲には辞書素性タグを付与し，機械学習の素性として利用する．


\subsection{主要語辞書の利用と語彙制限}
\label{sec:maindic_filtering}

本研究では，主要語辞書として，MEDIS病名マスター (Ver.~3.11)
と，MedNLPテストコレクション\cite{morita2013overview}の訓練データを利用
する．MEDIS病名マスター（ICD10対応標準病名マスター）は，一般財団法人医
療情報システム開発センターにより提供されている病名辞書である．病態毎に
選ばれた代表病名を表す「病名表記」に加え，病名表記の読み，ICD10コード
などから構成され，本研究で利用したVer.~3.11では，24,292語が収載されている．
同辞書に含まれる病名表記を抽出し，主要語辞書として用いる．
MedNLPテストコレクションは，NTCIR-10 MedNLPタスクで提供された
模擬患者の病歴要約からなるコーパスである．
同コーパスの訓練データからアノテーションされた症状・診断名部分を抽出し，
主要語辞書MedNE（延べ語数1,922，異なり語数1,068）として用いる．

ただし，主要語辞書をそのまま用いると，一部の語が用語抽出の学習に悪影響
を与える場合がある．たとえば，細菌性皮膚感染症の一種である「よう」（癰）
は，「〜するようになった」などの表現にマッチしてしまう．また，「喫煙歴」
という表現に含まれる「喫煙」は，必ずしも患者の喫煙を表す言及ではないた
め症状・診断名に該当しない．このように，症状・診断名と無関係の表現とマッ
チする用語や，高頻度で非症状・診断名としても使用される用語を辞書が含ん
でいる場合，学習を阻害する要因となる．そこで，MedNLP訓練データを使用し，
高い割合で症状・診断名とマッチする用語を取得する処理を行う．以下，各主
要語辞書に対する語彙制限の方法を述べる．なお，後述の閾値$n_{\rm
  out}$，$r_\mathrm{out}$，$n_\mathrm{in}$および$r_\mathrm{in}$は，\ref{chp:experiments}章で述べる実験により決定する．


\subsubsection*{MEDIS病名マスターの語彙制限}

辞書に含まれる各用語について，MedNLP訓練データ中で固有表現範囲（症状・
診断名としてアノテーションされた範囲）の内部および外部に出現した回数を
それぞれカウントし，次の 2 つの基準を満たす用語を主要語として許容する．
\begin{itemize}
\item 固有表現範囲の外部における出現回数が$n_\mathrm{out}$未満である．
\item 訓練データ中に1回以上出現している場合は，固有表現範囲の内部と外部の両方の出現に対し，
外部に出現した割合が$r_\mathrm{out}$未満である．
\end{itemize}


\subsubsection*{MedNEの語彙制限}

辞書に含まれる各用語について，MedNLP訓練データ中で固有表現範囲の内部お
よび外部に出現した回数をそれぞれカウントし，次の 2 つの基準を満たす用語
を主要語として許容する．
\begin{itemize}
\item 固有表現範囲の内部における出現回数が$n_\mathrm{in}$以上である．
\item 固有表現範囲の内部と外部の両方の出現に対し，内部に出現した割合が$r_\mathrm{in}$以上である．
\end{itemize}


\subsection{医療用語資源からの修飾語の獲得}
\label{sec:gen_mdfydic}

\ref{sec:basic_idea}節で述べたように，主要語に含まれる部分文字列の中に
は有用な修飾語が多く含まれるという考えに基づき，主要語から部分文字列を
切り出すことで修飾語を獲得する．修飾語の獲得には，主要語の取得と同様
にMEDIS病名マスターとMedNEを用いる．
なお，MEDIS病名マスターの関連リソースとして提供されている
「修飾語テーブル」は，本研究では使用しない．

修飾語は，主要語辞書でマッチした範囲を拡張する際にのみ用いるため，意味
をなさない非語が含まれていても，実際にテキスト中で主要語と隣接して現れ
なければ学習・抽出に影響を与えない．ただし，MEDIS病名マスターには動詞や
助詞，記号などを含む用語（「１型糖尿病・関節合併症あり」，「アヘン類使
用による急性精神・行動障害」など）が存在するため，切り出された部分文字
列が助詞などの表現を含んでいると，症状・診断名でない範囲にまで拡張して
しまう可能性がある．

そこで，部分文字列を切り出すことにより機械的に修飾語候補を抽出した後，
意味をなさないと考えられる候補と，過大な拡張を行う可能性のある有害な候
補を除去するという手順により修飾語の獲得を行う．なお，有害な候補の除去
には，
主にひらがなから構成される語40語程度の「ひらがな表現」リストを作成し，
使用した．同リストは，助詞（「が」や「より」），接続詞（「または」や
「かつ」），動詞・助動詞の組合せ（「ならない」）などひらがなのみから
構成される表現の他，一部，「著しい」など漢字を構成要素に持つ表現も含む．
「ひらがな表現」の全リストは付録\ref{sec:mdfy_restrict}に記載する．


\subsubsection*{修飾語獲得の手順}

修飾語取得の対象とする用語集合$T$から修飾語集合$S$を生成する手順を以下
に示す．切り出す部分文字列の最小の長さは2で固定し，
修飾語として許容する部分文字列の最小出現回数を$f_\mathrm{min}$とした．
$f_\mathrm{min}$の値は，主要語の語彙制限と同様に，
\ref{chp:experiments}章で述べる実験により決定する．
\begin{enumerate}
 \item 修飾語候補の抽出
       \begin{enumerate}
	\item 各用語$t \in T$について，$t$の先頭および末尾から，
	      長さ2から$t$の文字列長までの部分文字列を切り出す．
	      切り出した部分文字列は，修飾語候補集合$S_\mathrm{cand}$に追加する．
	      \begin{itemize}
	       \item[*] たとえば，$t=\mbox{``医療用語''}$の場合，
		     ``医療''，``医療用''，``医療用語''，``用語''，``療用語''が切り出される．
	      \end{itemize}
	\item 各修飾語候補$s \in S_\mathrm{cand}$について，$s$を部分文字列として含む$T$の用語全体の集合を求める．
	      これを，$s$の出現元集合 $\mathrm{Parent}(s)$ とする．
	      \begin{itemize}
	       \item[*] たとえば，$s=\text{``用語''}$の場合，
		     $\mathrm{Parent}(s)=\{\text{``用語''},\text{``医療用語''},\text{``専門用語''},$
		     $\text{``用語抽出''}\}$などが得られると考えられる．
	      \end{itemize}
       \end{enumerate}
 \item 修飾語候補の限定（有害な語の除去）
       \begin{enumerate}
	\item $s \in S_\mathrm{cand}$のうち，数字および「％」記号のみからなる語を除去対象候補集合$S_\mathrm{reject}$に追加する．
	\item $s \in S_\mathrm{cand}$のうち，先頭または末尾が「-」（ハイフン）以外の記号か空白である語を$S_\mathrm{reject}$に追加する．
	\item $s \in S_\mathrm{cand}$のうち，先頭または末尾の文字が1字からなる「ひらがな表現」に一致し，
	      一致した文字と隣接する文字がひらがな以外である
	      \footnote{「のう胞」などひらがなからなる医療用語を除去してしまうことを防ぐため，この条件を設定した．}
	      語を$S_\mathrm{reject}$に追加する．
	\item $s \in S_\mathrm{cand}$のうち，先頭または末尾から始まる範囲が2字以上からなる「ひらがな表現」の組合せに一致した
	      語を$S_\mathrm{reject}$に追加する．
       \end{enumerate}
 \item 修飾語候補の限定（有益でない語の除去）
       \begin{enumerate}
	\item $s \in S_\mathrm{cand}$のうち，$T$内での部分文字列としての出現回数が$f_\mathrm{min}$回未満
	      ($|\mathrm{Parent}(s)|<f_\mathrm{min}$)である$s$を$S_\mathrm{reject}$に追加する．
	\item 任意の$s_1,s_2 \in S_\mathrm{cand}$ ($s_1 \neq s_2$) について，出現元集合が等しい場合，
	      $s_1$と$s_2$のうちの長さが小さい方を$S_\mathrm{reject}$に追加する．
	      \begin{itemize}
	       \item[*] たとえば，$\mathrm{Parent}(\mbox{``群''})=\mathrm{Parent}(\mbox{``症候群''})=\{\mbox{症候群},\mbox{かぜ症候群}\}$
		     である場合，``群''が$S_\mathrm{reject}$に追加される．
	      \end{itemize}
       \end{enumerate}
 \item 修飾語候補の決定
       \begin{itemize}
	\item $S_\mathrm{cand}$から$S_\mathrm{reject}$の元を除いた集合$S=S_\mathrm{cand} \setminus S_\mathrm{reject}$が求める修飾語集合である．
       \end{itemize}
\end{enumerate}


モダリティ素性における正規表現
\label{sec:modal_regex}

モダリティ素性において，各属性のモダリティ表現を捉えるために用いた
正規表現を記載する．各正規表現の記述形式は，プログラミング言語
Python\footnote{http://www.python.jp/}での正規表現に準拠している．
なお，``$X|Y$''は$X$または$Y$との一致，``[$X_1 X_2 \dots X_N$]''は
$X_1,X_2,\dots,X_N$のいずれかとの一致，``()''はパターンのグループ化，
``?''は直前のパターンの0回または1回の出現を表す．また，``(?!$\cdots$)''
は否定先読みアサーションと呼ばれ，``$X$(?!$\cdots$)''として用いられた
場合に，``$\cdots$''に相当する文字列が後続しない$X$にマッチする．

\subsubsection*{Negationのモダリティ表現}

Negation属性のモダリティ表現のために用いた正規表現を以下に示す．

\begin{itemize}
\item {\small [はがを]?(([認め$|$みとめ$|$見$|$み$|$得$|$え)(られ)?)?([無な](い$|$く$|$かっ)$|$せ?ず)}
\item {\small [はがを]?((消失$|$除外)(?!し?(な[いかくし])$|$せず))}
\item {\small [はがもの](改善$|$陰性$|$寛解)(?!し?(な[いかくし])$|$せず)}
\item {\small (の(所見$|$既往)が?)?[無な](し$|$い$|$く$|$かった)}
\end{itemize}

\subsubsection*{Suspicionのモダリティ表現}

Suspicion属性のモダリティ表現のために用いた正規表現を以下に示す．
\begin{itemize}
\item {\small の?(疑い$|$うたがい)}
\item {\small ((の$|$である$|$であった)可能性)?[はがをもと]?(考え$|$考慮$|$思われ$|$(疑$|$うたが)[わい]$|$含め$|$高い)}
\end{itemize}

\subsubsection*{Familyのモダリティ表現}

Family属性のモダリティ表現のために用いた正規表現を以下に示す．
なお，``[父母]''に後続する``(?![指趾])''というパターンは，
医療用語である「母指」や「母趾」とのマッチを防ぐために用いた．
\begin{itemize}
\item {\small [祖伯叔]?[父母](?![指趾])親?$|$お[じば]$|$[兄弟姉妹娘]$|$息子$|$従(兄弟$|$姉妹)}
\end{itemize}


修飾語の限定に用いたひらがな表現
\label{sec:mdfy_restrict}

語彙資源から修飾語を獲得する処理において，
修飾語の限定の際に用いた主にひらがなから構成される表現を以下に記載する．
\begin{description}
 \item[助詞・連語] が，の，を，に，へ，と，から，より，で，など，のみ，における
 \item[連体詞] その
 \item[接続詞] または，あるいは，および，かつ
 \item[助動詞] な
 \item[形容詞] ない，なし
 \item[動詞・名詞・助詞・助動詞の組合せからなる語] する，よる，ある，あり，して，した，ならない，なった，のための
 \item[漢字を含む表現] 伴う，伴わない，生じない，疑い，著しい，その他，手当て，比較して
\end{description}



\begin{biography}
\bioauthor{東山　翔平}{
2012年神戸大学工学部情報知能工学科卒業．
2014年神戸大学大学院システム情報学研究科博士前期課程修了．
現在，NEC情報・ナレッジ研究所に在籍．
自然言語処理，情報抽出の研究に従事．
}
\bioauthor{関　　和広}{
2002年図書館情報大学情報メディア研究科修士課程修了．
2006年インディアナ大学図書館情報学研究科博士課程修了．Ph.D.
神戸大学助教等を経て現在甲南大学知能情報学部准教授．
情報検索，データマイニングの研究に従事．
情報処理学会，電子情報通信学会，人工知能学会各会員．
}
\bioauthor{上原　邦昭}{
1978年大阪大学基礎工学部情報工学科卒業．
1983年同大学院博士後期課程単位取得退学．工学博士．
同産業科学研究所助手，講師，神戸大学工学部情報知能工学科助教授等を経て，
現在同大学院システム情報学研究科教授．
人工知能，特に機械学習，マルチメディア処理の研究に従事．
電子情報通信学会，計量国語学会，日本ソフトウェア科学会，AAAI各会員．
}
\end{biography}

\biodate


