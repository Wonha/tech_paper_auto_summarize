評価実験
\label{chp:experiments}

本研究で開発した用語抽出システムの性能を評価するため，MedNLPテストコレ
クションを用いて評価を行った．次節以降で，基本素性（形態素，品詞，品詞
細分類，字種，基本形）の評価，モダリティ素性の評価，主要語語彙制限およ
び拡張マッチングの有効性の評価を行う．さらに，すべての素性に加えて後処
理ルールを適用した提案システム全体の性能を評価し，MedNLPタスクの参加シ
ステムである従来手法との比較を行う．


\subsection{実験設定}

実験に使用したMedNLPテストコレクションは，病歴要約50文書からなり，全デー
タの3分の2にあたる2,244文が訓練データ，残りの1,121文が評価用のテストデー
タとなっている．訓練データにアノテーションされた情報は，患者の個人情報
と診療情報である．本研究では，これらのうち，患者の症状と医師の診断を指
す診療情報（症状・診断名）を対象とする．各症状・診断名には医師の認識の
程度などを表すモダリティ属性が定義されており，それぞれ症状の罹患の肯定，
否定，可能性の存在を表すpositive，negation，suspicionに加え，症状が患者
の家族の病歴として記述されていることを表すfamilyの4種類からなる．各モダ
リティ属性が付与された症状・診断名を異なるカテゴリの固有表現とみなして
学習を行うことで，モダリティ属性の分類を含めた抽出を行う．

評価は，MedNLPタスクで行われたのと同様に，モダリティ属性を考慮する方法
と，考慮しない方法の2通りで行う．前者は，抽出された固有表現が正しい属性
に分類された場合にのみ正解とみなす評価であり，後者は，属性が誤っていて
も，抽出された固有表現の範囲がアノテーションされた正解情報と一致してい
れば正解とみなす評価である．それぞれの評価方法について，適合率，再現
率，$F$値を評価尺度として用いる．

CRFで学習を行う際に必要となる正則化のためのハイパーパラメータ$c$につい
ては，訓練データでの5分割交差検定により値を決定した．テストデータに対す
る抽出を行うまでの具体的な手順は以下の通りである．
\begin{itemize}
\item[1.] $c$の値を変化させながら，各$c$の値について訓練データで5分割交差検定を行い，
 5回の検定における各精度（適合率，再現率，$F$値）の平均をそれぞれ算出する．
\item[2.] $c$の値の中で，最も$F$値が高い結果となったものを最適値とする．
\item[3.] 得られた$c$の最適値を用いて，訓練データ全体で学習を行い，モデルを学習する．
続いて，学習で得られたモデルを用いてテストデータで抽出を行う．
\end{itemize}
なお，主要語の語彙制限および修飾語獲得の際の閾値については，次のように決定した．
MEDIS病名マスターの語彙制限では，
$n_\mathrm{out}\in\{3,5,8\}$，$r_\mathrm{out}\in\{0.5,0.7,0.9\}$の各組について，
ハイパーパラメータ$c$の値を変えながら，それぞれ訓練データで交差検定を行い，
最も$F$値が高かった$n_\mathrm{out}$，$r_\mathrm{out}$，$c$の値の組合せを
最適値としてテストデータでの評価に用いた．
MedNEの語彙制限については$n_\mathrm{in}\in\{3,5,8\}$，$r_\mathrm{in}\in\{0.5,0.7,0.9\}$とし，
MEDISおよびMedNEからの修飾語獲得については$f_\mathrm{min}\in\{1,2,3,5,8,10\}$として
，同様に最適値を決定した．
その結果，$n_\mathrm{out}=n_\mathrm{in}=3$，$r_\mathrm{out}=0.7$，$r_\mathrm{in}=0.5$，
$f_\mathrm{min}=3$ (MEDIS)，$f_\mathrm{min}=3$ (MedNE) が最適値として得られた．

また，素性のウィンドウサイズについては，基本素性（形態素，品詞，品詞細分類，
字種，基本形）を素性セットとしたモデルを用いて次のように決定した．
サイズは各素性について共通の値を使用することにし，候補を3（$-1$から1），
5（$-2$から2），7（$-3$から3），9（$-4$から4）の4通りとした．続いて，
サイズおよびハイパーパラメータ$c$の値を変えながら，訓練データで交差検定を
行ったところ，サイズ5において最大の$F$値が得られ，この値を最適値とした．
次節以降，サイズ1で固定しているモダリティ素性を除き，すべての素性に関して
サイズ5として実験を行った結果を報告する．


\subsection{基本素性の有効性の評価}
\label{sec:exp_basic}

形態素，品詞，品詞細分類，字種，基本形からなる素性セットを基本素性とし，
これら5つの素性の有効性の評価を行った．各素性に対するテストデータでの精
度を表\ref{tab:basic_features}に示す．表中の``P''，``R''，``F''はそれぞ
れ適合率，再現率，$F$値を意味し，``2-way''はモダリティ属性を考慮しない
場合の精度，``Total''は考慮した場合の精度を表す．なお，表には，各素性セッ
トに対して30回行った試行の平均精度を記載した．次節以降の実験結果につい
ても同様である．直前の行中の素性セットを用いた場合との差について両
側$t$検定を行い，有意水準1\%で有意であった場合に``$^\star$''を付した．

\begin{table}[b]
 \caption{基本素性の評価}
 \label{tab:basic_features}
\input{01table03.txt}
\end{table}

品詞素性の導入により，2-way，Totalの両評価で，適合率が4ポイント前後向上
し，再現率が1.5〜2ポイント程度向上した．訓練データでは\footnote{テスト
  データについてはアノテーションされた情報が提供されていないため，訓練
  データでの分析を元にして実験結果への考察を行った．したがって，本節以
  降で述べる各素性における固有表現，非固有表現等の割合は，いずれも訓練
  データで算出した数値である．}，名詞，接頭詞であるトークンのうちのそれ
ぞれ20\%弱，30\%弱が固有表現（を構成するトークン）であり，残りの品詞に
ついては，いずれも97\%以上が非固有表現であった．したがって，品詞が名詞
または接頭詞であることが固有表現である可能性を示す手がかりとなり，その
他の品詞であることが固有表現でないことを示すほとんど確実な手がかりとなっ
たと考えられる．

品詞細分類素性の導入では，両評価とも多少の適合率の低下が見られたものの，
それを上回る2.5ポイント前後の再現率の向上が得られた．名詞の細分類全体の
約30\%に相当する「数」では，その99\%以上が非固有表現であり，合わせて名
詞の約50\%に相当する「一般」，「サ変接続」，「接尾・一般」は，
各20〜40\%を固有表現が占めた．
したがって，名詞の中のどの細分類であるかという情報が精度向上に寄与したと考えられる．

字種素性の導入による主な変化として，2-way，Totalでの適合率がそれぞ
れ0.3ポイント程度向上した．固有表現が大きな割合を占めた字種は，「漢字」
と「カタカナ」で，それぞれ30\%強，20\%強の割合であった．ただ，接頭詞お
よび名詞／接尾・一般の100\%近い割合を「漢字」が占めるなど，品詞や品詞細
分類素性と重複している情報も多い．名詞／一般，名詞／サ変接続のそれぞ
れ85\%程度が「漢字」と「カタカナ」となっており，字種素性がこれらの品詞
細分類を詳細化する役割を果たしたと考えられる．

基本形素性の導入の結果，主にTotalでの適合率，再現率が向上した．
「ない」「なかった」など表層が異なるモダリティ表現を基本形で同一視することで，
モダリティ属性を考慮した評価の結果が向上したと考えられる．


\subsection{モダリティ素性の有効性の評価}
\label{sec:exp_mdlfeat}

モダリティ素性の有効性を評価するため，基本素性のみを用いたシステム
（Basic；表\ref{tab:basic_features}の最下行と同一のシステム）と，基本素
性に加えてモダリティ素性を用いたシステム ($\text{Basic} + \text{Modality}$) の精度の比
較を行った．テストデータにおける各モダリティ属性および全体の精度を
表\ref{tab:mod_features}に示す．なお，モダリティ属性とは，症状・診断名
に付加されているモダリティの種類（positive，negation等）を指し，モダ
リティ素性は，モダリティ属性を捉えるために用いた素性を指す．
Basicと$\text{Basic} + \text{Modality}$ との差について両側$t$検定を行い，有意水
準1\%で有意であった場合に``$^\star$''を付した．

\begin{table}[b]
 \caption{モダリティ素性の評価}
\label{tab:mod_features}
\input{01table04.txt}
\end{table}

各属性における適合率と再現率は，negationとsuspicionの適合率を除いて，モ
ダリティ素性導入後の方が同等か高いという結果が得られた．属性全体
 (``All (total)'') で見ても各精度は向上しており，本素性が正確なモダリティ
属性の認識に寄与したといえる．なお，本素性の導入前，後ともに，他の属性
に比べてsuspicion属性の精度が低いのは，データのアノテーション誤りに起因
すると考えられる．著者らが訓練データを確認したところ，「疑い」などの表
現が後続する固有表現で，suspicionという属性が付与されていない
（positiveとなっている）事例が十数件存在し，suspicionの事例全体の十数パー
セントという少なくない割合を占めていた．

一方，モダリティ属性を考慮しない2-wayの評価では，適合率が1ポイント弱低
下した．「〜がない」などの表現は固有表現でない語句の後方にも出現するた
め，非固有表現を誤って固有表現と認識してしまうケースが増加し，適合率低
下の原因となったと考えられる．


\subsection{主要語辞書および修飾語辞書利用の有効性の評価}

主要語語彙制限および拡張マッチングの有効性を評価するため，基本素性のみ
のシステム (Basic) と，基本素性に加えて各種辞書に基づく辞書素性を用いた
システムの比較を行った．結果を表\ref{tab:dic_features}にまとめる．最左
列は利用した辞書を示しており，``main($X$)''は辞書$X$を主要語辞書として
使用したことを，``$\lhd$ modify($X$)''は辞書$X$を修飾語辞書として拡張マッ
チングを行ったことを意味する．辞書$X$に対し
て，\ref{sec:maindic_filtering}節の方法による語彙制限を行っていないもの
を``$X$-r'' (raw)，行ったものを``$X$-f'' (filtered) で表し，辞書$X$か
ら獲得した修飾語集合を``$X$-s'' (substring) で表した．また，``$X\cup
Y$''で 2 つの辞書$X$，$Y$を統合した辞書を表した．数値右上のシンボルは両
側$t$検定によって有意水準1\%で有意差があった場合に付してお
り，``$\dagger$''が(a)と(b)または(c)との比較，``$\ddagger$''が(b)と(d)と
の比較，``$\star$''が(c)と(e)との比較，``$\S$''が(e)と(f)または(g)との比
較の結果を示している．

\begin{table}[b] 
 \caption{辞書素性の評価}
\label{tab:dic_features}
\input{01table05.txt}
\end{table}

まず，語彙制限を行っていない辞書を単純に利用した場合，MEDIS病名マスター
（表中のMDM；MEDIS Disease Name Master）に基づく辞書素性を導入し
た(b)で，2-wayの評価において適合率・再現率が0.7〜1.5ポイント程度向上し，
その結果，$F$値が約1.1ポイント向上した．Totalにおいても$F$値が向上した
ものの，2-wayよりは効果が小さく，認識された症状・診断名の中にモダリティ
属性の分類に誤ったものが含まれることが示唆される．なお，2-wayとTotalの
いずれの場合も，$F$値の向上は統計的に有意であった．一方，MedNE（表中
のMNE）を追加した場合(c)では，再現率が大きく低下した．訓練データでの交
差検定では96\%を超える$F$値となっており，正解ラベルとほぼ一致する辞書素
性に基づく過学習が起こり，他の素性の情報が学習されなかった可能性が高
い．

上記のような問題を避けるため，次に語彙制限を行った主要語辞書を使用した．
結果を見ると，MEDISのみの(d)では全体的に$F$値がわずかに低下した．これ
は，MEDIS病名マスターから獲得した主要語については語彙制限の必要性が薄い
ことを示している．一方，MEDISに加えてMedNEにも語彙制限を加えた(e)では，
語彙制限を加えない(c)に比べて適合率，再現率，$F$値とも大幅に向上した．
モダリティ属性まで考慮したTotalでは(b)よりもわずかに精度が低いものの，
モダリティ属性を考慮しない2-wayの評価では，これまでの設定で最も良い結果
が得られた．

最後に，語彙制限を加えた主要語辞書(e)に加えてさらに拡張マッチングを適用
した．その結果，MEDISから獲得した修飾語辞書のみを使用し
た(f)で約0.5〜0.6ポイント，MedNEから獲得した修飾語辞書を併せて使用し
た(g)で約0.6〜0.7ポイントの$F$値の向上が見られ，修飾語辞書の導入・語彙
増加にともない，わずかながらも着実な認識精度の向上が得られた．


\subsection{システム全体の性能および従来手法との比較}

\begin{table}[b]
\caption{従来手法との比較}
\label{tab:compare_other}
\input{01table06.txt}
\end{table}

基本素性，辞書素性，モダリティ素性，後処理ルールを含めたシステム全体の
性能の評価を行った．テストデータでの精度を表\ref{tab:compare_other}
(a)に示す．基本素性に加えて語彙制限後の 2 つの辞書と修飾語辞書に基づく辞
書素性を導入したシステム（表\ref{tab:dic_features}の最下行(g)のシステム）
をModifyとし，モダリティ素性の追加，後処理ルールの適用をそれぞ
れModality，P-rulesで表した．なお，モダリティ素性と後処理ルールはモダリ
ティ属性まで含めた分類 (Total) において利用する．表中のシンボル
``$\dagger$''はModifyと $\text{Modify}+\text{P-rules}$，
``$\ddagger$''はModifyと $\text{Modify}+\text{Modality}$ を，``$\star$''は
$\text{Modify}+\text{Modality}$ と $\text{Modify}+\text{Modality}+\text{P-rules}$ を比較した際
，両側$t$検定で有意水準1\%の有意な差があったことを示している．

モダリティ素性の導入後には，適合率，再現率，$F$値がそれぞれ1ポイント前
後向上し，その効果が確認された．
また，後処理ルールについては，Modifyに適用した場合で$F$値で1ポイント
の向上，$\text{Modify}+\text{Modality}$ に適用した場合で0.7ポイント程度の向上が得られた．
すなわち，CRFによって症状・診断
名と認識された語句に対してのみモダリティ属性を修正する処理を行うこと
で，症状・診断名の認識精度を維持したまま，モダリティ属性分類誤りを減少でき
ている．

なお，後処理ルールの効果を確認するため，訓練データを使用して
\footnote{テストデータへのアノテーションの情報は提供されていないため，
\ref{sec:exp_basic}節と同様に，訓練データでの分析を元に考察を行った．
5分割交差検定の5回分のテスト結果に対して，後処理ルールを適用した結果を
合計した値を報告する．}，
Modify および $\text{Modify}+\text{Modality}$の推定結果に後処理ルールを適用した場合の
正解数の変化について表\ref{tab:prules_effect}に示した．
\mbox{``対}象件\mbox{数''}はルール適用の対象となった固有表現の件数で，システムが正例と
推定した固有表現の数に相当する．また，``T$\rightarrow$F''，``F$\rightarrow$T''
および``F$\rightarrow$F''は，ルール適用前に正解 (T)／不正解 (F) で
あったものが，ルール適用後に正解／不正解に変化した件数を表す．``合計''は
これら 3 つの値の合計で，ルールが適用された件数に相当する
（``T$\rightarrow$T''となったもの，
つまり，モダリティ属性が変化しなかったものについては，件数に含めていない）．
Modifyに適用した場合では，適用対象件数の5\%弱にあたる81件に対してルール
が適用された．適用された事例のうち，実際に固有表現であった事例に対する
正解率は80\%程度であった．$\text{Modify}+\text{Modality}$ に関しては，
モダリティ素性の導入により周辺文脈と矛盾するモダリティ属性の推定結果が減った
と考えられ，ルールが適用された件数自体が減少した．
しかし，ルールの適用により僅かながら正解数が増加している．

\begin{table}[b]
 \caption{後処理ルール適用の効果}
\label{tab:prules_effect}
\input{01table07.txt}
\end{table}

表\ref{tab:compare_other} (a) の下半分には，MedNLP症状と診断タスクの成
績上位3チームであるMiuraら\cite{miura2013incorporating}，Laquerreら
\cite{laquerre2013necla}およびImaichiら\cite{imaichi2013comparison}のシ
ステムの精度を掲載した．従来手法の中では，Totalの適合率を除き，いずれ
もMiuraらのシステムの精度が最も高い．これに対し，Totalの評価で比較する
と，本システムは適合率を中心に従来手法よりも高く，モダリティ素性と後処
理ルールを併用したシステム ($\text{Modify} + \text{Modality} + \text{P-rules}$) では，適合率，
再現率，$F$値ともに最も高くなっている．また，提案システムと従来手法の中
で精度が高いMiuraらのシステムについて，モダリティ属性ごとの精度を
表\ref{tab:compare_other} (b)に掲載した．Miuraらのシステムで
はpositiveおよびnegationの再現率が高く，多数派クラスの網羅的な抽出の点
で優れている．しかし，適合率ではどの属性についても本システムの方が高
く，特に，少数派クラスであるsuspicion，familyの認識では，適合率，再現率
ともに大きく上回っている．したがって，モダリティ属性の分類を含めた抽出
では，従来手法と比べて，我々の手法が最も正確な用語抽出を実現できており，
事例数の少ないクラスに対して頑健な推定を実現できているといえる．

一方，表\ref{tab:compare_other} (a)における2-wayの評価では，特に，再現
率がMiuraらのシステムと比べて3ポイントほど低く，本システムは症状・診断
名抽出の網羅性の点で劣っている．修飾語の付加を行う拡張マッチングでは，
主要語が主要語辞書に含まれない場合には対応できないという限界があるため，
再現率を高めるには，コーパスから修飾語だけでなく新たな主要語も獲得する
方法が必要となる．また，診療記録中の症状・診断名と共起しやすい「〜出現」
「〜増悪」などの表現は，未知の主要語を認識する際の手がかりとして有効利
用できる可能性がある．


