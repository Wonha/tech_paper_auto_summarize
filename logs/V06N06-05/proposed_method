Hearstの手法を用いた章・節レベルの話題境界の認定
\label{sect:Hearst法}

本章では、提案手法のベースになっているHearstの話題境界認定手法\cite[以
下Hearst法と称する]{PACL-32-P9}を紹介し、それを章・節レベルの大きな話
題の境界の認定に適用した実験の結果を示す。そして、実験結果に基づき
Hearst法の問題点を議論する。

\subsection{Hearst法による話題境界の認定}

Hearst法では、まず、文書中の各位置の前後に、段落程度の大きさ(120語程度)
の窓を設定し、その2つの窓にどれくらい同じ語彙が出現しているかにより、2
つの窓内の部分の類似性を測定する。類似性は、次に示す余弦測度(cosine
measure)\footnote{「コサイン・メジャー」とカナ書きされることも多いが、
  長過ぎて読みにくいので、本稿では「余弦測度」と訳した。}で測定してい
る。

\[
sim(b_{l}, b_{r}) = \frac{\Sigma_{t} w_{t,b_{l}} w_{t,b_{r}}}
{\sqrt{\Sigma_{t} w_{t,b_{l}}^{2} \Sigma_{t} w_{t,b_{r}}^{2}}}
\]

\noindent{}
ここで、$b_{l}$, $b_{r}$は、それぞれ、左窓(文書の冒頭方向側の窓)、右窓
(文書の末尾方向側の窓)に含まれる文書の部分であり、$w_{t,b_{l}}$,
$w_{t,b_{r}}$は、それぞれ、単語$t$の左窓、右窓中での出現頻度である。こ
の値は、前後の窓に共通語彙が多く含まれるほど大きくなり(最大1)、共通語
彙が全くない時に最小値0をとる。つまり、この値が大きい部分は、前後の窓
で共通の話題を扱っている可能性が高く、逆に、この値が小さい部分は、話題
の境界である可能性が高いことになる。本稿では、この値を結束度(cohesion
score)と呼ぶことにする。また、結束度に対応する窓の境界位置を結束度の基
準点(reference point)と称し、基準点によって結束度を並べたものを結束度
系列(cohesion score series)と称することにする。

Hearst法は、上記の結束度を文書の冒頭から末尾まで、ある刻み幅(20語)で基
準点をずらしながら測定し、極小となる位置を話題境界と認定する。ただし、
結束度の細かい振動を無視するために、極小点$mp$の周囲で単調減少(極小点
の左側)／単調増加(極小点の右側)している部分を切りだし、その開始点$lp$
と終了点$rp$における結束度$C_{lp}, C_{rp}$と結束度の極小値$C_{mp}$との
差を基に以下のdepth scoreと呼ばれる値$d$を計算し、極小点における結束度
の変動量の指標としている。そして、$d$が閾値$h$を越えた極小点だけを話題
境界として認定している\footnote{結束度が大きく落ち込んだ部分がより話題
  境界である可能性が高いと考えることに相当。}。

\begin{eqnarray*}
  d &=& (C_{lp} - C_{mp}) + (C_{rp} - C_{mp}) \\ 
  h &=&  \bar{C} - \sigma/2 \\
\end{eqnarray*}
\noindent{}
ここで、$\bar{C}, \sigma$は、それぞれ、文書全体における結束度$C_p$の平
均値と標準偏差である。

\subsection{Hearst法に基づく大きな話題の認定実験}
\label{sect:大きな話題の認定実験}


Hearst法は、上記のように、結束度計算用窓の幅の2倍の範囲における語彙の
繰り返し状況を手がかりに、話題境界を認定する手法である。
\cite{PACL-32-P9}では数段落程度の大きさの話題のまとまりしか認定を試み
ていないが、\cite{PACL-32-P9}より大きな幅の窓を用いれば大きな話題のま
とまりを認定できる可能性がある。大きな話題に関連する語(特に名詞)は大き
な間隔で繰り返される傾向があるので\footnote{\cite{BABA.T-86}の反復距離
  (繰り返される語彙の出現間隔の平均値)の分析や\cite{CL-V17N1P21}の語彙
  連鎖の再開(chain return)の観察など参照。}、窓幅を大きくとって大きな
間隔で繰り返される語彙の出現状況を反映した結束度を計算すれば、大きな話
題に関する話題境界が得られる可能性がある。また、窓幅を大きくとれば余弦
測度の計算式の分母が大きくなり、小さい間隔で繰り返される語による結束度
の変動は小さくなると考えられるので、小さい話題に関する話題境界の検出も
ある程度抑制できると考えられる\footnote{Hearst法の類似手法により記事境
  界の認定を試みた研究\cite{NLC93-63}にも、「ウィンドウサイズが大きく
  なると検出されるテキスト構造も大局的になるようである」とのコメントが
  ある。}。

そこで、Hearst法で大きな話題のまとまりを認定できるかを調べるために
\cite{PACL-32-P9}より巨大な(10〜5倍程度)窓幅で計算した結束度により話題
境界を認定する実験を行った。実験文書としては、(社)電子工業振興協会『自
然言語処理システムの動向に関する調査報告書』(平成9年3月)の第4章「ネッ
トワークアクセス技術専門委員会活動報告」(pp.~117--197)を用いた。この文
書は、4.1節から4.4節の4節からなり、1,440文(延べ17,816内容語\footnote{
  動詞・名 詞・形容詞のいずれか。詳細については\ref{sect:単語認定}節で
  説明する。})を含んでいる。


図\ref{fig:Hearst法:1280語窓}と図\ref{fig:Hearst法:640語窓}は、この実
験の結果であり、以下のグラフを文書中での位置(文書の冒頭からその位置ま
での延べ語数)を横軸にとって示してある。

\begin{itemize}
\item 点線の棒グラフは、実験文書の節の開始位置である。長い点線ほど大き
  い節と対応する。
\item 折れ線グラフ(◇)は結束度系列である。結束度は、
  図\ref{fig:Hearst法:1280語窓}では1280語幅の窓、図\ref{fig:Hearst法:
    640語窓}では640語幅の窓によって、それぞれ窓幅の1/8(160語と80語)刻
  みで計算し\footnote{先頭の7点では、左窓に窓幅分の語数がないが、構わ
    ず左窓中の語数が少ないままで計算した。文書の末尾も同様。}、プロッ
  トした。
\item 実線の棒グラフ(＊)は、結束度の極小点で計算したdepth score $d$で
  ある。また、実線の水平線はdepth scoreの閾値$h$である。
\end{itemize}

\begin{figure}[htbp]
  \begin{center}
    \leavevmode
    \epsfile{file=fig/88_ue_250.eps,width=120mm}
    \caption{窓幅1280語のHearst法による話題境界}
    \label{fig:Hearst法:1280語窓}
  \end{center}
  \begin{center}
    \leavevmode
    \epsfile{file=fig/88_sita_250.eps,width=120mm}
    \caption{窓幅640語のHearst法による話題境界}
    \label{fig:Hearst法:640語窓}
  \end{center}
\end{figure}

\subsubsection{Hearst法の検討}\label{sect:Hearst法の検討}

これらの図に見られるように、結束度の極小点は節境界とよく一致しており、
窓幅の大きい結束度を使うと大きな話題の切れ目が認定でき、窓幅の小さい結
束度を使うと小さい話題の切れ目が認定できるという傾向がある。よって、大
きな窓幅(の結束度)で認定した話題境界と、小さい窓幅で認定した話題境界を
組み合わせれば、大きな話題(主題)のまとまりの中に、小さな話題(副主題)の
まとまりがある、というような話題の階層構成が認定できる見込みがある。

しかし、Hearst法には、次のような問題点がある。

ひとつは、大きな話題と小さな話題の区別が難しいことである。
図\ref{fig:Hearst法:1280語窓}に見られるように、depth scoreは結束度の局
所的変化の激しさを示す値であるので、話題の大きさとは直接関係しない。例
えば、図\ref{fig:Hearst法:1280語窓}の12,000語の手前にある4.4節の開始位
置は、14,000語付近にある、4.4.2節と4.4.3節の開始位置より大きい話題の境
界であると考えられるが、depth scoreの値は、後者の方が大きくなっている。
これは、図の矢印で示した部分の結束度の小さな谷により、4.4節の開始位置
付近の結束度の落差が2つのdepth scoreに分散してしまったことによる。

また、このようなdepth scoreの不安定さにも関係して、depth scoreの閾値の
設定が難しいという問題もある。図\ref{fig:Hearst法:1280語窓}、
\ref{fig:Hearst法:640語窓}では、前述の閾値$h$を用いたが、
図\ref{fig:Hearst法:1280語窓}を見る限り、閾値をもっと下げた方がよいよ
うに思える。例えば、もうほんの少し閾値を下げれば、2,000語の手前にある
4.2.2節の開始位置なども話題境界として認定することができる。あるいは、
全ての結束度の谷を話題境界と認定してもよいようにも思える。しかし、閾値
を下げ過ぎてしまうと、図\ref{fig:Hearst法:640語窓}の8,000語〜10,000語
付近の幅の狭い山による境界も全て話題境界として認定されてしまう。このた
め、話題の大きさを区別して認定する場合には、何らかの経験的制約が必要に
なる可能性が高い。実際、\cite{PACL-32-P9}には、60語以内の隔たりしかな
い境界は認めない、というヒューリスティックスが示されている。

なお、depth scoreの不安定性は、Hearst自身も認識しており、結束度を平滑
化\footnote{本稿で移動平均と呼んでいる操作を何回か繰り返す。}してから
depth scoreを求める手法を別の論文\cite{CL-V23N1P33}で示している。ただ
し、Hearstの目標が数段落程度の大きさの話題の転換点の発見にあるためか、
話題の大きさの区別に関する議論は見当たらない。

語彙的結束性に基づく話題の階層構成の認定手法
\label{sect:話題構成認定手法}

本章では、話題の階層構成を同一語彙の繰り返しだけを手がかりに認定する手
法を提示する。本手法は、以下の手順で話題の階層構成を認定する。

\begin{enumerate}
\item 話題境界位置の区間推定\label{item:話題境界の区間推定}

  ある窓幅で計算した結束度に基づき、話題境界が存在しそうな位置を、話題
  境界候補区間として求める。そして、大きさの異なる複数の窓幅に対してこ
  の処理を繰り返し、大きな話題の切れ目を示す境界から小さな話題の切れ目
  を示す境界まで、話題の大きさ別に話題境界候補区間を求める。

\item 話題の階層関係の認定

  異なる窓幅により求めた話題境界候補区間を統合し、話題の階層構成を決定
  する。
\end{enumerate}

以下、\ref{sect:話題境界の区間推定法}節でHearst法をベースに、話題のま
とまりを大きさ別に認定可能にした話題境界位置の区間推定手法の詳細を説明
し、\ref{sect:話題の階層関係の認定手法}節で話題の階層関係の認定手法に
ついて説明する。

\subsection{結束度の移動平均に基づく話題境界の位置の区間推定手法}
\label{sect:話題境界の区間推定法}

提案手法では、結束度の移動平均(moving average)を用いて話題境界の位置を
区間推定する。移動平均は、時系列分析(time series analysis)で、細かい変
動を取り除いて大局的な傾向を把握するために用いられる手法である。提案手
法では、細かい変動を無視するためだけでなく、結束度系列の移動平均値を、
移動平均の開始点における「順方向結束力(forward cohesion force)」および
移動平均の終了点における「逆方向結束力(backward cohesion force)」とみ
なし、その差を話題境界候補区間の認定の直接的手がかりとしている。この手
法の原理について、図\ref{fig:移動平均と結束力}を使って説明する。

\subsubsection{結束度系列の定義}

まず準備として、「結束度系列」を図\ref{fig:移動平均と結束力}(a)によっ
て定義する。図\ref{fig:移動平均と結束力}(a)で、文書領域$1$〜$8$は、結
束度を計算する刻み幅$tic$(語)に対応する一定幅の領域である。$c_3$は、文
書中の$3$と$4$の境界を基準点として計算した窓幅$w$(語)の結束度である。
次の$c_4$は、窓を一定幅$tic$分だけ右(文書の末尾方向)へずらして計算した
結束度である。このようにして計算した$c_3, c_4, c_5, \ldots$を、以後、
文書の冒頭から末尾へ向かう窓幅$w$の結束度系列と呼ぶ。

\begin{figure}[htbp]
  \begin{center}
    \leavevmode
    \begin{tabular}{ccccccccc}
      
      結束度 &  \multicolumn{8}{c}{文書の領域} \\
      \cline{2-7}
      $c_3$  & \multicolumn{1}{|c}{1} & 2 & \multicolumn{1}{c|}{3}
      & 4 & 5 & \multicolumn{1}{c|}{6} & 7 & 8 \\
      \cline{2-8}
      $c_4$  & 1 & \multicolumn{1}{|c}{2} & 3 &  \multicolumn{1}{c|}{4} 
      & 5 & 6 & \multicolumn{1}{c|}{7} & 8 \\
      \cline{3-9}
      $c_5$   & 1 & 2 & \multicolumn{1}{|c}{3} & 4 &  \multicolumn{1}{c|}{5} 
      & 6 & 7 & \multicolumn{1}{c|}{8} \\
      \cline{4-9}
      \multicolumn{3}{c}{}
            & \multicolumn{1}{l}{$\leftarrow$}
            & \multicolumn{1}{c}{$w$語}
            & \multicolumn{1}{r}{$\rightarrow$}
            & \multicolumn{1}{l}{$\leftarrow$}
            & \multicolumn{1}{c}{$w$語}
            & \multicolumn{1}{r}{$\rightarrow$} \\
    \end{tabular}\\
    (a) 結束度の系列\\
    \medskip{}
    \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
      \hline
      \multicolumn{1}{|c|}{結束度の}  & \multicolumn{9}{|c|}{文書の領域が関与した数} \\
      \cline{2-10}
      \multicolumn{1}{|c|}{移動平均}  & \multicolumn{1}{c|}{領域} & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 \\
      \hline
      3項平均
      & 左窓 & 1 & 2 & {\bf 3} & 2 & 1 & 0 & 0 & 0 \\
      \cline{2-10}
      $\frac{c_3+c_4+c_5}{3}$
      & 右窓 & 0 & 0 & 0 & 1 & 2 & {\bf 3} & 2 & 1 \\
      \hline
      2項平均
      & 左窓 & 1 & 2 & {\bf 2} & 1 & 0 & 0 & 0 & 0 \\
      \cline{2-10}
      $\frac{c_3+c_4}{2}$
      & 右窓 & 0 & 0 & 0 & 1 & {\bf 2} & 2 & 1 & 0 \\
      \hline
    \end{tabular}\\
    \medskip{}
    (b)  結束度系列の移動平均に対する文書領域の関与\\
    \medskip{}
    \caption{順方向結束力と逆方向結束力の意味}
    \label{fig:移動平均と結束力}
  \end{center}
\end{figure}

\subsubsection{順方向結束力と逆方向結束力の定義}


順方向結束力と逆方向結束力の求め方と意味を図\ref{fig:移動平均と結束力}
(b)を使って説明する。図\ref{fig:移動平均と結束力}(b)は、移動平均の値と
文書領域との関係を示した表である。例えば、表の左上角の領域1の直下の値
(1)は、$c_3$〜$c_5$の3項の移動平均($\frac{c_3+c_4+c_5}{3}$)に対して、
文書領域$1$が１度だけ($c_3$の計算において)左窓の一部として関与したこと
を示している(図\ref{fig:移動平均と結束力}(a)の$c_3$の部分を参照)。

結束度は、境界の前後の結び付きの強さを表す指標であるので、領域$1$を左
窓に含む$c_3$を移動平均した値も、領域$1$がそれより右側の部分に結びつい
ているかどうかを示す指標のひとつと考えられる。言い換えれば、移動平均の
値は、移動平均をとった結束度の左窓部分の領域($c_3$〜$c_5$の3項平均に対
しては$1$〜$5$)が文書の末尾へ向かう方向(順方向:図では右方向)に引っ張ら
れる強さの指標(順方向結束力)とみなせる。一方、逆に、移動平均をとった結
束度の右窓部分の領域(同$4$〜$8$)が文書の冒頭方向(逆方向:図では左方向)
に引っ張られる強さの指標(逆方向結束力)ともみなせる。

ここで、結束力と文書領域の関連性を考察すると、個々の結束度の計算におい
て多くの窓に含まれていた領域ほど、その移動平均値である結束度への関与が
強いと考えられる。また、語彙的結束性は、近傍で繰り返される語彙によるも
のほど強いと考えられるので、移動平均をとった結束度の基準点(左右の窓の
境界)に近い領域ほど結束力に強く関与しているといえる。これに基づき、表
にあげた3項平均と2項平均について、移動平均に最も強く関与している部分を
選ぶと、左窓についてはどちらも$3$、右窓については、それぞれ$6$、$5$と
なる。

以上の考察に基づき、話題境界の候補区間の認定では、結束度の移動平均を、
移動平均をとった部分の最初の基準点における順方向結束力、最後の基準点に
おける逆方向結束力として取り扱う。

\subsubsection{話題境界の区間推定アルゴリズム}

\begin{figure}[htbp]
  \begin{center}
    \fbox{
    \begin{minipage}{0.95\textwidth}
      
    \leavevmode
    \begin{enumerate}\itemsep=0pt
    \item 以下のパラメータを設定する:
      \begin{itemize}\itemsep=0pt
      \item 結束度を計算する刻み幅(語数) $tic$
      \item 移動平均をとる項数 $n$
      \item 移動平均をとる幅(語数) $d \equiv (n-1)\times tic$
      \end{itemize}
    \item 順方向結束力と逆方向結束力の計算
      
      文書中の各位置$p$について、$p$以降$d$語の範囲で結束度系列の移動
      平均をとり、\\
      位置$p$の順方向結束力(かつ、位置$(p+d)$の左逆方向束力)として記録
      する。

    \item 結束力拮抗点の認定

      $(順方向結束力-逆方向結束力)$の値を文書の冒頭から末尾に向かって調べ、\\
      負から正に変化する位置を結束力拮抗点として記録する。

    \item 話題境界候補区間の認定
      
      それぞれの結束力拮抗点について、その直前$d$語以内の範囲で、順方
      向結束力が\\
      最小となる位置$mp$を求め、$[mp, mp+d]$を話題境界候補区間と認定す
      る。
    \end{enumerate}
    \end{minipage}
    }
    
    \caption{話題境界の区間推定アルゴリズム}
    \label{fig:話題境界候補区間認定方法}
  \end{center}
\end{figure}

話題境界は、順方向結束力と逆方向結束力の差に基づいて、図\ref{fig:話題
  境界候補区間認定方法}に示した手順で認定する。話題境界の区間推定の2つ
の独立パラメータ、移動平均をとる幅$d$(語)と結束度系列の刻み幅$tic$(語)
の目安は、$d$が窓幅の1/2〜1倍程度、$tic$が窓幅の1/8程度である。

順・逆方向の結束力の差によって話題境界位置の候補区間を認定する意味を、
図\ref{fig:話題境界の候補区間}を使って説明する。図では、順・逆方向の結
束力の差が0になる点、すなわち結束力拮抗点(cohesion force equilibrium
point)を、ep1〜ep3の破線の鉛直線で示した。最初の点ep1の左側では、逆方
向結束力(BC)が優勢であり、その右側から次の点ep2までは順方向結束力(FC)
が優勢で、それ以後最後の点ep3までは逆方向結束力(BC)が優勢である。これ
は、ep1(負の結束力拮抗点)の左側の領域は、それより左側(文書の冒頭方向側)
のいずれかの部分へ向かって結束し、また、ep2(正の結束力拮抗点)の近傍で
は、ep2へ向かって結束していることに対応する。実際、順・逆方向の結束力
と共にプロットした結束度($C$)は、ep1とep3の近傍で極小値を、ep2の近傍で
極大値をとっている。

\begin{figure}[htbp]
  \begin{center}
    \leavevmode
   \epsfile{file=fig/93_ue_250.eps,width=120mm}

    \caption{結束力拮抗点と結束度の極値との関係}
    \label{fig:話題境界の候補区間}
  \end{center}
  \begin{center}
    \leavevmode
   \epsfile{file=fig/93_sita_250.eps,width=120mm}
    \caption{調査報告書の話題構成の認定結果}
    \label{fig:余弦測度による話題境界}
  \end{center}
\end{figure}

話題境界候補区間\footnote{図\ref{fig:話題境界の候補区間}内の大きい矩形
  領域。}に結束度系列の極小点が来ることは必然である。図\ref{fig:話題境
  界の候補区間}で最後の結束力拮抗点ep3の前後の矢印で示した部分で結束度
は極小値をとっている。よって、その部分の移動平均(図では4項平均)も通常
は極小値(ブロック矢印の先の部分)をとる\footnote{移動平均区間より狭い範
  囲の変動では、移動平均の平滑化作用により、結束力が極小値をとらないこ
  とがある。}。また、順方向結束力(FC)は移動平均の値を移動平均の開始位
置に記録したものあるので、順方向結束力の極小位置は結束度の極小位置の左
になる。同様に、逆方向結束力(BC)の極小位置は結束度の極小位置の右になる。
そして、結束度の変動が十分に大きければ、その間に結束力拮抗点が形成され
ることになる\footnote{結束度拮抗点の直前$d$語以内に順方向結束力の極小
  値が必ず存在することも、順・逆方向の結束力の相似性と結束力拮抗点の前
  後で順・逆方向の結束力の大小関係が入れ替わることから示せる(付録
  \ref{app:拮抗点と順方向結束力の関係})。}。

図\ref{fig:余弦測度による話題境界}に、本手法で認定した話題境界の候補区
間を窓幅別(縦軸)に示す。図の大きい矩形領域が話題境界候補区間であり、そ
の中にある小さい矩形領域が結束力拮抗点である。○付きの棒グラフで示した
話題境界など詳細については次節で説明する。

\subsection{話題の階層関係の認定手法}
\label{sect:話題の階層関係の認定手法}

\begin{figure}[htbp]
  \begin{center}
    \fbox{
    \begin{minipage}{0.95\textwidth}
    \begin{enumerate}
    \item 認定に使った窓幅の大きい順に話題境界候補区間データを並べ、話
      題境界候補区間の系列$B^{(n)}_{p}$を作成する。$n$は、話題境界候補
      区間の系列番号であり、最大窓幅の結束度系列から窓幅の大きい順に
      $1, 2, \ldots$と振る。$p$は、話題境界候補区間の系列内のデータ番
      号であり、結束力拮抗点の出現位置順に$1, 2, \ldots$と振る。各
      $B^{(n)}_p$のデータに以下のように名前をつける。

      \begin{tabular}{ll}
        $B^{(n)}_p.level$ & 話題境界のレベル。初期値は$n$。\\
        $B^{(n)}_p.range$ & 話題境界候補区間(図\ref{fig:余弦測度による話題境界}中の大きい矩形領域)。\\
        $B^{(n)}_p.ep$ & 結束度拮抗点(図\ref{fig:余弦測度による話題境界}中の小さい矩形領域)。\\
        $w_n$        & $B^{(n)}$の認定に使った結束度の窓幅。\\
        $d_n$        & $B^{(n)}$の認定に使った移動平均の幅。\\
      \end{tabular}

    \item $n$の小さい順に以下の処理を行う:
      \begin{enumerate}
      \item $p$の小さい順に以下の処理を行う:
        \begin{enumerate}
        \item $B^{(n)}_p$の話題境界候補区間$B^{(n)}_p.range$中に結束力
          拮抗点をもつ$B^{(n+1)}_q$で、$B^{(n+1)}_q.ep$が
          $B^{(n)}_p.ep$に最も近いものを求める。
        \item $B^{(n+1)}_q$が見つからなかった場合、以下の処理を行う:

          $B^{(n)}_p.range$内で窓幅$w_n$の結束度の最小位置$mp$を求め、
          新たな$B^{(n+1)}_q$を作成し、
          \begin{tabbing}
            $B^{(n+1)}_q.ep \leftarrow  [mp, mp]$\\
            $B^{(n+1)}_q.range \leftarrow [mp-d_{n+1}/2, mp-d_{n+1}/2]$
          \end{tabbing}
          と設定し、$B{^{(n+1)}}$の系列に挿入する。
        \item $B^{(n+1)}_q.level$ ← $B^{(n)}_p.level$
        \end{enumerate}
      \end{enumerate}
    \item $n$が最大(窓幅最小)の系列中のデータ$B^{(n)}_p$それぞれについ
      て、$B^{(n)}_p.range$内における窓幅$w_n$の結束度の最小位置$mp$
      (図\ref{fig:余弦測度による話題境界}中の〇付き棒グラフのx座標)を
      求め、$mp$と$B^{(n)}_p.level$を出力する。
    \end{enumerate}
    \end{minipage}}
    \caption{話題の階層関係認定アルゴリズム}
    \label{fig:話題階層関係認定アルゴリズム}
  \end{center}
\end{figure}

話題構成認定処理は、異なる窓幅の結束度系列による話題境界候補区間を統合
して、大きな窓幅の結束度系列から得られた大きな話題に関する境界と、小さ
い窓幅の結束度系列からのみ得られる小さい話題に関する境界を区別して出力
するものである。話題境界候補区間を統合する理由は、大きな窓幅の結束度系
列は、窓位置の移動に対して鈍感であり、それだけから認定すると境界位置を
十分精密に求めることができないからである。


図\ref{fig:話題階層関係認定アルゴリズム}に話題の階層関係認定アルゴリズ
ムを示す。(1)の話題境界のレベル($B^{(n)}_p.level$)は、認定境界がいずれ
の窓幅の結束度系列に基づく境界かを記録するための変数である。この変数に
は、(2)の操作により、それぞれの認定境界の近傍に極小値のある結束度系列
のうちで最も大きい窓幅の結束度系列の系列番号が設定される。
\ref{sect:Hearst法の検討}節で示したように、大きな窓幅の結束度系列に基
づく認定境界ほど、大きな話題の境界と対応するという傾向があるので、結果
として、それぞれの認定境界と対応する話題の大きさに相当する値が話題境界
のレベルとして設定されることになる。

(2)は、大きさの異なる窓幅で認定した話題境界候補区間を統合する操作であ
る。例えば、図\ref{fig:余弦測度による話題境界}の$B^{(2)}_4$の話題境界
候補区間(図\ref{fig:余弦測度による話題境界}中の大きい矩形領域)中に結束
度拮抗点(図\ref{fig:余弦測度による話題境界}中の小さい矩形領域
\footnote{理論的には点であるが、順方向結束力と逆方向結束力との差の符合
  が反転する地点を拮抗点とするので、差が負の点と差が正の点の組になる。})
のある$B^{(3)}$のデータは、$B^{(3)}_9$と$B^{(3)}_{10}$であり、
$B^{(2)}_4.ep$に近いものは$B^{(3)}_{10}$であるので、
$B^{(3)}_{10}.level$を次のように変更する。

\[ B^{(3)}_{10}.level ← B^{(2)}_4.level \]

図\ref{fig:余弦測度による話題境界}の○付き棒グラフは、このようにして求
めた話題境界である。棒グラフのx座標が最小窓幅の結束度系列の極小値$mp$
と対応し、棒グラフの長さが話題境界のレベル($B^{(n)}_p.level$)と対応(長
い程がレベル小)する。例えば、最大窓幅(5120語幅)の結束度系列による最初
の話題境界候補区間$B^{(1)}_1$の中に〇がある棒グラフは、最大窓幅(5120語
幅)以下全ての結束度系列によって検出され、(2)の操作により統合された、話
題境界のレベルが1の認定境界である。なお、図に示した最小窓幅(640語)の話
題境界候補区間でも、結束度拮抗点と話題境界が大きくずれているものがある
のは、図には示さなかったより小さい窓幅\footnote{320語、160語、80語、
  40語の4種類。}の話題境界候補区間との統合も行っているためである。

話題境界候補区間認定原理の補足
\label{app:拮抗点と順方向結束力の関係}

負の結束力拮抗点の直前の移動平均をとる幅($d$語)以内に順方向結束力の極
小点が存在することを証明する(関連\ref{sect:話題境界の区間推定法}節)。

まず、ある点$p$における順方向結束力と逆方向結束力をそれぞれ$FC_p,
BC_p$とおくと、
\[
   FC_p \equiv BC_{p+d}
\]
であり、拮抗点$ep3$では順方向結束力と逆方向結束力が等しいので、
\[
   FC_{ep3-d} (\equiv BC_{ep3}) = FC_{ep3} 
\]
が成り立つ。よって、拮抗点の直前の点の値が拮抗点の値より小さければ、
$ep3-d$までの部分、拮抗点の直前$d$語以内に順方向結束力の極小値がある。
また、拮抗点の直前の点の値が拮抗点の値より小さくなくても、
\[
   FC_{ep3-d-1} \equiv BC_{ep3-1} > FC_{ep3-1} \ge FC_{ep3} \\
\]
であり、同様に
\begin{eqnarray*}
    FC_{ep3} < FC_{ep3+1} &or& \\
    FC_{ep3-d+1} (\equiv BC_{ep3+1}) &<& FC_{ep3+1} \le FC_{ep3}
\end{eqnarray*}
となるので、$ep3-d$から$ep3$までの間に極小値が存在することになる。(証明終り)

