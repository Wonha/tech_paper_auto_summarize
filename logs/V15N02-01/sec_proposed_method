本稿においても，Zadroznyらと同様に，多値分類においては，分類器は各々の予測クラスに対して分類スコアを1つずつ出力すると仮定する．
例えば，[MATH]値分類の場合は分類スコアを[MATH]個出力するものとする．
このとき，第1位に予測されるクラスはすべての分類スコアの中で最大の分類スコアをもつクラスで，分類スコアの絶対的な大きさではなく分類スコア間の相対的な大きさにより決定される．
したがって，例えば第1位の分類スコアが大きな値であっても，第2位の分類スコアも同じ程度に大きな値の場合には第1位のクラスが不正解であったり，逆に，第1位の分類スコアがたとえ小さな値であっても，第2位の分類スコアがさらに小さな値の場合には第1位のクラスが正解であるケースも観察される．
以上より，多値分類において第1位のクラスのクラス所属確率は，第1位のクラスの分類スコアだけでなく他のクラスの分類スコアにも依存すると考えられるために，正確な推定値を得るためには，第1位のクラス以外の分類スコアも考慮に入れた複数の分類スコアを用いる必要があると思われる．
ここで，既存のビニングによる方法やIsotonic回帰による方法は，いずれも前提条件として，事例を分類スコアの順にソートする必要があるために，複数の分類スコアを用いることが困難である．
したがって，複数の分類スコアを扱える方法を検討する必要がある．
本稿は，パラメトリックな方法としてPlattの方法を，またノンパラメトリックな方法としてZadorznyらのビニングによる方法をそれぞれ参考にしながら，複数の分類スコアを有効に用いる方法を検討する．
その際，対象とするクラスを，クラス所属確率の必要性が最も高い第1位に予測されたクラスと，それ以外のクラス（第2位以下に予測されたクラス）の2つの場合に分けて検討することにする．
以下では，まず，本節において，第1位の予測クラスについてクラス所属確率の推定方法を検討し，有効な方法を提案する．
次に，4節で，本節において提案された推定方法を第2位以下の任意のクラスに対して拡張する方法を提案する．
本稿では，第1位のクラス所属確率を複数の分類スコアを用いて推定することを提案する．
クラス所属確率を推定する方法としては，ロジスティック回帰により直接推定する方法と，正解率表を利用して間接推定する方法の2つを提案する．
第1位のクラスから第[MATH]位のクラスまで[MATH]個の分類スコアを用いる場合，ロジスティック回帰による方法は（1）式により直接，クラス所属確率を推定する．
用いる分類スコアの数に制限はない．
ここで，[MATH]は第[MATH]位の分類スコアを表す．
このとき，パラメータ[MATH] ([MATH])および[MATH]は訓練事例を用い，最尤法によりあらかじめ推定しておく必要がある．
ロジスティック回帰による方法の手順を次に示す．
ロジスティック回帰式におけるパラメータの推定
クラス所属確率の推定
STEP 1 全訓練事例を，パラメータを推定するための訓練事例と評価事例に分割し，各評価事例についての分類スコアと正解の状態（正解か不正解か）のペアデータから，パラメータ[MATH]と[MATH]の最尤推定を行う．
このとき，訓練事例と評価事例の分割は交差検定による．
STEP 2
未知の事例に対するクラス所属確率の推定は，未知の事例において用いるクラスの分類スコア[MATH]をロジスティック回帰式（（1）式）に代入し，クラス所属確率を直接推定する．
本稿においては，正解率表とは，各分類スコアを軸として等区間に区切ってセルを作成し，各セルについて正解率（＝セル内の正解事例数／セル内の全事例数）を計算した表をいう（表3参照のこと）．
正解率表は用いる分類スコアの数により次元が決まる．
すなわち，[MATH]個の分類スコアを用いる場合には[MATH]次元の正解率表になる．
例えば，分類スコアを1つしか利用しない場合は等幅の区切りをもつ線分，2個利用する場合は同様の長方形，3個利用する場合は同様の直方体となる．
正解率表を利用する方法の手順を次に示す．
正解率表のためのセルの作成と正解率の計算
正解率の平滑化
クラス所属確率の推定
STEP 1
まず，正解率表を作成するためには，事例ごとに分類スコアと正誤状況のペアデータが必要である．
これは，ロジスティック回帰による方法と全く同様に，全訓練事例を交差検定により，正解率表作成のための訓練事例と評価事例に分割して学習を行って得ることができる．
次に，用いる分類スコアを軸とし，各軸とも等間隔（例えば，SVMの場合には0.1など）に区切ってセルを作成し，各セルごとに該当する事例をまとめて正解率を計算する．
例えば，第1位のクラスと第2位のクラスの分類スコアの2つを用いて区間幅0.1とする場合，縦横ともに0.1間隔で区切られたセルをもつ長方形の正解率表となるが，訓練事例中の各評価事例における2つのクラスの分類スコアから，どのセルに属するかが決まる．
すべての訓練事例の所属先セルが決定された時点で，各セルごとに所属する事例数と正解の事例数により正解率が計算できる．
提案手法は，ビニングによる方法やIsotonic回帰による方法のように，事例を分類スコア順にソートしておく必要がないために，利用する分類スコアの数（次元）が複数であっても正解率表の作成を行うことが可能である．
ただし，実際には，正解率表の次元が上がるに連れてセル数の爆発が起こるというノンパラメトリックな方法に特有の問題があるために，分類スコアの数を無制限に大きくすることはできない．
また，訓練事例数に比較してセル数が多すぎる場合や，区間幅の決め方（セルの作り方）によっては，セルに含まれる事例数がゼロになる（ゼロ頻度問題）可能性があり，正解率が計算できないという問題もある．
さらに，セルに属する事例数が等しくない可能性があるために，正解率における信頼性に違いが生じるという問題もある．
ゼロ頻度問題や信頼性の問題については，STEP 2で対応する．
STEP2
正解率表の精度を高めるために，STEP 1で計算された正解率に対して平滑化を行う．
まず，ゼロ頻度問題に対応する手法とし，ラプラス法やリッドストーン法がある[CITE].
分類スコア[MATH]が与えられたとき，ラプラス法[MATH]およびリッドストーン法[MATH]により平滑化された正解率は，次式により計算される:
ただし，[MATH]は平滑化を行うセル，[MATH]は平滑化を行うセル中の訓練事例の数，[MATH]は平滑化を行うセル中の正しく分類された訓練事例の数を表す.
また，[MATH]は擬似的に加える数であり，[MATH]の場合がラプラス法である．
ここで，正解率表におけるセルの位置と正解率の関係を観察すると，各セルとも正解率は周囲のセルの正解率と値が類似しており，各軸ごとに分類スコアの変化に伴う正解率の状況は，ほぼ単調な関係がみられる．
例えば，第1位の分類スコアは正解率と正の相関があり，第2位の分類スコアでは正解率と負の相関が観察される．
したがって，平滑化を行うセルに対して，そのセルの周囲に位置するセルの情報も用いることが有効であると考えられる．
このような平滑化を可能にする手法としては，移動平均法やメディアン法[CITE]がある．
分類スコア[MATH]が与えられたとき，移動平均法[MATH]およびメディアン法[MATH]により平滑化された正解率は，次式により計算される:
P_{MA}(f) & = \frac{N_p(c(f))}{N(c(f))} + \sum_{s\in Nb(c(f))} \frac{N_p(s)}{N(s)}{n},
P_{Median}(f) & = \mathit{median}_{s\in Nb(c(f))} \Bigg( \frac{N_p(c(f))}{N(c(f))} , \frac{N_p(s)}{N(s)} \Biggr).
ただし，[MATH]は平滑化を行うセル[MATH]の周囲に位置するセル，[MATH]は[MATH]を表す．
さらに，セルごとに正解率の信頼性が異なる問題を解決する方法としては，各セルのカバレッジを重み付けとして調整する方法が考えられる．
移動平均法にカバレッジによる重み付けを行う方法[MATH]により平滑化された正解率は，次式により計算される:
ただし，[MATH]は各セルのカバレッジで，セル[MATH]における事例数をすべての事例数で割った数を表す．
周囲の情報も利用した平滑化手法においては，どこまでの範囲を周囲とするかという問題があるが，今回は，最も単純に，平滑化を行うセルに隣接するセルまでとする．
例えば，分類スコアを1つ利用する場合には平滑化を行うセルを含めて計3個，分類スコアを2個利用する場合には，平滑化を行うセルを中心に斜めに位置するセルも含め計9個のセルを用いる.
STEP3
未知の事例に対するクラス所属確率の推定は，未知の事例において用いる分類スコアにより正解率表の中から該当するセルを見つけ，そのセルの正解率を推定値とする．
実験の目的は，多値分類における第1位のクラスのクラス所属確率について有効な推定方法を調査し，複数の分類スコアを用いることが有効であることを示すこと（実験1），および実験1で最も有効であった方法の性能を評価すること（実験2）である．
分類器
分類器はSVMを用いたが，提案手法の汎用性を調査するため，一部の実験についてはナイーブベイズ分類器も用いた．
SVMを選択した理由は，SVMは文書分類においてきわめて高い分類性能を示す分類器として認識され[CITE],適用される場合が多いために，分類器を特定しても有用性が高いと思われたためである．
ただし，SVMは本来は2値分類器であるために，one-versus-rest法[CITE]により多値分類器に拡張した.
高橋ら(2005a)およびTakahashi et al. (2005)にしたがって，SVMにおけるカーネル関数は線形カーネルを用いた．
データセット
データセットは，日本語の調査データであるJGSSデータセットおよびZadroznyらの実験[CITE]において用いられた英文のネットニュース記事であるUseNet news articles (20 Newsgroups)データセットの2つを用いた．
JGSSデータセットは，2000年から2003年までの4年間に毎年実施された調査により収集されたデータのうちの職業データ（サンプル数23,838）で，自由回答である「仕事の内容」「従業先事業の種類」の他に，選択回答である「従業上の地位」「役職」「従業先事業の規模」など複数の回答群から構成されている．
すべての職業データに195個ある職業コードのいずれか1つのコードが付与されており，本稿ではこの職業コードを正解とした．
例えば，次のような職業データには正解として職業コード「563」が付与されている．
JGSSデータセットにおいては，先に開発した自動コーディングシステム[CITE]の設定を踏襲し，「仕事の内容」と「従業先事業の種類」に出現する単語unigramおよび「従業上の地位」と「役職」を表す選択肢を素性として用いた．
訓練事例と評価事例の分割は，実際の職業コーディングの状況に似せて，すでに正解が付けられた過去のデータを訓練事例とし，これからコーディングを行う予定のデータを評価事例とした．
今回は，訓練事例として2000年から2002年までの3年間分のデータ（20,066サンプル），評価事例として2003年のデータ（3,772サンプル）に分割した．
さらに，訓練事例は正解率表を作成するため，5分割交差検定により訓練事例と評価事例に分割した．
すなわち，正解率表を作成するために，データを変えて訓練事例16,053サンプル，評価事例4,013サンプルに分割し，計5回の学習を行った．
20 Newsgroupsデータセット（サンプル数18,828）は，さまざまなUseNetのディスカッショングループに対応する20個のカテゴリのいずれかに分類されており，本稿ではこれを正解とした．
用いた素性は，ネットニュース記事に出現する単語unigramで，JGSSデータセットにおける自由回答の場合と同様である．
20 Newsgroupsデータセットでは，訓練事例と評価事例の分割は5分割交差検定により行った．
すなわち，データを変えて，例えば，訓練事例15,063サンプル，評価事例3,765サンプルとし，計5回の学習を行った．
正解率表の作成は，JGSSデータセットの場合と全く同様に，全訓練事例を5分割交差検定により，訓練事例（例えば12,053サンプル）と評価事例（例えば3,013サンプル）に分割し計5回の学習を行った．
セルの区間幅
最適なセルの区間幅は自動的に決めることができないために，実験を行って決める必要がある．
今回は，区間幅を0.05, 0.1, 0.2, 0.3, 0.5の5通りに設定した．
このとき，1つの正解率表においては，どの次元の軸も同一の区間幅で区切った．
第1位のクラスの分類スコア軸における区間幅とセルの数との関係は，表[REF_cell_interval]に示す通りであった．
評価尺度
実験1では，各手法の評価を行うために，Zadroznyら[CITE]にしたがい，次式で計算されるクロスエントロピーを用いた．
ただし，[MATH]は評価事例数，[MATH]は[MATH]番目の事例におけるクラス所属確率の推定値，[MATH]は[MATH]番目の事例における正誤状況で，正解の場合は[MATH],不正解の場合は[MATH]を表す．
クロスエントロピーの値が小さいほどよい手法であるとする．
実験2では，提案手法の評価を行うために，Caruanaら[CITE]にしたがい，予測値がどの程度実測値と重なるかを表す信頼度曲線を用いた．
予測値と実測値が重なる程度が高いほどよい手法であるとする．
また，Zadroznyら[CITE]にしたがい，ROC (receiver operating characteristic)曲線に基づいて計算されるAUC (Area Under the Curve)を用いた評価も行った．
AUCの値が大きいほどよい手法であるとする．
提案手法の性能評価としては，誤分類検出能力により従来の検出手法との比較を行った．
誤分類検出能力は，誤分類の事例を対象となる事例数のカバレッジが低い時点で多く検出できるほどよい手法であるとする．
セルの作成法
実験1を行う前の予備実験として，正解率表におけるセルの作成法について，分類スコアを等間隔に区切る方法（提案手法）を各ビンの事例数を等しくする方法（Zadoroznyらによるビニングの方法）と比較し，提案手法の有効性を確認した．
ここでは，Zadoroznyらによるビニングの方法との比較を可能にするために，提案手法においても用いる分類スコアを第1位のクラスに対するもののみとし，正解率の平滑化を行わない値を用いた．
ここで，提案手法における定義域は[MATH]であるが，今回用いたデータセットにおける第1位のクラスの分類スコアの範囲は，分類器がSVMの場合，JGSSデータセットでは[MATH], 20 Newsgroupsデータセットでは[MATH]であった．
表[REF_equal]は，2つの方法により作成されたセルからなる正解率表の有効性を，データセットや分類器を変えてクロスエントロピーにより比較した結果である．
表中，等間隔は我々の提案する方法（セルの区間幅を等間隔にする方法），等事例はZadroznyらの提案する方法（セルに含まれる事例数を等しくする方法）を表す．
表の値は，等間隔の方法では区間幅を0.1から0.5まで4通り，等事例の方法においても，この区間幅に対応させてセルの個数を30個から7個まで4通りに変化させた中のそれぞれ最もよかった場合の値である．
太字の数字は，2つの方法のうちよい方の値を示す．
表[REF_equal]において，セルを等間隔に区切る方法は，ナイーブベイズ分類器ではセルに含まれる事例を等しくする方法にやや劣るものの，SVMではどちらのデータセットでも大きく上回る結果を示した．
この傾向は，最もよかった値同士の比較だけではなく，セルの区間幅（セルの個数）が異なっても全く同様であった．
この理由としては，一般に，データを各区間の度数が等しくなるように分割する方法は各区間幅が等しくなるように分割する方法より推定効率が高いことが知られているが，一方で，密度関数推定の観点から大きなバイアスを引き起こす可能性があることが指摘されており[CITE],今回用いたデータセットの分類スコアの分布において，特にSVMを適用した場合にこのバイアス問題が生じたのではないかと考えられる．
その結果，セルを等事例で区切る方法において作成された正解率表は，セルに属する事例の分類スコアと正解率の関係を適切に反映したものにならなかったのではないかと思われる．
表[REF_equal]より，「分類スコアを等間隔に区切ってセルを作成する方法」により正解率表を作成する方法が有効であることが確認できたため，以下の実験では，セルの作成は分類スコアを等間隔に区切る方法を用いた．
なお，今回，等事例に区切る方法において最もよかったのは，セルの個数が12個または7個の場合であったが，Zadroznyらのビニングによる方法においてもビンの個数が10個の場合が最もよかったとの報告があり[CITE],第1位のクラスの分類スコアのみを用いる場合には，分類器やデータセットが異なっていても最適なセルの個数が類似していることは興味深い．
クロスエントロピーによる評価
表[REF_loglikelihoodJGSS]は，SVMを適用しJGSSデータセットを用いた場合のクロスエントロピーの値を，用いた分類スコア別，クラス所属確率を推定する方法別にまとめたものである．
表において，重み付け移動平均法はカバレッジを重みとする移動平均法を表す．
リッドストーン法においては最もよい場合の値を示す．
表の縦方向はセルの区間幅を0.05から0.5まで5通りに変化させたことを示しており，各区間幅の上段は利用した分類スコアが第1位のクラスのみの場合，下段は利用した分類スコアが第1位と第2位のクラスの場合の結果を示す．
表中の記号「---」はクロスエントロピーが計算できなかったセルがあったことを示す．
また，太字の数字は，表中のすべての値の中で最もよい値であることを示す．
表では省略したが，正解率表を利用する方法において，第1位から第3位まで3つのクラスの分類スコアを用いた場合のクロスエントロピーは，いずれも第1位のクラスのみの場合よりははるかによく第1位と第2位のクラスの場合よりやや悪かった．
なお，1節で述べた2種類の単純な変換[CITE]によるクロスエントロピーは，Nicllescu-Mizilらによる変換では1.4563であり，Zadroznyらによる変換では0.8332であった．
同様に，SVMを適用し20 Newsgroupsデータセットを用いた結果を表[REF_loglikelihoodNS]に示す．
表の形式や記号の意味などは表[REF_loglikelihoodJGSS]と同様である．
ここでも，正解率表を利用する方法においては，第1位から第3位まで3つのクラスの分類スコアを用いた場合のクロスエントロピーはJGSSデータセットを用いた場合と全く同様で，いずれも第1位のクラスのみの場合よりははるかによく，第1位と第2位のクラスの場合よりやや悪かった．
なお，1節で述べた単純な変換によるクロスエントロピーは，Nicllescu-Mizilらによる変換では計算できず，Zadroznyらによる変換では0.9199であった．
表[REF_loglikelihoodJGSS]および表[REF_loglikelihoodNS]より，次のことが明らかになった．
まず，SVMを適用した場合は，クラス所属確率を推定する方法やデータセットに関係なく，第1位のクラスの分類スコアのみ用いるより他のクラスの分類スコアも含めた複数の分類スコアを用いることが有効であった．
分類スコアの有効な組み合わせ方については，ロジスティック回帰による方法と正解率表を利用する方法で異なっており，ロジスティック回帰による方法は，第1位のクラスから第3位のクラスまで3つの分類スコアを用いた場合，正解率表を利用する方法は，第1位のクラスと第2位のクラスの2つの分類スコアを用いた場合が最もよかった．
ただし，いずれの方法においても，分類スコアの組み合わせ方の違いによる差は小さかった．
次に，ロジスティック回帰による方法も含めてすべての場合の中で最もよい結果を示したのは，最適な正解率表を利用した場合，すなわち「第1位と第2位のクラスの分類スコアを用いてカバレッジを重みとする移動平均法による平滑化を行った正解率表を利用する方法」（セルの区間幅0.1）であった．
ただし，正解率表を利用する方法は，セルの区間幅の決め方により結果に大きな差があった．
特にセルの区間幅を非常に小さく（0.05）設定した場合は，複数の分類スコアを用いることは有効ではなかった．
この理由は，セルの個数が増えることにより各セルごとに含まれる事例数が少なくなり，場合によっては事例が存在しないセルが出現したために，正解率における信頼性が低くなったことが原因であると考えられる．
正解率表を利用する方法においてはロジスティック回帰による方法と異なり，分類スコアを3つ用いた方が2つ用いた場合より結果が悪かった理由も，同様であると考えられる．
今回は，最適なセルの区間幅は，どちらのデータセットにおいても0.1であった．
これに対して，ロジスティック回帰による方法は，どちらのデータセットにおいても安定してよい結果を示した．
さらに，正解率表における平滑化の手法は，いずれもデータセットに関係なく有効であった．
特に，平滑化を行うセルの周囲にあるセルの情報も利用する方法である（カバレッジを重みとする）移動平均法は，セルの区間幅が適切であった場合によい結果を示した．
注目するセルの情報のみで平滑化を行うラプラス法やリッドストーン法は，クロスエントロピーにおいては大きな効果はなかったが，ゼロ頻度問題に対応できる点で評価できる．
ここで，正解率表を利用する方法における結論をより一般化させるために，分類器をナイーブベイズ分類器に変え，20 Newsgroupsデータセットによる実験を行った．
結果は表[REF_loglikelihoodNS_NB]に示すように，SVMの場合と同様に，第1位のクラスの分類スコアのみを用いた場合より，第2位のクラスまで2つの分類スコアを用いた場合の方がよかった．
また，平滑化手法は有効で，特にセルの区間幅が適切な場合に移動平均法はよい結果を示した．
ナイーブベイズ分類器において最もよかったのはセルの個数が30個の場合であり，これはSVMにおいて最もよかったセルの区間幅0.1の場合に該当する．
以上より，多値分類における第1位のクラスのクラス所属確率の推定は，複数の分類スコアを用いることが有効であった．
特に，最適な正解率表である「第1位と第2位のクラスの分類スコアを用いて（カバレッジによる重み付き）移動平均法による平滑化を行い，セルの区間幅を0.1（セルの個数30個）に設定した正解率表」を利用する方法は最も有効であった．
ただし，正解率表を利用する方法は設定されたセルの区間幅により結果が不安定であるという問題があったのに対して，ロジスティック回帰による方法は安定してよい結果を示した．
また，今回は，正解率表を利用する方法における最適な正解率表がデータセットや分類器に関係なく一致したが，この結果をさらに一般化するには，データセットや分類器をより多様なものに変えた実験を行って確認する必要がある．
したがって，現時点では，正解率表を利用する方法は，データセットや分類器が異なる場合に最適な正解率表を決定するための実験を行う必要があり，手間がかかるという欠点があるといえる．
ここでは，SVMを適用して，実験1において最適であった方法（以後，提案手法とよぶ）の評価を行った．
信頼度曲線およびROC曲線
信頼度曲線は，予測値（推定値）（[MATH]軸）と実際の値（[MATH]軸）の関係をプロットしたもので，予測値と実際の値が等しい場合には対角線上にプロットされ，対角線から離れるほど予測の精度が悪いことを示す．
ここでは，提案手法を，分類スコアを1つ用いた方法のうち，平滑化を行わない正解率表を利用する方法（以後，平滑化を行わない方法とよぶ）およびシグモイド関数による方法と比較した．
このとき，平滑化を行わない方法は，等事例ではなく等間隔に区切ったビニングによる方法であると考えることができ，シグモイド関数による方法はPlattの方法を簡略化したものであると考えられる．
今回は，予測値を0.1ずつ区切り10区間を作成し，予測値と真の値としていずれも区間内（例えば，[MATH]）に含まれる事例の平均を用いた．
JGSSデータセットによる結果を図[REF_reliability_JGSS]に，20 Newsgroupsデータセットによる結果を図[REF_reliability_20ng]に示す．
図[REF_reliability_JGSS]および図[REF_reliability_20ng]において，提案手法はどちらのデータセットにおいても対角線の近くにプロットされており，クラス所属確率を全体的にうまく推定することがわかった．
ROC曲線は，[MATH]軸がFPF（False Positive Fraction;偽陽性率），[MATH]軸がTPF（True Positive Fraction;真陽性率）を表す座標上に，正解率の程度により分類された各グループごとのFPFとTPFの値をプロットしたものである．
ここで，FPF＝注目するグループ内の不正解事例数／全不正解事例数，TPF＝注目するグループ内の正解事例数／全正解事例数である．
今回は，正解率を10点刻みに分類してFPFとTPFの値を求めた．
すなわち，最上位のグループ（正解率が91%〜100%の範囲にある事例）から始めて，上限を固定し下限を10%ずつ下げたグループ（例えば2番目のグループは，正解率の範囲が81%〜100%である事例の集合）を計10個作成し，各グループにおけるFPFとTPFを計算した．
ROC曲線においては，ROC曲線が左上方に位置するほど正確な推定が行われていることを示すが，より正確には，ROC曲線の下方にある領域であるAUC (Area Under the Curve)を計算し，その値が大きいほどよい手法であるとされる．
図[REF_ROC_JGSS_20ns]に，JGSSデータセットおよび20 Newsgroupsデータセットによる提案手法，平滑化を行わない方法，シグモイド関数による方法におけるROC曲線を示す．
また，3つの手法におけるAUCの値を表[REF_AUC_rank1]に示す．
図[REF_ROC_JGSS_20ns]および表[REF_AUC_rank1]より明らかなように，提案手法はいずれのデータセットにおいても他の2つの方法より正確な推定を行えることがわかった．
誤分類検出能力
事例をクラス所属確率の推定値の小さい順に並べたとき，カバレッジの値が小さいときにできるだけ多くの誤分類事例が検出されることが望ましい．
カバレッジをこのように考えた場合に，各カバレッジごとにどのくらい誤分類された事例を検出できるかを，本稿では誤分類検出能力とよぶ．
提案手法の誤分類検出能力を，JGSSデータセットおよび20 Newsgroupsデータセットを用いて評価した．
評価の方法は，提案手法によるクラス所属確率の推定値を値の小さい順に事例を並べ，カバレッジを10%ずつ増やしてできた区間ごとに，誤分類された事例数を調査した．
比較のため，既存の手法であるSchohnにより提案された単純な方法[CITE]による結果も示した．
単純な方法では，分類スコアの値の小さい順に並べ，同様にカバレッジを10%ずつ増やしてできた区間ごとに，誤分類された事例数を調査した．
それぞれのデータセットによる結果を図[REF_Lap-RawJGSS_ns]に示す．
図[REF_Lap-RawJGSS_ns]において，提案手法はどちらのデータセットにおいても常に単純な方法を上回った．
特に，20 Newsgroupsデータセットにおいては，カバレッジが小さい場合に大きく上回る点が評価できる．
その理由は，我々が実際に人手により分類誤りを検出する必要がある場合，チェックをするデータセットの量はできる限り少量の方が作業が楽であるからである．
JGSSデータセットでは，全体の40%をチェックすれば誤分類事例の80%を検出することができるが，20 Newsgroupsデータセットで同じ量をチェックすると，誤分類事例の90%を検出できる．
両者のデータセットにおける傾向の違いを説明する理由は明確ではないが，JGSSデータセットには非常に短く有効な素性が少ししか含まれない事例が多いため，正確な推定を行うために十分な情報がないことが原因であると考えられる．
以上をまとめると，多値分類において第1位に予測されたクラスのクラス所属確率の推定は，複数の分類スコアを用いることが有効であることがわかった．
特に，第1位と第2位に予測されたクラスの分類スコアを用いて作成した最適な正解率表を利用する方法が最もよい結果を示した．
ここで，最適な正解率表とは，セルの区間幅を0.1（セルの個数が30）として作成した正解率表を（カバレッジによる重み付き）移動平均法による平滑化を行ったものである．
ただし，正解率表を利用する方法は正解率表の作成法により結果が不安定であるという欠点があった．
この点において，ロジスティック回帰による方法は安定してよい結果を示した．
また，ロジスティック回帰による方法は，最適な正解率表を見つけるために実験を重ねる手間が不要であるという利点もある．
\
3節で，多値分類における第1位の予測クラスについてのクラス所属確率は，複数の分類スコアを用いた推定が有効であることが明らかになった．
本節では，3節で得られた結論を第2位以下の任意のクラスに対して拡張する方法を検討する．
この場合，どのクラスの分類スコアを組み合わせることが有効であるかを検討することが重要である．
本稿では，多値分類における第2位以下の任意のクラスについてのクラス所属確率を高精度に推定するために，推定したいクラス（第[MATH]位のクラス）と第1位のクラスの分類スコアを用いてロジスティック回帰により推定する方法を提案する．
すなわち，次式によりクラス所属確率の推定を行うことを提案する．
ここで，[MATH]は第[MATH]位の分類スコアを表す．
このとき，パラメータ[MATH], [MATH]および[MATH]は訓練事例を用い，最尤法によりあらかじめ推定しておく必要がある.
ここで，推定したいクラスの他に用いるクラスとして第1位のクラスを選択した理由は，3節でも述べたように，多値分類においては，第1位のクラスの分類スコアが最も大きく，どのクラスの分類スコアも第1位のクラスの分類スコアの値以上にはならないため，推定したいクラスの分類スコアの値を第1位のクラスの分類スコアとの相対的な関係で捉えることが有効であると考えたためである．
これを実現するための方法はいくつか存在するが，ここでは，3節と同様に最も単純に第1位のクラスの分類スコアをそのまま用いることにした．
また，クラス所属確率の推定方法については，第2位以下のクラスにおいては，第1位のクラスよりも分類スコアの傾向をさらに把握しにくくなるために，最適な正解率表を作成することが困難であると考えられる．
したがって，第1位のクラスの場合において安定した結果を示したロジスティック回帰による方法の方が有効であると考えた．
この2つの仮定を以下の実験により確認する．
実験の目的は，多値分類における第2位以下の任意のクラスのクラス所属確率の推定に用いる分類スコアは，提案手法による組み合わせ方が最も有効であることを示すこと（実験1），および第2位以下のクラスにおいては，ロジスティック回帰による方法が正解率表を利用する方法より有効であることを示すこと（実験2）である．
実験設定は3節と同様で，分類器はSVMを適用した．
実験1では第2位から第20位までのクラス，実験2では第2位から第5位までのクラスについて調査した．
分類スコアの候補
実験1を行う前の予備実験として，推定したいクラスのクラス所属確率と関連の深いクラスを発見するために，第2位以下のすべてのクラスについて，注目するクラスの正誤状況（正解の場合1，不正解の場合0）と全クラスの分類スコアとの相関関係を調査した．
これは，注目するクラスの正誤状況と相関係数の絶対値が大きい分類スコアのクラスほど注目するクラスとの関連が強いと仮定したためである．
したがって，相関係数の絶対値の大きな分類スコアが多い順位のクラスを候補として用いることを検討した．
JGSSデータセットと20 Newsgroupsデータセットを用いて第2位から第20位のクラスにおいて，各クラスごとに関連の強かったクラスを表[REF_correlation]にまとめる．
表[REF_correlation]より，注目するクラス（推定したいクラス）自身より第1位のクラスの方が多かったため，用いるクラスの候補として第1位のクラスを候補とした．
また，注目するクラスの直前や直後のクラスも候補とした．
次に，これらの3つのクラスの分類スコアを推定したいクラスとそれぞれ単純に組み合わせた場合におけるクロスエントロピーを，JGSSデータセットと20 newsgroupsデータセットを用いて調査した．
その結果，どちらのデータセットにおいても，第1位のクラスの分類スコアを組み合わせた場合以外は有効性が認められなかったため，実験1では，複数の分類スコアとして次の3つの組み合わせ方を考え，「推定したいクラスの分類スコアのみを用いる」場合と比較を行った（（）内は用いる分類スコアの数を表す）．
このとき，分類スコアを3個以上用いた場合のクラス所属確率の推定には，3節で述べた（1）式を適宜修正した式を用いた．
［提案手法］「推定したいクラスと第1位のクラスの分類スコア」（2個）
「第1位のクラスから推定したいクラス（第[MATH]位のクラス）までのすべてのクラスの分類スコア」（[MATH]個）
「推定したいクラスとその直前および直後のクラスの分類スコア」（3個）
提案手法の有効性
図[REF_rank2-12_JGSS_20ns]は，JGSSデータセットと20 Newsgroupsデータセットにより，用いた分類スコアの組み合わせを変えた場合のクロスエントロピーを，推定したいクラスの順位別（[MATH]軸）に示したものである．
ただし，どちらのデータセットにおいても，13位以下のクラスにおいては12位と同様の傾向であったために省略した．
図[REF_rank2-12_JGSS_20ns]から明らかなように，どちらのデータセットにおいても，推定したいクラスが上位の場合には，推定したいクラスの分類スコアのみを用いるより，クラスの組み合わせ方に関係なく複数の分類スコアを用いた方がよかった．
特に提案手法である「推定したいクラスと第1位のクラスの分類スコア」を用いた場合は，どの順位においても最もよかった．
ただし，推定したいクラスの順位が下がるにつれて，どの方法もクロスエントロピーの値が小さくなり，方法間の違いの差がみられなくなった．
この理由は，クラスの順位が下がるにつれてどの方法であってもクラス所属確率の推定値が小さくなり，また予測されたクラスも不正解である場合が多くなるために，クロスエントロピーも小さくなったためだと考えられる．
次に，提案手法を含めた4つの方法におけるROC曲線を，第2位のクラスと第3位のクラスに注目した場合についてそれぞれ図[REF_ROC2]および図[REF_ROC3]に示す．
ただし，第2位のクラスにおいては，「第1位から推定したいクラスまでのすべてのクラスの分類スコアを用いる方法」は提案手法と同じ方法であるために，図[REF_ROC2]では省略した．
また，図9，図10におけるAUCを表[REF_AUC_rank23]に示す．
表中，太字の数字は，各ケースにおいて最もよい値であることを示す．
図[REF_ROC2],図[REF_ROC3],表[REF_AUC_rank23]より，注目するクラスやデータセットが異なっても，複数の分類スコアを用いる方法は，注目するクラスの分類スコアだけを用いる方法よりよかった．
AUCによる評価において最もよかった方法は，JGSSデータセットの場合は提案手法であり，20 Newsgroupsデータセットの場合は，注目するクラスと直前および直後のクラスの分類スコアを用いる方法（第2位のクラスの場合）や，第1位から推定したいクラスまでのすべてのクラスの分類スコアを用いる方法（第3位のクラスの場合）であった．
ただし，提案手法は20 Newsgroupsデータセットの場合も安定してよかった．
以上より，第2位以下の任意のクラスについてのクラス所属確率を推定する場合も，複数の分類スコアを用いることは有効であり，特に推定したいクラスと第1位のクラスの分類スコアを用いる方法は有効であることが示された．
最後に，ロジスティック回帰式におけるパラメータを最尤推定するために用いる訓練事例数を変化させたときのクロスエントロピーを調査した．
図[REF_JGSS_train_size]は，JGSSデータセットにより，推定したいクラスの分類スコアのみ用いる方法と提案手法を比較したものである．
[MATH]軸は訓練事例数を表しており，右端はこれまでの実験において訓練事例として用いられてきた20,066サンプルの場合，左端は1,000サンプルにまで減らした場合を表す．
図[REF_JGSS_train_size]より，まず，訓練事例の数に関係なく提案手法が有効であることがわかった．
また，訓練事例が1,000サンプルと比較的少ない場合でも，ロジスティック回帰による方法は安定してよい結果を示すこともわかった．
ここでは，提案手法による分類スコアの組み合わせにおいて，ロジスティック回帰による方法を最適な正解率表を利用する方法と比較した．
このとき，最適な正解率表としては次の2つを検討した．
1つは第1位のクラスについて推定する場合に最も有効であった正解率表（セルの区間幅を0.1に設定）で，推定したいクラスごとに新たな正解率表を作成する手間を省略する目的で用いた．
もう1つは，第2位以下の各クラスにおける分類スコアのとる値の状況に合わせて，セルの区間幅を適宜（例えば0.2など）変えたもので，「正解率表（改良版）」とよぶことにする．
いずれの正解率表も，3節で最も有効であった平滑化手法すなわちカバレッジを重みとする移動平均法による平滑化を行った．
図[REF_JGSS_20ns_seikai_hikaku]に，ロジスティック回帰による方法と正解率表を利用する方法におけるクロスエントロピーを示す．
図[REF_JGSS_20ns_seikai_hikaku]より，注目するクラスが第2位から第5位までの場合の平均において，ロジスティック回帰による方法が最も有効であることが示された．
正解率表（改良版）を利用する方法は，JGSSデータセットにおいて第2位のクラスに注目する場合や，20 Newsgroupsデータセットにおいて第3位のクラスに注目する場合のみ，ロジスティック回帰による方法よりわずかによい結果であったが，注目するクラスに対して毎回，最適な正解率表を作成する手間がかかるという欠点がある．
3つの方法におけるROC曲線の例として，JGSSデータセットを用いて第2位のクラスに注目する場合を図[REF_ROC_JGSS_seikai_hikaku]に示す．
このとき，3つの方法におけるAUCは，それぞれロジスティック回帰による方法（0.7443），第1位のクラスに対する最適な正解率表を利用する方法（0.7260），正解率表（改良版）を利用する方法（0.7449）で，JGSSデータセットにおいて第2位のクラスを推定する場合に限り，正解率表（改良版）を利用する方法がロジスティック回帰による方法をやや上回った．
今回，第6位以下のクラスについては比較実験を行っていないが，先に述べたように，下位のクラスになるにしたがって最適な正解率表の作成は困難になることが予想されるため，第6位以下のクラスにおいてもロジスティック回帰による方法が有効であると考えられる．
以上より，第2位以下の任意のクラスにおいても，ロジスティック回帰による方法の方が正解率表を利用する方法より有効であると判断できた．
本稿においても，Zadroznyらと同様に，多値分類においては，分類器は各々の予測クラスに対して分類スコアを1つずつ出力すると仮定する．
例えば，[MATH]値分類の場合は分類スコアを[MATH]個出力するものとする．
このとき，第1位に予測されるクラスはすべての分類スコアの中で最大の分類スコアをもつクラスで，分類スコアの絶対的な大きさではなく分類スコア間の相対的な大きさにより決定される．
したがって，例えば第1位の分類スコアが大きな値であっても，第2位の分類スコアも同じ程度に大きな値の場合には第1位のクラスが不正解であったり，逆に，第1位の分類スコアがたとえ小さな値であっても，第2位の分類スコアがさらに小さな値の場合には第1位のクラスが正解であるケースも観察される．
以上より，多値分類において第1位のクラスのクラス所属確率は，第1位のクラスの分類スコアだけでなく他のクラスの分類スコアにも依存すると考えられるために，正確な推定値を得るためには，第1位のクラス以外の分類スコアも考慮に入れた複数の分類スコアを用いる必要があると思われる．
ここで，既存のビニングによる方法やIsotonic回帰による方法は，いずれも前提条件として，事例を分類スコアの順にソートする必要があるために，複数の分類スコアを用いることが困難である．
したがって，複数の分類スコアを扱える方法を検討する必要がある．
本稿は，パラメトリックな方法としてPlattの方法を，またノンパラメトリックな方法としてZadorznyらのビニングによる方法をそれぞれ参考にしながら，複数の分類スコアを有効に用いる方法を検討する．
その際，対象とするクラスを，クラス所属確率の必要性が最も高い第1位に予測されたクラスと，それ以外のクラス（第2位以下に予測されたクラス）の2つの場合に分けて検討することにする．
以下では，まず，本節において，第1位の予測クラスについてクラス所属確率の推定方法を検討し，有効な方法を提案する．
次に，4節で，本節において提案された推定方法を第2位以下の任意のクラスに対して拡張する方法を提案する．
本稿では，第1位のクラス所属確率を複数の分類スコアを用いて推定することを提案する．
クラス所属確率を推定する方法としては，ロジスティック回帰により直接推定する方法と，正解率表を利用して間接推定する方法の2つを提案する．
第1位のクラスから第[MATH]位のクラスまで[MATH]個の分類スコアを用いる場合，ロジスティック回帰による方法は（1）式により直接，クラス所属確率を推定する．
用いる分類スコアの数に制限はない．
ここで，[MATH]は第[MATH]位の分類スコアを表す．
このとき，パラメータ[MATH] ([MATH])および[MATH]は訓練事例を用い，最尤法によりあらかじめ推定しておく必要がある．
ロジスティック回帰による方法の手順を次に示す．
ロジスティック回帰式におけるパラメータの推定
クラス所属確率の推定
STEP 1 全訓練事例を，パラメータを推定するための訓練事例と評価事例に分割し，各評価事例についての分類スコアと正解の状態（正解か不正解か）のペアデータから，パラメータ[MATH]と[MATH]の最尤推定を行う．
このとき，訓練事例と評価事例の分割は交差検定による．
STEP 2
未知の事例に対するクラス所属確率の推定は，未知の事例において用いるクラスの分類スコア[MATH]をロジスティック回帰式（（1）式）に代入し，クラス所属確率を直接推定する．
本稿においては，正解率表とは，各分類スコアを軸として等区間に区切ってセルを作成し，各セルについて正解率（＝セル内の正解事例数／セル内の全事例数）を計算した表をいう（表3参照のこと）．
正解率表は用いる分類スコアの数により次元が決まる．
すなわち，[MATH]個の分類スコアを用いる場合には[MATH]次元の正解率表になる．
例えば，分類スコアを1つしか利用しない場合は等幅の区切りをもつ線分，2個利用する場合は同様の長方形，3個利用する場合は同様の直方体となる．
正解率表を利用する方法の手順を次に示す．
正解率表のためのセルの作成と正解率の計算
正解率の平滑化
クラス所属確率の推定
STEP 1
まず，正解率表を作成するためには，事例ごとに分類スコアと正誤状況のペアデータが必要である．
これは，ロジスティック回帰による方法と全く同様に，全訓練事例を交差検定により，正解率表作成のための訓練事例と評価事例に分割して学習を行って得ることができる．
次に，用いる分類スコアを軸とし，各軸とも等間隔（例えば，SVMの場合には0.1など）に区切ってセルを作成し，各セルごとに該当する事例をまとめて正解率を計算する．
例えば，第1位のクラスと第2位のクラスの分類スコアの2つを用いて区間幅0.1とする場合，縦横ともに0.1間隔で区切られたセルをもつ長方形の正解率表となるが，訓練事例中の各評価事例における2つのクラスの分類スコアから，どのセルに属するかが決まる．
すべての訓練事例の所属先セルが決定された時点で，各セルごとに所属する事例数と正解の事例数により正解率が計算できる．
提案手法は，ビニングによる方法やIsotonic回帰による方法のように，事例を分類スコア順にソートしておく必要がないために，利用する分類スコアの数（次元）が複数であっても正解率表の作成を行うことが可能である．
ただし，実際には，正解率表の次元が上がるに連れてセル数の爆発が起こるというノンパラメトリックな方法に特有の問題があるために，分類スコアの数を無制限に大きくすることはできない．
また，訓練事例数に比較してセル数が多すぎる場合や，区間幅の決め方（セルの作り方）によっては，セルに含まれる事例数がゼロになる（ゼロ頻度問題）可能性があり，正解率が計算できないという問題もある．
さらに，セルに属する事例数が等しくない可能性があるために，正解率における信頼性に違いが生じるという問題もある．
ゼロ頻度問題や信頼性の問題については，STEP 2で対応する．
STEP2
正解率表の精度を高めるために，STEP 1で計算された正解率に対して平滑化を行う．
まず，ゼロ頻度問題に対応する手法とし，ラプラス法やリッドストーン法がある[CITE].
分類スコア[MATH]が与えられたとき，ラプラス法[MATH]およびリッドストーン法[MATH]により平滑化された正解率は，次式により計算される:
ただし，[MATH]は平滑化を行うセル，[MATH]は平滑化を行うセル中の訓練事例の数，[MATH]は平滑化を行うセル中の正しく分類された訓練事例の数を表す.
また，[MATH]は擬似的に加える数であり，[MATH]の場合がラプラス法である．
ここで，正解率表におけるセルの位置と正解率の関係を観察すると，各セルとも正解率は周囲のセルの正解率と値が類似しており，各軸ごとに分類スコアの変化に伴う正解率の状況は，ほぼ単調な関係がみられる．
例えば，第1位の分類スコアは正解率と正の相関があり，第2位の分類スコアでは正解率と負の相関が観察される．
したがって，平滑化を行うセルに対して，そのセルの周囲に位置するセルの情報も用いることが有効であると考えられる．
このような平滑化を可能にする手法としては，移動平均法やメディアン法[CITE]がある．
分類スコア[MATH]が与えられたとき，移動平均法[MATH]およびメディアン法[MATH]により平滑化された正解率は，次式により計算される:
P_{MA}(f) & = \frac{N_p(c(f))}{N(c(f))} + \sum_{s\in Nb(c(f))} \frac{N_p(s)}{N(s)}{n},
P_{Median}(f) & = \mathit{median}_{s\in Nb(c(f))} \Bigg( \frac{N_p(c(f))}{N(c(f))} , \frac{N_p(s)}{N(s)} \Biggr).
ただし，[MATH]は平滑化を行うセル[MATH]の周囲に位置するセル，[MATH]は[MATH]を表す．
さらに，セルごとに正解率の信頼性が異なる問題を解決する方法としては，各セルのカバレッジを重み付けとして調整する方法が考えられる．
移動平均法にカバレッジによる重み付けを行う方法[MATH]により平滑化された正解率は，次式により計算される:
ただし，[MATH]は各セルのカバレッジで，セル[MATH]における事例数をすべての事例数で割った数を表す．
周囲の情報も利用した平滑化手法においては，どこまでの範囲を周囲とするかという問題があるが，今回は，最も単純に，平滑化を行うセルに隣接するセルまでとする．
例えば，分類スコアを1つ利用する場合には平滑化を行うセルを含めて計3個，分類スコアを2個利用する場合には，平滑化を行うセルを中心に斜めに位置するセルも含め計9個のセルを用いる.
STEP3
未知の事例に対するクラス所属確率の推定は，未知の事例において用いる分類スコアにより正解率表の中から該当するセルを見つけ，そのセルの正解率を推定値とする．
実験の目的は，多値分類における第1位のクラスのクラス所属確率について有効な推定方法を調査し，複数の分類スコアを用いることが有効であることを示すこと（実験1），および実験1で最も有効であった方法の性能を評価すること（実験2）である．
分類器
分類器はSVMを用いたが，提案手法の汎用性を調査するため，一部の実験についてはナイーブベイズ分類器も用いた．
SVMを選択した理由は，SVMは文書分類においてきわめて高い分類性能を示す分類器として認識され[CITE],適用される場合が多いために，分類器を特定しても有用性が高いと思われたためである．
ただし，SVMは本来は2値分類器であるために，one-versus-rest法[CITE]により多値分類器に拡張した.
高橋ら(2005a)およびTakahashi et al. (2005)にしたがって，SVMにおけるカーネル関数は線形カーネルを用いた．
データセット
データセットは，日本語の調査データであるJGSSデータセットおよびZadroznyらの実験[CITE]において用いられた英文のネットニュース記事であるUseNet news articles (20 Newsgroups)データセットの2つを用いた．
JGSSデータセットは，2000年から2003年までの4年間に毎年実施された調査により収集されたデータのうちの職業データ（サンプル数23,838）で，自由回答である「仕事の内容」「従業先事業の種類」の他に，選択回答である「従業上の地位」「役職」「従業先事業の規模」など複数の回答群から構成されている．
すべての職業データに195個ある職業コードのいずれか1つのコードが付与されており，本稿ではこの職業コードを正解とした．
例えば，次のような職業データには正解として職業コード「563」が付与されている．
JGSSデータセットにおいては，先に開発した自動コーディングシステム[CITE]の設定を踏襲し，「仕事の内容」と「従業先事業の種類」に出現する単語unigramおよび「従業上の地位」と「役職」を表す選択肢を素性として用いた．
訓練事例と評価事例の分割は，実際の職業コーディングの状況に似せて，すでに正解が付けられた過去のデータを訓練事例とし，これからコーディングを行う予定のデータを評価事例とした．
今回は，訓練事例として2000年から2002年までの3年間分のデータ（20,066サンプル），評価事例として2003年のデータ（3,772サンプル）に分割した．
さらに，訓練事例は正解率表を作成するため，5分割交差検定により訓練事例と評価事例に分割した．
すなわち，正解率表を作成するために，データを変えて訓練事例16,053サンプル，評価事例4,013サンプルに分割し，計5回の学習を行った．
20 Newsgroupsデータセット（サンプル数18,828）は，さまざまなUseNetのディスカッショングループに対応する20個のカテゴリのいずれかに分類されており，本稿ではこれを正解とした．
用いた素性は，ネットニュース記事に出現する単語unigramで，JGSSデータセットにおける自由回答の場合と同様である．
20 Newsgroupsデータセットでは，訓練事例と評価事例の分割は5分割交差検定により行った．
すなわち，データを変えて，例えば，訓練事例15,063サンプル，評価事例3,765サンプルとし，計5回の学習を行った．
正解率表の作成は，JGSSデータセットの場合と全く同様に，全訓練事例を5分割交差検定により，訓練事例（例えば12,053サンプル）と評価事例（例えば3,013サンプル）に分割し計5回の学習を行った．
セルの区間幅
最適なセルの区間幅は自動的に決めることができないために，実験を行って決める必要がある．
今回は，区間幅を0.05, 0.1, 0.2, 0.3, 0.5の5通りに設定した．
このとき，1つの正解率表においては，どの次元の軸も同一の区間幅で区切った．
第1位のクラスの分類スコア軸における区間幅とセルの数との関係は，表[REF_cell_interval]に示す通りであった．
評価尺度
実験1では，各手法の評価を行うために，Zadroznyら[CITE]にしたがい，次式で計算されるクロスエントロピーを用いた．
ただし，[MATH]は評価事例数，[MATH]は[MATH]番目の事例におけるクラス所属確率の推定値，[MATH]は[MATH]番目の事例における正誤状況で，正解の場合は[MATH],不正解の場合は[MATH]を表す．
クロスエントロピーの値が小さいほどよい手法であるとする．
実験2では，提案手法の評価を行うために，Caruanaら[CITE]にしたがい，予測値がどの程度実測値と重なるかを表す信頼度曲線を用いた．
予測値と実測値が重なる程度が高いほどよい手法であるとする．
また，Zadroznyら[CITE]にしたがい，ROC (receiver operating characteristic)曲線に基づいて計算されるAUC (Area Under the Curve)を用いた評価も行った．
AUCの値が大きいほどよい手法であるとする．
提案手法の性能評価としては，誤分類検出能力により従来の検出手法との比較を行った．
誤分類検出能力は，誤分類の事例を対象となる事例数のカバレッジが低い時点で多く検出できるほどよい手法であるとする．
セルの作成法
実験1を行う前の予備実験として，正解率表におけるセルの作成法について，分類スコアを等間隔に区切る方法（提案手法）を各ビンの事例数を等しくする方法（Zadoroznyらによるビニングの方法）と比較し，提案手法の有効性を確認した．
ここでは，Zadoroznyらによるビニングの方法との比較を可能にするために，提案手法においても用いる分類スコアを第1位のクラスに対するもののみとし，正解率の平滑化を行わない値を用いた．
ここで，提案手法における定義域は[MATH]であるが，今回用いたデータセットにおける第1位のクラスの分類スコアの範囲は，分類器がSVMの場合，JGSSデータセットでは[MATH], 20 Newsgroupsデータセットでは[MATH]であった．
表[REF_equal]は，2つの方法により作成されたセルからなる正解率表の有効性を，データセットや分類器を変えてクロスエントロピーにより比較した結果である．
表中，等間隔は我々の提案する方法（セルの区間幅を等間隔にする方法），等事例はZadroznyらの提案する方法（セルに含まれる事例数を等しくする方法）を表す．
表の値は，等間隔の方法では区間幅を0.1から0.5まで4通り，等事例の方法においても，この区間幅に対応させてセルの個数を30個から7個まで4通りに変化させた中のそれぞれ最もよかった場合の値である．
太字の数字は，2つの方法のうちよい方の値を示す．
表[REF_equal]において，セルを等間隔に区切る方法は，ナイーブベイズ分類器ではセルに含まれる事例を等しくする方法にやや劣るものの，SVMではどちらのデータセットでも大きく上回る結果を示した．
この傾向は，最もよかった値同士の比較だけではなく，セルの区間幅（セルの個数）が異なっても全く同様であった．
この理由としては，一般に，データを各区間の度数が等しくなるように分割する方法は各区間幅が等しくなるように分割する方法より推定効率が高いことが知られているが，一方で，密度関数推定の観点から大きなバイアスを引き起こす可能性があることが指摘されており[CITE],今回用いたデータセットの分類スコアの分布において，特にSVMを適用した場合にこのバイアス問題が生じたのではないかと考えられる．
その結果，セルを等事例で区切る方法において作成された正解率表は，セルに属する事例の分類スコアと正解率の関係を適切に反映したものにならなかったのではないかと思われる．
表[REF_equal]より，「分類スコアを等間隔に区切ってセルを作成する方法」により正解率表を作成する方法が有効であることが確認できたため，以下の実験では，セルの作成は分類スコアを等間隔に区切る方法を用いた．
なお，今回，等事例に区切る方法において最もよかったのは，セルの個数が12個または7個の場合であったが，Zadroznyらのビニングによる方法においてもビンの個数が10個の場合が最もよかったとの報告があり[CITE],第1位のクラスの分類スコアのみを用いる場合には，分類器やデータセットが異なっていても最適なセルの個数が類似していることは興味深い．
クロスエントロピーによる評価
表[REF_loglikelihoodJGSS]は，SVMを適用しJGSSデータセットを用いた場合のクロスエントロピーの値を，用いた分類スコア別，クラス所属確率を推定する方法別にまとめたものである．
表において，重み付け移動平均法はカバレッジを重みとする移動平均法を表す．
リッドストーン法においては最もよい場合の値を示す．
表の縦方向はセルの区間幅を0.05から0.5まで5通りに変化させたことを示しており，各区間幅の上段は利用した分類スコアが第1位のクラスのみの場合，下段は利用した分類スコアが第1位と第2位のクラスの場合の結果を示す．
表中の記号「---」はクロスエントロピーが計算できなかったセルがあったことを示す．
また，太字の数字は，表中のすべての値の中で最もよい値であることを示す．
表では省略したが，正解率表を利用する方法において，第1位から第3位まで3つのクラスの分類スコアを用いた場合のクロスエントロピーは，いずれも第1位のクラスのみの場合よりははるかによく第1位と第2位のクラスの場合よりやや悪かった．
なお，1節で述べた2種類の単純な変換[CITE]によるクロスエントロピーは，Nicllescu-Mizilらによる変換では1.4563であり，Zadroznyらによる変換では0.8332であった．
同様に，SVMを適用し20 Newsgroupsデータセットを用いた結果を表[REF_loglikelihoodNS]に示す．
表の形式や記号の意味などは表[REF_loglikelihoodJGSS]と同様である．
ここでも，正解率表を利用する方法においては，第1位から第3位まで3つのクラスの分類スコアを用いた場合のクロスエントロピーはJGSSデータセットを用いた場合と全く同様で，いずれも第1位のクラスのみの場合よりははるかによく，第1位と第2位のクラスの場合よりやや悪かった．
なお，1節で述べた単純な変換によるクロスエントロピーは，Nicllescu-Mizilらによる変換では計算できず，Zadroznyらによる変換では0.9199であった．
表[REF_loglikelihoodJGSS]および表[REF_loglikelihoodNS]より，次のことが明らかになった．
まず，SVMを適用した場合は，クラス所属確率を推定する方法やデータセットに関係なく，第1位のクラスの分類スコアのみ用いるより他のクラスの分類スコアも含めた複数の分類スコアを用いることが有効であった．
分類スコアの有効な組み合わせ方については，ロジスティック回帰による方法と正解率表を利用する方法で異なっており，ロジスティック回帰による方法は，第1位のクラスから第3位のクラスまで3つの分類スコアを用いた場合，正解率表を利用する方法は，第1位のクラスと第2位のクラスの2つの分類スコアを用いた場合が最もよかった．
ただし，いずれの方法においても，分類スコアの組み合わせ方の違いによる差は小さかった．
次に，ロジスティック回帰による方法も含めてすべての場合の中で最もよい結果を示したのは，最適な正解率表を利用した場合，すなわち「第1位と第2位のクラスの分類スコアを用いてカバレッジを重みとする移動平均法による平滑化を行った正解率表を利用する方法」（セルの区間幅0.1）であった．
ただし，正解率表を利用する方法は，セルの区間幅の決め方により結果に大きな差があった．
特にセルの区間幅を非常に小さく（0.05）設定した場合は，複数の分類スコアを用いることは有効ではなかった．
この理由は，セルの個数が増えることにより各セルごとに含まれる事例数が少なくなり，場合によっては事例が存在しないセルが出現したために，正解率における信頼性が低くなったことが原因であると考えられる．
正解率表を利用する方法においてはロジスティック回帰による方法と異なり，分類スコアを3つ用いた方が2つ用いた場合より結果が悪かった理由も，同様であると考えられる．
今回は，最適なセルの区間幅は，どちらのデータセットにおいても0.1であった．
これに対して，ロジスティック回帰による方法は，どちらのデータセットにおいても安定してよい結果を示した．
さらに，正解率表における平滑化の手法は，いずれもデータセットに関係なく有効であった．
特に，平滑化を行うセルの周囲にあるセルの情報も利用する方法である（カバレッジを重みとする）移動平均法は，セルの区間幅が適切であった場合によい結果を示した．
注目するセルの情報のみで平滑化を行うラプラス法やリッドストーン法は，クロスエントロピーにおいては大きな効果はなかったが，ゼロ頻度問題に対応できる点で評価できる．
ここで，正解率表を利用する方法における結論をより一般化させるために，分類器をナイーブベイズ分類器に変え，20 Newsgroupsデータセットによる実験を行った．
結果は表[REF_loglikelihoodNS_NB]に示すように，SVMの場合と同様に，第1位のクラスの分類スコアのみを用いた場合より，第2位のクラスまで2つの分類スコアを用いた場合の方がよかった．
また，平滑化手法は有効で，特にセルの区間幅が適切な場合に移動平均法はよい結果を示した．
ナイーブベイズ分類器において最もよかったのはセルの個数が30個の場合であり，これはSVMにおいて最もよかったセルの区間幅0.1の場合に該当する．
以上より，多値分類における第1位のクラスのクラス所属確率の推定は，複数の分類スコアを用いることが有効であった．
特に，最適な正解率表である「第1位と第2位のクラスの分類スコアを用いて（カバレッジによる重み付き）移動平均法による平滑化を行い，セルの区間幅を0.1（セルの個数30個）に設定した正解率表」を利用する方法は最も有効であった．
ただし，正解率表を利用する方法は設定されたセルの区間幅により結果が不安定であるという問題があったのに対して，ロジスティック回帰による方法は安定してよい結果を示した．
また，今回は，正解率表を利用する方法における最適な正解率表がデータセットや分類器に関係なく一致したが，この結果をさらに一般化するには，データセットや分類器をより多様なものに変えた実験を行って確認する必要がある．
したがって，現時点では，正解率表を利用する方法は，データセットや分類器が異なる場合に最適な正解率表を決定するための実験を行う必要があり，手間がかかるという欠点があるといえる．
ここでは，SVMを適用して，実験1において最適であった方法（以後，提案手法とよぶ）の評価を行った．
信頼度曲線およびROC曲線
信頼度曲線は，予測値（推定値）（[MATH]軸）と実際の値（[MATH]軸）の関係をプロットしたもので，予測値と実際の値が等しい場合には対角線上にプロットされ，対角線から離れるほど予測の精度が悪いことを示す．
ここでは，提案手法を，分類スコアを1つ用いた方法のうち，平滑化を行わない正解率表を利用する方法（以後，平滑化を行わない方法とよぶ）およびシグモイド関数による方法と比較した．
このとき，平滑化を行わない方法は，等事例ではなく等間隔に区切ったビニングによる方法であると考えることができ，シグモイド関数による方法はPlattの方法を簡略化したものであると考えられる．
今回は，予測値を0.1ずつ区切り10区間を作成し，予測値と真の値としていずれも区間内（例えば，[MATH]）に含まれる事例の平均を用いた．
JGSSデータセットによる結果を図[REF_reliability_JGSS]に，20 Newsgroupsデータセットによる結果を図[REF_reliability_20ng]に示す．
図[REF_reliability_JGSS]および図[REF_reliability_20ng]において，提案手法はどちらのデータセットにおいても対角線の近くにプロットされており，クラス所属確率を全体的にうまく推定することがわかった．
ROC曲線は，[MATH]軸がFPF（False Positive Fraction;偽陽性率），[MATH]軸がTPF（True Positive Fraction;真陽性率）を表す座標上に，正解率の程度により分類された各グループごとのFPFとTPFの値をプロットしたものである．
ここで，FPF＝注目するグループ内の不正解事例数／全不正解事例数，TPF＝注目するグループ内の正解事例数／全正解事例数である．
今回は，正解率を10点刻みに分類してFPFとTPFの値を求めた．
すなわち，最上位のグループ（正解率が91%〜100%の範囲にある事例）から始めて，上限を固定し下限を10%ずつ下げたグループ（例えば2番目のグループは，正解率の範囲が81%〜100%である事例の集合）を計10個作成し，各グループにおけるFPFとTPFを計算した．
ROC曲線においては，ROC曲線が左上方に位置するほど正確な推定が行われていることを示すが，より正確には，ROC曲線の下方にある領域であるAUC (Area Under the Curve)を計算し，その値が大きいほどよい手法であるとされる．
図[REF_ROC_JGSS_20ns]に，JGSSデータセットおよび20 Newsgroupsデータセットによる提案手法，平滑化を行わない方法，シグモイド関数による方法におけるROC曲線を示す．
また，3つの手法におけるAUCの値を表[REF_AUC_rank1]に示す．
図[REF_ROC_JGSS_20ns]および表[REF_AUC_rank1]より明らかなように，提案手法はいずれのデータセットにおいても他の2つの方法より正確な推定を行えることがわかった．
誤分類検出能力
事例をクラス所属確率の推定値の小さい順に並べたとき，カバレッジの値が小さいときにできるだけ多くの誤分類事例が検出されることが望ましい．
カバレッジをこのように考えた場合に，各カバレッジごとにどのくらい誤分類された事例を検出できるかを，本稿では誤分類検出能力とよぶ．
提案手法の誤分類検出能力を，JGSSデータセットおよび20 Newsgroupsデータセットを用いて評価した．
評価の方法は，提案手法によるクラス所属確率の推定値を値の小さい順に事例を並べ，カバレッジを10%ずつ増やしてできた区間ごとに，誤分類された事例数を調査した．
比較のため，既存の手法であるSchohnにより提案された単純な方法[CITE]による結果も示した．
単純な方法では，分類スコアの値の小さい順に並べ，同様にカバレッジを10%ずつ増やしてできた区間ごとに，誤分類された事例数を調査した．
それぞれのデータセットによる結果を図[REF_Lap-RawJGSS_ns]に示す．
図[REF_Lap-RawJGSS_ns]において，提案手法はどちらのデータセットにおいても常に単純な方法を上回った．
特に，20 Newsgroupsデータセットにおいては，カバレッジが小さい場合に大きく上回る点が評価できる．
その理由は，我々が実際に人手により分類誤りを検出する必要がある場合，チェックをするデータセットの量はできる限り少量の方が作業が楽であるからである．
JGSSデータセットでは，全体の40%をチェックすれば誤分類事例の80%を検出することができるが，20 Newsgroupsデータセットで同じ量をチェックすると，誤分類事例の90%を検出できる．
両者のデータセットにおける傾向の違いを説明する理由は明確ではないが，JGSSデータセットには非常に短く有効な素性が少ししか含まれない事例が多いため，正確な推定を行うために十分な情報がないことが原因であると考えられる．
以上をまとめると，多値分類において第1位に予測されたクラスのクラス所属確率の推定は，複数の分類スコアを用いることが有効であることがわかった．
特に，第1位と第2位に予測されたクラスの分類スコアを用いて作成した最適な正解率表を利用する方法が最もよい結果を示した．
ここで，最適な正解率表とは，セルの区間幅を0.1（セルの個数が30）として作成した正解率表を（カバレッジによる重み付き）移動平均法による平滑化を行ったものである．
ただし，正解率表を利用する方法は正解率表の作成法により結果が不安定であるという欠点があった．
この点において，ロジスティック回帰による方法は安定してよい結果を示した．
また，ロジスティック回帰による方法は，最適な正解率表を見つけるために実験を重ねる手間が不要であるという利点もある．
\
3節で，多値分類における第1位の予測クラスについてのクラス所属確率は，複数の分類スコアを用いた推定が有効であることが明らかになった．
本節では，3節で得られた結論を第2位以下の任意のクラスに対して拡張する方法を検討する．
この場合，どのクラスの分類スコアを組み合わせることが有効であるかを検討することが重要である．
本稿では，多値分類における第2位以下の任意のクラスについてのクラス所属確率を高精度に推定するために，推定したいクラス（第[MATH]位のクラス）と第1位のクラスの分類スコアを用いてロジスティック回帰により推定する方法を提案する．
すなわち，次式によりクラス所属確率の推定を行うことを提案する．
ここで，[MATH]は第[MATH]位の分類スコアを表す．
このとき，パラメータ[MATH], [MATH]および[MATH]は訓練事例を用い，最尤法によりあらかじめ推定しておく必要がある.
ここで，推定したいクラスの他に用いるクラスとして第1位のクラスを選択した理由は，3節でも述べたように，多値分類においては，第1位のクラスの分類スコアが最も大きく，どのクラスの分類スコアも第1位のクラスの分類スコアの値以上にはならないため，推定したいクラスの分類スコアの値を第1位のクラスの分類スコアとの相対的な関係で捉えることが有効であると考えたためである．
これを実現するための方法はいくつか存在するが，ここでは，3節と同様に最も単純に第1位のクラスの分類スコアをそのまま用いることにした．
また，クラス所属確率の推定方法については，第2位以下のクラスにおいては，第1位のクラスよりも分類スコアの傾向をさらに把握しにくくなるために，最適な正解率表を作成することが困難であると考えられる．
したがって，第1位のクラスの場合において安定した結果を示したロジスティック回帰による方法の方が有効であると考えた．
この2つの仮定を以下の実験により確認する．
実験の目的は，多値分類における第2位以下の任意のクラスのクラス所属確率の推定に用いる分類スコアは，提案手法による組み合わせ方が最も有効であることを示すこと（実験1），および第2位以下のクラスにおいては，ロジスティック回帰による方法が正解率表を利用する方法より有効であることを示すこと（実験2）である．
実験設定は3節と同様で，分類器はSVMを適用した．
実験1では第2位から第20位までのクラス，実験2では第2位から第5位までのクラスについて調査した．
分類スコアの候補
実験1を行う前の予備実験として，推定したいクラスのクラス所属確率と関連の深いクラスを発見するために，第2位以下のすべてのクラスについて，注目するクラスの正誤状況（正解の場合1，不正解の場合0）と全クラスの分類スコアとの相関関係を調査した．
これは，注目するクラスの正誤状況と相関係数の絶対値が大きい分類スコアのクラスほど注目するクラスとの関連が強いと仮定したためである．
したがって，相関係数の絶対値の大きな分類スコアが多い順位のクラスを候補として用いることを検討した．
JGSSデータセットと20 Newsgroupsデータセットを用いて第2位から第20位のクラスにおいて，各クラスごとに関連の強かったクラスを表[REF_correlation]にまとめる．
表[REF_correlation]より，注目するクラス（推定したいクラス）自身より第1位のクラスの方が多かったため，用いるクラスの候補として第1位のクラスを候補とした．
また，注目するクラスの直前や直後のクラスも候補とした．
次に，これらの3つのクラスの分類スコアを推定したいクラスとそれぞれ単純に組み合わせた場合におけるクロスエントロピーを，JGSSデータセットと20 newsgroupsデータセットを用いて調査した．
その結果，どちらのデータセットにおいても，第1位のクラスの分類スコアを組み合わせた場合以外は有効性が認められなかったため，実験1では，複数の分類スコアとして次の3つの組み合わせ方を考え，「推定したいクラスの分類スコアのみを用いる」場合と比較を行った（（）内は用いる分類スコアの数を表す）．
このとき，分類スコアを3個以上用いた場合のクラス所属確率の推定には，3節で述べた（1）式を適宜修正した式を用いた．
［提案手法］「推定したいクラスと第1位のクラスの分類スコア」（2個）
「第1位のクラスから推定したいクラス（第[MATH]位のクラス）までのすべてのクラスの分類スコア」（[MATH]個）
「推定したいクラスとその直前および直後のクラスの分類スコア」（3個）
提案手法の有効性
図[REF_rank2-12_JGSS_20ns]は，JGSSデータセットと20 Newsgroupsデータセットにより，用いた分類スコアの組み合わせを変えた場合のクロスエントロピーを，推定したいクラスの順位別（[MATH]軸）に示したものである．
ただし，どちらのデータセットにおいても，13位以下のクラスにおいては12位と同様の傾向であったために省略した．
図[REF_rank2-12_JGSS_20ns]から明らかなように，どちらのデータセットにおいても，推定したいクラスが上位の場合には，推定したいクラスの分類スコアのみを用いるより，クラスの組み合わせ方に関係なく複数の分類スコアを用いた方がよかった．
特に提案手法である「推定したいクラスと第1位のクラスの分類スコア」を用いた場合は，どの順位においても最もよかった．
ただし，推定したいクラスの順位が下がるにつれて，どの方法もクロスエントロピーの値が小さくなり，方法間の違いの差がみられなくなった．
この理由は，クラスの順位が下がるにつれてどの方法であってもクラス所属確率の推定値が小さくなり，また予測されたクラスも不正解である場合が多くなるために，クロスエントロピーも小さくなったためだと考えられる．
次に，提案手法を含めた4つの方法におけるROC曲線を，第2位のクラスと第3位のクラスに注目した場合についてそれぞれ図[REF_ROC2]および図[REF_ROC3]に示す．
ただし，第2位のクラスにおいては，「第1位から推定したいクラスまでのすべてのクラスの分類スコアを用いる方法」は提案手法と同じ方法であるために，図[REF_ROC2]では省略した．
また，図9，図10におけるAUCを表[REF_AUC_rank23]に示す．
表中，太字の数字は，各ケースにおいて最もよい値であることを示す．
図[REF_ROC2],図[REF_ROC3],表[REF_AUC_rank23]より，注目するクラスやデータセットが異なっても，複数の分類スコアを用いる方法は，注目するクラスの分類スコアだけを用いる方法よりよかった．
AUCによる評価において最もよかった方法は，JGSSデータセットの場合は提案手法であり，20 Newsgroupsデータセットの場合は，注目するクラスと直前および直後のクラスの分類スコアを用いる方法（第2位のクラスの場合）や，第1位から推定したいクラスまでのすべてのクラスの分類スコアを用いる方法（第3位のクラスの場合）であった．
ただし，提案手法は20 Newsgroupsデータセットの場合も安定してよかった．
以上より，第2位以下の任意のクラスについてのクラス所属確率を推定する場合も，複数の分類スコアを用いることは有効であり，特に推定したいクラスと第1位のクラスの分類スコアを用いる方法は有効であることが示された．
最後に，ロジスティック回帰式におけるパラメータを最尤推定するために用いる訓練事例数を変化させたときのクロスエントロピーを調査した．
図[REF_JGSS_train_size]は，JGSSデータセットにより，推定したいクラスの分類スコアのみ用いる方法と提案手法を比較したものである．
[MATH]軸は訓練事例数を表しており，右端はこれまでの実験において訓練事例として用いられてきた20,066サンプルの場合，左端は1,000サンプルにまで減らした場合を表す．
図[REF_JGSS_train_size]より，まず，訓練事例の数に関係なく提案手法が有効であることがわかった．
また，訓練事例が1,000サンプルと比較的少ない場合でも，ロジスティック回帰による方法は安定してよい結果を示すこともわかった．
ここでは，提案手法による分類スコアの組み合わせにおいて，ロジスティック回帰による方法を最適な正解率表を利用する方法と比較した．
このとき，最適な正解率表としては次の2つを検討した．
1つは第1位のクラスについて推定する場合に最も有効であった正解率表（セルの区間幅を0.1に設定）で，推定したいクラスごとに新たな正解率表を作成する手間を省略する目的で用いた．
もう1つは，第2位以下の各クラスにおける分類スコアのとる値の状況に合わせて，セルの区間幅を適宜（例えば0.2など）変えたもので，「正解率表（改良版）」とよぶことにする．
いずれの正解率表も，3節で最も有効であった平滑化手法すなわちカバレッジを重みとする移動平均法による平滑化を行った．
図[REF_JGSS_20ns_seikai_hikaku]に，ロジスティック回帰による方法と正解率表を利用する方法におけるクロスエントロピーを示す．
図[REF_JGSS_20ns_seikai_hikaku]より，注目するクラスが第2位から第5位までの場合の平均において，ロジスティック回帰による方法が最も有効であることが示された．
正解率表（改良版）を利用する方法は，JGSSデータセットにおいて第2位のクラスに注目する場合や，20 Newsgroupsデータセットにおいて第3位のクラスに注目する場合のみ，ロジスティック回帰による方法よりわずかによい結果であったが，注目するクラスに対して毎回，最適な正解率表を作成する手間がかかるという欠点がある．
3つの方法におけるROC曲線の例として，JGSSデータセットを用いて第2位のクラスに注目する場合を図[REF_ROC_JGSS_seikai_hikaku]に示す．
このとき，3つの方法におけるAUCは，それぞれロジスティック回帰による方法（0.7443），第1位のクラスに対する最適な正解率表を利用する方法（0.7260），正解率表（改良版）を利用する方法（0.7449）で，JGSSデータセットにおいて第2位のクラスを推定する場合に限り，正解率表（改良版）を利用する方法がロジスティック回帰による方法をやや上回った．
今回，第6位以下のクラスについては比較実験を行っていないが，先に述べたように，下位のクラスになるにしたがって最適な正解率表の作成は困難になることが予想されるため，第6位以下のクラスにおいてもロジスティック回帰による方法が有効であると考えられる．
以上より，第2位以下の任意のクラスにおいても，ロジスティック回帰による方法の方が正解率表を利用する方法より有効であると判断できた．
