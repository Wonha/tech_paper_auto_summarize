本節ではツイートデータとそれに付随したジオタグデータから利用者の実行動データを作成する分析フレームワークについて述べる．
図[REF_fig:frame]に示すように，本研究の分析フレームは(1)ツイートから行動を予測するパート，(2)言語的・非言語的説明要因を生成するパート，(3)生成された説明要因から行動結果を説明するモデルを構築するパートの[MATH]つに分けることができる．
(1)ではツイートデータからはその行動結果を伝える発言のBag of Words (BoW)表現を特徴量化することで，機械学習的手法を用いてユーザー別の行動結果の推測を行う．
(2)ではラベル化された行動結果，ここではそれを意思決定における選択肢集合と呼ぶが，その選択肢集合ごとの説明要因をジオタグデータやツイートデータから作成する．
ジオタグから作成される説明要因は距離，徒歩による所要時間や鉄道による所要時間，運賃などである．
また，ツイートデータから作成される説明要因は家族に対する心配や鉄道運行再開情報，自身の不安感といった外的・内的要因である．
(3)では，これらの説明要因をもとに，各ユーザーの行動結果を説明する意思決定モデルを構築する．
ここで，(1)パートと(3)パートの違いを確認しておこう．
(1)では「歩いて帰ったので疲れた」「電車が動かないので会社に泊まることにした」といったツイートをそれぞれ「徒歩帰宅」「宿泊」とラベル化する処理であるのに対し，(3)では「徒歩帰宅」したのは「自宅と外出先の距離がそれほど遠くなかったから（距離的要因）」なのか「家族の様子が心配だったから（心理的要因）」なのかを定量的に明らかにする分析である．
そのため，(3)で構築するモデルの説明変数（特徴量）は解釈のしやすい説明変数を選択しており，またその結果として，簡易的な感度分析としてのシミュレーションを行うことが可能である．
本研究で用いるデータはTwitter Japan株式会社によって提供された東日本大震災発生時より1週間の日本語ツイートデータ（約1億8000万ツイート）である．
このうち，ユーザーによってジオタグが付与されたツイートは約28万件である．
その中で2011年3月11日14:00から2011年3月12日10:00までの日時にGPS座標が首都圏に含まれ，またbotを除くために利用者が20人以上のTwitterクライアント（Twitterに投稿するためのクライアントソフトウェア）からpostされたツイートデータを24,737件抽出した．
この24,737ツイートのユニークなユーザー数（アカウント数）は5,281人であり，そのうち上記期間中に2つ以上ジオタグが付与されたツイートを行ったユーザー数は3,307人である．
この3,307人のユーザーは震災当日から翌日にかけて首都圏における震災当日の自身の帰宅行動に関してつぶやいており，また2つ以上のジオタグによって勤務地・自宅間の近似的距離が得られる可能性が高いと考えられる．
そこで，前後の文脈も参考にするために，これらのアカウントのツイートのうち，2011年3月11日12:00から2011年3月12日12:00までの24時間のツイートを抽出した．
これらの総ツイート数は132,989ツイートであり，一人あたり40.2ツイートである．
この3,307名，132,989ツイートを本研究で取り扱うデータセットとする．
Twitterというソーシャルメディアを利用しているユーザー層と2011年3月11日に首都圏に通勤していた人々の間には当然母集団の違いがあり，またこのような方法でサンプリングが行われたデータには一定のバイアスが存在するため，別の調査データと比較することで，本研究のサンプリングデータの偏りについても考察を行う．
高々3,307名のツイートとはいえ，それらの内容を読み，人手で行動結果をラベリングすることは容易ではない．
本研究では2つ以上ジオタグが付与されたユーザーのみを対象としているが，震災当日の全ツイートを対象に，ラベリングを行うとなると非常に大きな人的資源が必要となるだろう．
そこで，本研究ではサポートベクターマシンを用いてラベリングを行い，当日の行動結果を推測することとする．
そのための教師データ作成プロセスとして，本データセットの中からランダムに抽出した300名の3月11日，3月12日のツイートを時間軸に沿って読むことで，人手で帰宅行動結果のラベリングを行う．
ラベルとしてはこの300名の結果に表れた「徒歩のみで帰宅」「鉄道を利用して帰宅」「会社等に宿泊」「その他（自動車，自転車，バイク，バス，タクシーなど）」「不明」の5種類に分類した．
今後はこれらを1)徒歩，2)鉄道，3)宿泊，4)その他，5)不明と名付ける．
それぞれの割合は徒歩が120名，鉄道が56名，宿泊が54名，その他が10名，不明が60名である．
次に，教師データ300名を含む3,307名の2011年3月11日12:00から2011年3月12日12:00までのツイートのうち，リツイート(RT)したツイートを除く全てのツイートの形態素解析を行った．
形態素解析にはMeCabを用いた．
リツイート(RT)とはTwitterにおいて自分以外の他者の発言を引用する行為であり，そのユーザー個人の行動を反映しないと考えたため，上記のような処理を行っている．
また，形態素解析された形態素のうち，ストップワードとなりうる助詞，記号，Twitterアカウント名，MeCabによって記号と認識されなかった記号（たとえば@）を除いた．
形態素解析を用いた結果，データセットから70,364のユニークな単語が得られた．
これらの形態素のうち，頻度100以上となったものは1,368，頻度50以上は2,412，頻度25以上は4,109，頻度10以上は8,244存在した．
頻度が上位100位となった形態素を一例として表[REF_tab:word_list01]に示す．
これらの形態素は東日本大震災当日，翌日の状況を表しうる形態素も含まれているが，単純に頻度の多い形態素も多く含まれている．
そこで，教師データによる分類クラスを用いて適切な素性選択を行うことを試みる．
形態素解析によって得られた単語[MATH]の出現有無の情報がクラスに関するエントロピーの減少度合いを表す指標として情報利得が存在する．
単語[MATH]に対する確率変数[MATH]を考え，対応する単語が出現した場合[MATH]，そうでない場合は[MATH]とする．
クラスを表す確率変数を[MATH]とすると，エントロピー[MATH]は
と定義される．
このとき，ある単語[MATH]が出現した場合，出現しなかった場合の条件付きエントロピーは
H(C|X_w = 1) = \sum_c P(c|X_w = 1) \log P(c|X_w = 1)
H(C|X_w = 0) = \sum_c P(c|X_w = 0) \log P(c|X_w = 0)
となる．
このとき，単語[MATH]の情報利得[MATH]はエントロピーの平均的な減少量として次のように定義される．
5つの分類クラスを用いて，頻度2以上の全て単語の情報利得をそれぞれ算出した．
情報利得上位100の単語を，各単語が出現した際の分類クラスの条件付き確率が最も高いクラスごとに整理したものが表[REF_tab:word_list]である．
まず，表[REF_tab:word_list01]と比べて当日の帰宅行動に関する単語が多く含まれていることが観測される．
例えば，表[REF_tab:word_list]の中で1)徒歩帰宅の条件付き確率が高い単語として，現在の位置を伝える「半分」「遠い」「km」「川崎」「環」「七」や徒歩帰宅時の問題を伝える「トイレ」「ヤバイ」「疲れ」などを挙げることができる．
2)鉄道帰宅に関しては「入場」のような鉄道帰宅固有の単語のみならず「なんとか」「奇跡」といった鉄道運行再開によって，帰宅できたことを示す単語が含まれる．
3)宿泊の条件付き確率が高い単語には「朝」「明け」「明るく」などの会社などで一晩を過ごしたことを伝える単語，「次第」「目処」「始発」「悩む」など帰宅タイミングを示す単語が含まれている．
また，翌日鉄道で帰宅した影響や待機・宿泊場所で様々なメディアから情報を入手したためか「ホーム」「運行」「混雑」「改札」「乗車」「駅員」などの鉄道に関連する単語が多く含まれていることも特徴である．
次に，興味深い結果として，個別の鉄道路線に関しては3月11日当日に運行が再開されなかった「JR」「総武線」「京浜東北」線は3)宿泊の選択者が相対的によく発言しており，当日運行を再開した「大江戸」線や「田園都市線」「京王」線は2)鉄道利用者が相対的に発言しやすいことが示された．
この傾向は震災時に人々は自身の帰宅鉄道ルートについて発言しやすいことを表しており，これらの単語の出現有無は当日の帰宅行動を表す重要な単語であるといえよう．
このように，情報利得の高い単語は当日の帰宅行動のラベリングに有用であると考えられるため，これらを素性として分類器を構成する．
サポートベクターマシン(SVM)の概要を示す．
素性ベクトル[MATH]の次元が[MATH]であるとすると，1つの素性ベクトルは[MATH]次元空間中の点として表すことができる．
正・負のラベル[MATH]に対して，正例と負例はすべてこの[MATH]次元空間に配置したとする．
このとき，正例と負例を分ける2クラス分類問題は正例と負例を分離する超平面[MATH], [MATH]を決める問題に帰着できる．
SVMはノイズを許容しつつ，超平面に最も近い正例と負例との間のマージンを最大化するような分離平面を求めるアルゴリズムである．
マージン最大化は式([REF_eq:svm01])を式([REF_eq:svm02])の条件で最大化する双対問題と等価であることが知られている．
\sum_{i=1}^{l} \alpha_i - \frac{1}{2} \sum_{i, j}^{l} y_i y_j \alpha_i \alpha_j K(\boldsymbol{x_i}, \boldsymbol{x_j})
\text{subject to} \nonumber
\sum_{i=1}^{l} y_i \alpha_i = 0          0 \leq\alpha_i
また，カーネル関数[MATH]により，入力されたデータを高次元の素性空間(feature space)に写像し，素性空間において超平面を求めることにより，入力空間においては非線形となる分離も可能である．
本論文では線形カーネルを用いた．
以上のようにして得られた超平面を用いて，分類器が構成される．
新たに与えられた素性ベクトルに対して，超平面の正例側をプラス，負例側をマイナスとし，超平面からの距離を正規化した値を計算することにより，分類器は与えられたデータが正，負の2クラスのどちら側に属するかを判定する．
SVMは正例・負例を分類する二値分類器であるが，本研究のように3つ以上のクラスに分類する多値分類が必要な場合が存在する．
その場合は多値分類に拡張するための代表的手法として，one class vs all other法やpairwise法がある．
本論文ではpairwise法を用いた．
前述の人手でラベリングされた[MATH]件のデータを教師データとして学習する．
表[REF_tab:word_list]に一部示した頻度2以上の情報利得の上位500の単語を用いて，各ユーザーのツイート内のこれらの単語の出現有無をベクトル表現（BoW表現）し，それらをSVMの素性に用いている．
学習ではデータを9分割交差検定(9-fold cross validation)とパラメータチューニングを行った．
得られたモデルの全教師データに対する正解率は[MATH]，交差検定で得られた平均正解率は[MATH]であった．
SVMにて帰宅行動結果をラベリングされた結果を以下に示す．
[MATH]名のうち，1)徒歩での帰宅者は[MATH]名，2)鉄道での帰宅者は[MATH]名，3)宿泊した人は[MATH]名，4)その他の交通手段での帰宅者が[MATH]名，5)不明が[MATH]名と予測された．
この結果は不明を除く全体の[MATH]（徒歩[MATH]，鉄道[MATH]，その他[MATH]）が帰宅行動を行ったことを示している．
本研究の推測結果を考察するために，図[REF_fig:svm_result]にて別主体による震災当日の帰宅行動調査結果との比較を行う．
サーベイリサーチセンター(SRC)によって行われた調査(SRC 2011)は2011年4月に実施された調査，遊橋による調査「東日本大震災における通信メディアと情報行動に関する定量調査」やその報告(遊橋2012)は2011年11月に実施された調査である．
(SRC 2011)では[MATH]名へのアンケートから，全体の[MATH]が当日自宅に帰ることができたという結果を得ており，(遊橋2012)も[MATH]が帰宅成功しているという同様の結果を得ている．
それに対し，本研究での推測では[MATH]と5, 6%高い帰宅成功率という結果となった．
これらの調査では帰宅時の交通手段について尋ねていない点とTwitterでは各ユーザーの個人属性が明らかではない点から，帰宅者の割合が多いデータの偏り要因をはっきりと明らかにすることはできない．
しかし，SRCの調査では都県[MATH]性年代の均等割付を行い調査を行っている点，遊橋の調査では2005年時の国勢調査に基づき人口割合を鑑みてサンプリングを行っている点を考えると，本研究で利用したTwitterデータではユーザー層が比較的若年層に偏り，また都市部での利用割合が相対的に高いと考えられるため，Twitterユーザー層特有のサンプリングバイアスであると考えられる．
2節で得られたユーザー別帰宅意思決定の予測をもとに，非言語的・言語的説明要因をツイートデータやジオタグデータから作成し，各個人の帰宅意思決定の要因を分析する．
まず，ユーザー別ジオタグデータを用いて，交通行動に関する説明要因を作成する．
本研究では簡単のために発災時以降の時刻が最も早い位置座標を勤務地（出発地）位置座標，2011年3月12日12:00以前の時刻が最も遅い位置座標を自宅（到着地）位置座標と設定した．
次にこれらの位置座標を用いて，道路ネットワーク距離，徒歩所要時間，勤務地最近隣駅，自宅最近隣駅，鉄道所要時間，鉄道費用，鉄道乗り換え回数を作成する．
これらはすべて平常時のネットワークを用いて作成したデータである．
人々の帰宅行動の空間的広がりを表現するために，図[REF_fig:locationmap]によって勤務地最近隣駅，自宅最近隣駅のそれぞれ上位30ヶ所を図示する．
勤務地最近隣駅の空間的分布を見る限り，首都圏におけるオフィスが集中したエリアであることがわかるが，自宅最近隣駅の空間分布が必ずしも住宅地になっておらず，ターミナル駅が多く含まれている．
ジオタグ付きツイートの傾向として，Twitterユーザーはプライバシーの問題から自宅位置のジオタグを付与することはあまり見られず，「最寄り駅に着いた」「川崎までやってきた」「ここでやっと半分」のように自分の移動軌跡の目印となる点でつぶやくことが多い．
そのため，この結果はこれらはジオタグ付きツイートが自宅付近でされたのではなく，ターミナル駅や乗換で行われたことを示唆しているといえよう．
しかし，全体的な傾向として，勤務地分布と自宅分布は空間的に異なる分布をしており，帰宅方向（郊外方向）へ分散していることが示された．
次に，作成した勤務地・自宅間の道路ネットワーク距離による帰宅意思決定のクロス集計結果を図[REF_fig:distance_cross]に示す．
この結果は自宅との距離が長くなるにつれて相対的に徒歩の割合が減少するが，[MATH]km以上離れていても[MATH]以上の人々が徒歩を選択したことを示している．
また，鉄道の割合は10〜20 kmの人々が最も高く，それ以上の距離になると，鉄道運行停止の影響を受け，宿泊を選択する割合が高くなっていることが示された．
先ほどと同様，上記の距離は必ずしも勤務地・自宅間の距離を示す値ではないが，自宅までの経路の移動途中結果を示す近似的距離であり，このネットワーク距離は帰宅意思決定行動の重要な要因である．
最後に，言語的説明要因の生成を行う．
前節では職場と自宅間の物理的距離が帰宅意思決定の要因であることを示したが，その他にも家族の存在や情報の有無が帰宅意思決定に影響を与えていると推測される．
そこで，各ユーザーの発言から帰宅意思決定行動に影響を与える要因を抽出する．
しかし，意思決定結果によって発言内容にはセルフセレクション・バイアスが生じる可能性があるため，各意思決定結果ごとの傾向をまず示す．
帰宅意思決定ごとのRTを除く平均ツイート数は1)徒歩が22.6件，2)鉄道が51.8件，3)その他が80.2件，4)宿泊が61.4件，5)不明が24.1件である．
サンプル数の少ないその他や不明を除くと，宿泊・鉄道選択者は徒歩選択者に比べて2.3倍から2.7倍のツイート数がある．
これは職場や駅等での待機中にTwitterで発言していたためと考えられ，直感に合う結果である．
しかし，発言数が多いことによって相対的に影響要因と考えられる話題のツイートも増加するため，ある話題に対する発言頻度が他の意思決定に比べて多いからといって意思決定要因であると単純に考えることはできない．
そこで，全ツイート内での各話題の発言割合を用いて基準化を行い，以降の分析を行う．
まず，家族との安否確認が帰宅意思決定に与えた影響について分析を行う．
本研究では家族を同居の配偶者および子供と定義した．
表[REF_tab:element_list]の単語による抽出を行った上で人手でアノテーションを行った結果，3,307名のうち353名が同居の家族の存在を発言していた．
これらの人々の発言の中から「嫁からメール来た。
ちょっと安心。
」「妻と娘にやっと電話が繋がった。
」や「嫁にメールが届かない」「息子の保育園と電話が通じない」といった安否確認，安否未確認のツイートを人手で抽出した．
3月12日12時までのツイート内で，安否確認ツイートと安否未確認ツイートの比率は徒歩帰宅者が[MATH]と帰宅行動間でほぼ差がない結果となった．
そこで，安否確認・安否未確認ツイートの時間帯の分析を行う．
図[REF_fig:FamilyTIme]は徒歩，鉄道，宿泊の意思決定者別の安否確認・安否未確認ツイートの時間帯割合を示している．
安否確認ツイートに関しては18時台までに徒歩は[MATH]，鉄道は[MATH]，宿泊は[MATH]が集中している．
宿泊者の安否確認の割合が相対的に高いが，徒歩と鉄道では同程度の割合である．
一方で，安否未確認ツイートは18時台までに徒歩は[MATH]，鉄道は[MATH]，宿泊は[MATH]であり，安否確認と同様の傾向のように思えるが，「家族と連絡が取れた」という安否確認ツイートと異なり，安否未確認ツイートは安否確認が取れるまでのどの時間帯でも行うことが可能であるため，より各個人の心理的要因が強く反映していると考えることができる．
より早い時間帯に発言することがその個人にとってより重要であるという仮定に立つならば，徒歩帰宅者は鉄道帰宅者よりも家族の安否が未確認であることを問題視し，より早い時間帯での帰宅意思決定を行ったと考察される．
一方で，最も早く安否未確認ツイートを行っている宿泊選択者は距離や鉄道網が動いていないことによる物理的制約の方がより大きかったと考察される．
次に，運行再開情報と帰宅意思決定の関係性を分析する．
冒頭にも述べたように，当日の鉄道路線は20時40分以降，五月雨式に再開された．
職場で待機・宿泊するか，それとも再開した鉄道を利用して帰宅するかは鉄道再開情報の入手有無に依存する．
そこで，表[REF_tab:element_list]の単語を用いて人手でアノテーションを行った鉄道再開関連ツイートの各個人の発言内での割合と帰宅意思決定結果の関係を示したのが図[REF_fig:trainInformation]である．
この図は鉄道選択者が鉄道再開情報を発言しやすいことを示している．
これは必ずしも鉄道再開情報を入手した人が鉄道を利用したという因果関係があることを示すわけではないが，鉄道選択者が鉄道再開情報をツイートすることでフォロワー達に鉄道再開情報を拡散したことは間違いないだろう．
最後に個人の心理的要因と帰宅意思決定の関係性を分析する．
震災当日は「地震怖い」「不安だ」などの自分の心理状況に関する発言が多く見られた．
この心理状況は他者（主に家族）に対する心配要因とは異なるため，これを自分不安と定義する．
自分不安発言は表[REF_tab:element_list]の単語が含まれている発言として定義した．
深夜は余震発生などによる別要因による不安要素が多く含まれるため，地震発生後から3月11日20時までの自分不安発言の発言割合と帰宅意思決定結果の関係性を図[REF_fig:anxiety]に示す．
興味深いのは自分不安発言が[MATH]未満の個人は宿泊が多いのに対し，5%以上の発言割合になると徒歩帰宅が増加している点である．
発言頻度が多ければ多いほど，各個人は強くその意識をもっていると仮定するならば，少し不安感を感じた人々は会社等に宿泊して他者と一緒に過ごすのに対し，大きな不安感を感じた人は徒歩によって帰宅しやすいと考察することができる．
これまでの結果をまとめる．
まず，職場・自宅間のネットワーク距離が帰宅意思決定の大きな影響要因であることを示した．
次に，家族の安否確認・未確認発言ではその発言時間帯が帰宅意思決定に影響を与えた可能性を示唆している．
運行再開情報の発言や自分不安発言も，それぞれの帰宅意思決定と関連があり，特にその発言の頻度割合が帰宅行動と強く相関していることが示された．
3までに作成されたデータをもとに，意思決定モデルの構築を行う．
離散選択モデルの概要を示す．
離散選択モデル(Discrete Choice Model)は計量経済学，交通行動分析，マーケティングなどの分野で用いられる計量モデルであり，ランダム効用モデル(Random Utility Model)とも呼ばれる(Ben-Akiva and Lerman 1985; Train 2003)．
本研究で用いる多項ロジットモデル(Multinomial Logit Model; MNL)は離散選択モデルの中で最も基本的なモデルである．
このモデルは数学的には多クラスロジスティック回帰モデルや対数線形モデル，最大エントロピーモデルと等価であるが，その経済学的な解釈と導出過程が異なる意思決定モデルである．
また，機械学習における分類問題とは異なり，その予測精度のみを評価するのではなく，各変数（機械学習における特徴量）の係数パラメータの吟味を行い，その大小関係や正負の検討，経済学的な解釈を行う点がモデルの利用時に異なる点である．
意思決定者[MATH]が選択肢集合[MATH]に直面しているとする．
意思決定者は各選択肢を選択することから効用を得ることができるとし，個人[MATH]が選択肢[MATH]から得られる効用を[MATH]と定義する．
この効用は意思決定者には観測可能であるが，分析者には観測不可能であるとする．
意思決定者は効用最大化に基づき意思決定を行うので，その行動モデルは次の条件[MATH]が成り立つ場合に限って，選択肢[MATH]を選択する．
各利用者の効用は観測不可能であるが，分析者にはその一部である効用の確定効用項[MATH]は観測可能であるとする．
ここで，[MATH]は個人[MATH]と選択肢[MATH]に関連する説明変数，[MATH]は個人[MATH]特有の説明変数である．
分析者にとって観測不可能な要素を誤差項[MATH]とし，効用は[MATH]と分解可能であるとしよう．
また，[MATH]とする．
分析者は[MATH]がわからないため，確率変数として取り扱う．
そのため，[MATH]が従う確率密度関数を[MATH]とすると，意思決定者[MATH]が選択肢[MATH]を選択する確率は
である．
ここで，[MATH]は括弧内が成り立っていれば[MATH]，そうでなければ[MATH]となるindicator functionである．
誤差項が次の式で表されるi.i.d.なガンベル(Gumbel)分布（type I extreme value分布とも）に従うと仮定する．
f(\varepsilon_{nj}) & = e^{-\varepsilon_{nj}} e^{-e^{-\varepsilon_{nj}}}
F(\varepsilon_{nj}) & = e^{-e^{- \varepsilon_{nj}}}
このとき，意思決定者[MATH]が選択肢[MATH]を選択する確率は
として導かれる．
このようにして導かれる選択確率をもつモデルが最も基本的な離散選択モデルである多項ロジットモデルである．
MNL提案後，選択肢間の誤差項間の相関を考慮したNested Logitモデルや更に緩和を加えたGeneralized Nested Logit Model (Wen and Koppelman 2001)やnetwork GEV Model (Daly and Bierlaire 2006)，また誤差項に正規分布を仮定したProbitモデルやProbit ModelとLogit Modelの良い面を合わせたMixed Logit Model (McFadden and Train 2000)等が提案されている．
本研究では分析の見通しを良くするために，基本的なモデルであるMNLを用いる．
離散選択モデルでは観測可能な確定効用項[MATH]を一般的に[MATH]と定義する．
[MATH]は係数ベクトル，[MATH]は個人[MATH]の選択肢[MATH]に関する説明変数ベクトルである．
これより，線形効用関数として定義したMNLが数学的に対数線形モデルと等価となることが理解される．
本研究ではデータセットとして，SVMによって識別された3307名のデータのうち，不明を除く2672名，選択肢集合は徒歩，鉄道，その他，宿泊の4選択肢を用いる．
1)徒歩の説明変数には徒歩所要時間，自分不安ツイート割合，徒歩選択肢固有定数を採用，2)鉄道の説明変数には鉄道所要時間，職場・自宅間の距離の対数，運行再開情報ツイート割合，17時までに家族の安否確認が行えた場合1となるダミー変数，鉄道選択肢固有定数を採用，4)宿泊の説明変数には自分不安ツイート割合，待機場所ツイート割合，17時までに家族の安否確認ダミー変数，宿泊選択肢固有定数を採用した．
待機場所ツイート割合は各個人のツイートのうち「会社」「職場」「学校」を含むツイートの割合である．
3)その他の効用項は0に基準化している．
個人[MATH]における各選択肢[MATH]の確定効用関数は上記の説明変数の線形和[MATH]として表現される．
このような効用関数を定義することで，式([REF_eq:DCM])における各選択肢の選択確率[MATH]が定式化される．
次に，得られたデータから効用関数の係数パラメータの推定方法について概説する．
MNLモデルはclosed formで定式化されるため，伝統的な最尤推定法が適用可能であり，また大域的に凸であるため(McFadden 1974)，推定パラメータは一意に決定できる．
MNLの対数尤度関数は次のように書くことができる．
ここで，[MATH]は個人[MATH]が選択肢[MATH]を選択したならば[MATH]，そうでなければ[MATH]となるクロネッカーの[MATH]である．
離散選択モデルにおいては，モデルの当てはまりの良さを示すのに尤度比指標（McFaddenの決定係数とも呼ばれる）を一般的に用いる．
この尤度比指標は次のように定義される．
ここで，[MATH]は対数尤度関数に推定パラメータを代入した値，[MATH]は対数尤度関数に[MATH]を代入した値であり，[MATH]が成り立つ．
これは0に近づけば当てはまりが悪く，[MATH]に近づけば当てはまりが良いと解釈できる．
上記の設定の下で，パラメータを推定した結果を表[REF_tab:transition_probability]に示す．
まず，修正済み尤度比指標は[MATH]であり，モデル全体の当てはまりは十分に良い．
また，所要時間の係数パラメータは負である点，職場・自宅間の距離が増加するにつれて鉄道の選択確率が増加する点などこれまでの基礎分析や直感に合う結果となっている．
また，自分不安ツイート割合は徒歩と宿泊で異なるパラメータとして推定を行っているが，自分不安ツイート割合が徒歩選択に対してより大きな影響を与えていることがわかる．
自分不安ツイートと所要時間のパラメータの比より，例えば自分不安ツイートが[MATH]増加することは[MATH]分の所要時間が増加しても宿泊より徒歩を選択することを示している．
待機場所ツイート割合は宿泊選択を促していることから，待機場所の有無が宿泊の重要な要因であることも示された．
加えて，基礎集計からも明らかになったように，運行再開ツイート割合は鉄道選択を促すことを説明している．
家族との関係性については，17時まで（地震発生から2時間14分以内）に家族との安否確認が行えたことの影響は鉄道・宿泊を大幅に選択しやすくなることから，安否確認が冷静な行動（職場などでの一時的な待機）を促すことがこの結果から示された．
以上より，距離や所要時間といった物理的制約と不安や家族との安否確認，待機場所の有無といった震災時特有の制約条件によって震災当日の帰宅意思決定行動をモデル化することができた．
これまでの結果をもとに，感度分析シミュレーションを行おう．
一つは宿泊場所の有無が災害時の帰宅行動へ与える影響の分析，もう一つは早い時間帯での家族との安否確認の有無が帰宅行動へ与える影響の分析である．
その結果を示したのが図[REF_fig:simulation_result02]である．
まず，宿泊場所の確保の影響であるが，すべての外出者に対して宿泊可能な場所が提供された場合を考える．
今回の感度分析では宿泊以外の選択者の待機場所ツイート割合が宿泊選択者の平均値と等しいとして全体のシェアを求めると，宿泊者は[MATH]倍に増加し，全体のシェアも[MATH]から[MATH]へ増加する．
一方で，徒歩，鉄道といった帰宅行動のシェアは[MATH]減少する．
[MATH]の減少は微少な影響のように一見思えるが，交通システムにおける渋滞や混雑は供給される容量の1割超えるだけで長時間の待ち行列が発生すると一般に言われている．
その点から考えると，[MATH]の減少効果は少なくないだろう．
また，総待ち時間の減少だけでなく，駅のホームといった容量制約のあるボトルネック箇所の安全性の面からも社会的便益がある．
交通混雑や震災時の混乱を避けるために，より会社等での一時待機者・宿泊者を増加させるためには待機・宿泊場所の提供のみならず，行政や会社による待機命令が必要となる．
次に，家族間での安否確認の影響を分析する．
今回，2672名のうち，353名に同居の家族（配偶者または子供）がいることが発言内容から確認されている．
この353名がすべて17時までに安否確認が行えた場合，図[REF_fig:simulation_result02]に示すように，鉄道・宿泊が[MATH]倍に増加し，徒歩帰宅者が[MATH]倍に減少する結果となる．
言うまでもなく災害時の家族間の安否確認は緊急性と重要性が高い情報であるが，この情報が入手されないことが帰宅行動という形で首都圏全体の混乱として表出し，更なる二次災害へと繋がる危険性が今回の震災から示唆された．
携帯電話や携帯メール以外の連絡手段が今回の震災では大きな貢献をしたことから，遅延が少なく需要増加に頑健な連絡手段を家族間の連絡手段に採用することで，交通ネットワークへの影響や混乱を一部防ぐことができるだろう．
本節ではツイートデータとそれに付随したジオタグデータから利用者の実行動データを作成する分析フレームワークについて述べる．
図[REF_fig:frame]に示すように，本研究の分析フレームは(1)ツイートから行動を予測するパート，(2)言語的・非言語的説明要因を生成するパート，(3)生成された説明要因から行動結果を説明するモデルを構築するパートの[MATH]つに分けることができる．
(1)ではツイートデータからはその行動結果を伝える発言のBag of Words (BoW)表現を特徴量化することで，機械学習的手法を用いてユーザー別の行動結果の推測を行う．
(2)ではラベル化された行動結果，ここではそれを意思決定における選択肢集合と呼ぶが，その選択肢集合ごとの説明要因をジオタグデータやツイートデータから作成する．
ジオタグから作成される説明要因は距離，徒歩による所要時間や鉄道による所要時間，運賃などである．
また，ツイートデータから作成される説明要因は家族に対する心配や鉄道運行再開情報，自身の不安感といった外的・内的要因である．
(3)では，これらの説明要因をもとに，各ユーザーの行動結果を説明する意思決定モデルを構築する．
ここで，(1)パートと(3)パートの違いを確認しておこう．
(1)では「歩いて帰ったので疲れた」「電車が動かないので会社に泊まることにした」といったツイートをそれぞれ「徒歩帰宅」「宿泊」とラベル化する処理であるのに対し，(3)では「徒歩帰宅」したのは「自宅と外出先の距離がそれほど遠くなかったから（距離的要因）」なのか「家族の様子が心配だったから（心理的要因）」なのかを定量的に明らかにする分析である．
そのため，(3)で構築するモデルの説明変数（特徴量）は解釈のしやすい説明変数を選択しており，またその結果として，簡易的な感度分析としてのシミュレーションを行うことが可能である．
本研究で用いるデータはTwitter Japan株式会社によって提供された東日本大震災発生時より1週間の日本語ツイートデータ（約1億8000万ツイート）である．
このうち，ユーザーによってジオタグが付与されたツイートは約28万件である．
その中で2011年3月11日14:00から2011年3月12日10:00までの日時にGPS座標が首都圏に含まれ，またbotを除くために利用者が20人以上のTwitterクライアント（Twitterに投稿するためのクライアントソフトウェア）からpostされたツイートデータを24,737件抽出した．
この24,737ツイートのユニークなユーザー数（アカウント数）は5,281人であり，そのうち上記期間中に2つ以上ジオタグが付与されたツイートを行ったユーザー数は3,307人である．
この3,307人のユーザーは震災当日から翌日にかけて首都圏における震災当日の自身の帰宅行動に関してつぶやいており，また2つ以上のジオタグによって勤務地・自宅間の近似的距離が得られる可能性が高いと考えられる．
そこで，前後の文脈も参考にするために，これらのアカウントのツイートのうち，2011年3月11日12:00から2011年3月12日12:00までの24時間のツイートを抽出した．
これらの総ツイート数は132,989ツイートであり，一人あたり40.2ツイートである．
この3,307名，132,989ツイートを本研究で取り扱うデータセットとする．
Twitterというソーシャルメディアを利用しているユーザー層と2011年3月11日に首都圏に通勤していた人々の間には当然母集団の違いがあり，またこのような方法でサンプリングが行われたデータには一定のバイアスが存在するため，別の調査データと比較することで，本研究のサンプリングデータの偏りについても考察を行う．
高々3,307名のツイートとはいえ，それらの内容を読み，人手で行動結果をラベリングすることは容易ではない．
本研究では2つ以上ジオタグが付与されたユーザーのみを対象としているが，震災当日の全ツイートを対象に，ラベリングを行うとなると非常に大きな人的資源が必要となるだろう．
そこで，本研究ではサポートベクターマシンを用いてラベリングを行い，当日の行動結果を推測することとする．
そのための教師データ作成プロセスとして，本データセットの中からランダムに抽出した300名の3月11日，3月12日のツイートを時間軸に沿って読むことで，人手で帰宅行動結果のラベリングを行う．
ラベルとしてはこの300名の結果に表れた「徒歩のみで帰宅」「鉄道を利用して帰宅」「会社等に宿泊」「その他（自動車，自転車，バイク，バス，タクシーなど）」「不明」の5種類に分類した．
今後はこれらを1)徒歩，2)鉄道，3)宿泊，4)その他，5)不明と名付ける．
それぞれの割合は徒歩が120名，鉄道が56名，宿泊が54名，その他が10名，不明が60名である．
次に，教師データ300名を含む3,307名の2011年3月11日12:00から2011年3月12日12:00までのツイートのうち，リツイート(RT)したツイートを除く全てのツイートの形態素解析を行った．
形態素解析にはMeCabを用いた．
リツイート(RT)とはTwitterにおいて自分以外の他者の発言を引用する行為であり，そのユーザー個人の行動を反映しないと考えたため，上記のような処理を行っている．
また，形態素解析された形態素のうち，ストップワードとなりうる助詞，記号，Twitterアカウント名，MeCabによって記号と認識されなかった記号（たとえば@）を除いた．
形態素解析を用いた結果，データセットから70,364のユニークな単語が得られた．
これらの形態素のうち，頻度100以上となったものは1,368，頻度50以上は2,412，頻度25以上は4,109，頻度10以上は8,244存在した．
頻度が上位100位となった形態素を一例として表[REF_tab:word_list01]に示す．
これらの形態素は東日本大震災当日，翌日の状況を表しうる形態素も含まれているが，単純に頻度の多い形態素も多く含まれている．
そこで，教師データによる分類クラスを用いて適切な素性選択を行うことを試みる．
形態素解析によって得られた単語[MATH]の出現有無の情報がクラスに関するエントロピーの減少度合いを表す指標として情報利得が存在する．
単語[MATH]に対する確率変数[MATH]を考え，対応する単語が出現した場合[MATH]，そうでない場合は[MATH]とする．
クラスを表す確率変数を[MATH]とすると，エントロピー[MATH]は
と定義される．
このとき，ある単語[MATH]が出現した場合，出現しなかった場合の条件付きエントロピーは
H(C|X_w = 1) = \sum_c P(c|X_w = 1) \log P(c|X_w = 1)
H(C|X_w = 0) = \sum_c P(c|X_w = 0) \log P(c|X_w = 0)
となる．
このとき，単語[MATH]の情報利得[MATH]はエントロピーの平均的な減少量として次のように定義される．
5つの分類クラスを用いて，頻度2以上の全て単語の情報利得をそれぞれ算出した．
情報利得上位100の単語を，各単語が出現した際の分類クラスの条件付き確率が最も高いクラスごとに整理したものが表[REF_tab:word_list]である．
まず，表[REF_tab:word_list01]と比べて当日の帰宅行動に関する単語が多く含まれていることが観測される．
例えば，表[REF_tab:word_list]の中で1)徒歩帰宅の条件付き確率が高い単語として，現在の位置を伝える「半分」「遠い」「km」「川崎」「環」「七」や徒歩帰宅時の問題を伝える「トイレ」「ヤバイ」「疲れ」などを挙げることができる．
2)鉄道帰宅に関しては「入場」のような鉄道帰宅固有の単語のみならず「なんとか」「奇跡」といった鉄道運行再開によって，帰宅できたことを示す単語が含まれる．
3)宿泊の条件付き確率が高い単語には「朝」「明け」「明るく」などの会社などで一晩を過ごしたことを伝える単語，「次第」「目処」「始発」「悩む」など帰宅タイミングを示す単語が含まれている．
また，翌日鉄道で帰宅した影響や待機・宿泊場所で様々なメディアから情報を入手したためか「ホーム」「運行」「混雑」「改札」「乗車」「駅員」などの鉄道に関連する単語が多く含まれていることも特徴である．
次に，興味深い結果として，個別の鉄道路線に関しては3月11日当日に運行が再開されなかった「JR」「総武線」「京浜東北」線は3)宿泊の選択者が相対的によく発言しており，当日運行を再開した「大江戸」線や「田園都市線」「京王」線は2)鉄道利用者が相対的に発言しやすいことが示された．
この傾向は震災時に人々は自身の帰宅鉄道ルートについて発言しやすいことを表しており，これらの単語の出現有無は当日の帰宅行動を表す重要な単語であるといえよう．
このように，情報利得の高い単語は当日の帰宅行動のラベリングに有用であると考えられるため，これらを素性として分類器を構成する．
サポートベクターマシン(SVM)の概要を示す．
素性ベクトル[MATH]の次元が[MATH]であるとすると，1つの素性ベクトルは[MATH]次元空間中の点として表すことができる．
正・負のラベル[MATH]に対して，正例と負例はすべてこの[MATH]次元空間に配置したとする．
このとき，正例と負例を分ける2クラス分類問題は正例と負例を分離する超平面[MATH], [MATH]を決める問題に帰着できる．
SVMはノイズを許容しつつ，超平面に最も近い正例と負例との間のマージンを最大化するような分離平面を求めるアルゴリズムである．
マージン最大化は式([REF_eq:svm01])を式([REF_eq:svm02])の条件で最大化する双対問題と等価であることが知られている．
\sum_{i=1}^{l} \alpha_i - \frac{1}{2} \sum_{i, j}^{l} y_i y_j \alpha_i \alpha_j K(\boldsymbol{x_i}, \boldsymbol{x_j})
\text{subject to} \nonumber
\sum_{i=1}^{l} y_i \alpha_i = 0          0 \leq\alpha_i
また，カーネル関数[MATH]により，入力されたデータを高次元の素性空間(feature space)に写像し，素性空間において超平面を求めることにより，入力空間においては非線形となる分離も可能である．
本論文では線形カーネルを用いた．
以上のようにして得られた超平面を用いて，分類器が構成される．
新たに与えられた素性ベクトルに対して，超平面の正例側をプラス，負例側をマイナスとし，超平面からの距離を正規化した値を計算することにより，分類器は与えられたデータが正，負の2クラスのどちら側に属するかを判定する．
SVMは正例・負例を分類する二値分類器であるが，本研究のように3つ以上のクラスに分類する多値分類が必要な場合が存在する．
その場合は多値分類に拡張するための代表的手法として，one class vs all other法やpairwise法がある．
本論文ではpairwise法を用いた．
前述の人手でラベリングされた[MATH]件のデータを教師データとして学習する．
表[REF_tab:word_list]に一部示した頻度2以上の情報利得の上位500の単語を用いて，各ユーザーのツイート内のこれらの単語の出現有無をベクトル表現（BoW表現）し，それらをSVMの素性に用いている．
学習ではデータを9分割交差検定(9-fold cross validation)とパラメータチューニングを行った．
得られたモデルの全教師データに対する正解率は[MATH]，交差検定で得られた平均正解率は[MATH]であった．
SVMにて帰宅行動結果をラベリングされた結果を以下に示す．
[MATH]名のうち，1)徒歩での帰宅者は[MATH]名，2)鉄道での帰宅者は[MATH]名，3)宿泊した人は[MATH]名，4)その他の交通手段での帰宅者が[MATH]名，5)不明が[MATH]名と予測された．
この結果は不明を除く全体の[MATH]（徒歩[MATH]，鉄道[MATH]，その他[MATH]）が帰宅行動を行ったことを示している．
本研究の推測結果を考察するために，図[REF_fig:svm_result]にて別主体による震災当日の帰宅行動調査結果との比較を行う．
サーベイリサーチセンター(SRC)によって行われた調査(SRC 2011)は2011年4月に実施された調査，遊橋による調査「東日本大震災における通信メディアと情報行動に関する定量調査」やその報告(遊橋2012)は2011年11月に実施された調査である．
(SRC 2011)では[MATH]名へのアンケートから，全体の[MATH]が当日自宅に帰ることができたという結果を得ており，(遊橋2012)も[MATH]が帰宅成功しているという同様の結果を得ている．
それに対し，本研究での推測では[MATH]と5, 6%高い帰宅成功率という結果となった．
これらの調査では帰宅時の交通手段について尋ねていない点とTwitterでは各ユーザーの個人属性が明らかではない点から，帰宅者の割合が多いデータの偏り要因をはっきりと明らかにすることはできない．
しかし，SRCの調査では都県[MATH]性年代の均等割付を行い調査を行っている点，遊橋の調査では2005年時の国勢調査に基づき人口割合を鑑みてサンプリングを行っている点を考えると，本研究で利用したTwitterデータではユーザー層が比較的若年層に偏り，また都市部での利用割合が相対的に高いと考えられるため，Twitterユーザー層特有のサンプリングバイアスであると考えられる．
2節で得られたユーザー別帰宅意思決定の予測をもとに，非言語的・言語的説明要因をツイートデータやジオタグデータから作成し，各個人の帰宅意思決定の要因を分析する．
まず，ユーザー別ジオタグデータを用いて，交通行動に関する説明要因を作成する．
本研究では簡単のために発災時以降の時刻が最も早い位置座標を勤務地（出発地）位置座標，2011年3月12日12:00以前の時刻が最も遅い位置座標を自宅（到着地）位置座標と設定した．
次にこれらの位置座標を用いて，道路ネットワーク距離，徒歩所要時間，勤務地最近隣駅，自宅最近隣駅，鉄道所要時間，鉄道費用，鉄道乗り換え回数を作成する．
これらはすべて平常時のネットワークを用いて作成したデータである．
人々の帰宅行動の空間的広がりを表現するために，図[REF_fig:locationmap]によって勤務地最近隣駅，自宅最近隣駅のそれぞれ上位30ヶ所を図示する．
勤務地最近隣駅の空間的分布を見る限り，首都圏におけるオフィスが集中したエリアであることがわかるが，自宅最近隣駅の空間分布が必ずしも住宅地になっておらず，ターミナル駅が多く含まれている．
ジオタグ付きツイートの傾向として，Twitterユーザーはプライバシーの問題から自宅位置のジオタグを付与することはあまり見られず，「最寄り駅に着いた」「川崎までやってきた」「ここでやっと半分」のように自分の移動軌跡の目印となる点でつぶやくことが多い．
そのため，この結果はこれらはジオタグ付きツイートが自宅付近でされたのではなく，ターミナル駅や乗換で行われたことを示唆しているといえよう．
しかし，全体的な傾向として，勤務地分布と自宅分布は空間的に異なる分布をしており，帰宅方向（郊外方向）へ分散していることが示された．
次に，作成した勤務地・自宅間の道路ネットワーク距離による帰宅意思決定のクロス集計結果を図[REF_fig:distance_cross]に示す．
この結果は自宅との距離が長くなるにつれて相対的に徒歩の割合が減少するが，[MATH]km以上離れていても[MATH]以上の人々が徒歩を選択したことを示している．
また，鉄道の割合は10〜20 kmの人々が最も高く，それ以上の距離になると，鉄道運行停止の影響を受け，宿泊を選択する割合が高くなっていることが示された．
先ほどと同様，上記の距離は必ずしも勤務地・自宅間の距離を示す値ではないが，自宅までの経路の移動途中結果を示す近似的距離であり，このネットワーク距離は帰宅意思決定行動の重要な要因である．
最後に，言語的説明要因の生成を行う．
前節では職場と自宅間の物理的距離が帰宅意思決定の要因であることを示したが，その他にも家族の存在や情報の有無が帰宅意思決定に影響を与えていると推測される．
そこで，各ユーザーの発言から帰宅意思決定行動に影響を与える要因を抽出する．
しかし，意思決定結果によって発言内容にはセルフセレクション・バイアスが生じる可能性があるため，各意思決定結果ごとの傾向をまず示す．
帰宅意思決定ごとのRTを除く平均ツイート数は1)徒歩が22.6件，2)鉄道が51.8件，3)その他が80.2件，4)宿泊が61.4件，5)不明が24.1件である．
サンプル数の少ないその他や不明を除くと，宿泊・鉄道選択者は徒歩選択者に比べて2.3倍から2.7倍のツイート数がある．
これは職場や駅等での待機中にTwitterで発言していたためと考えられ，直感に合う結果である．
しかし，発言数が多いことによって相対的に影響要因と考えられる話題のツイートも増加するため，ある話題に対する発言頻度が他の意思決定に比べて多いからといって意思決定要因であると単純に考えることはできない．
そこで，全ツイート内での各話題の発言割合を用いて基準化を行い，以降の分析を行う．
まず，家族との安否確認が帰宅意思決定に与えた影響について分析を行う．
本研究では家族を同居の配偶者および子供と定義した．
表[REF_tab:element_list]の単語による抽出を行った上で人手でアノテーションを行った結果，3,307名のうち353名が同居の家族の存在を発言していた．
これらの人々の発言の中から「嫁からメール来た。
ちょっと安心。
」「妻と娘にやっと電話が繋がった。
」や「嫁にメールが届かない」「息子の保育園と電話が通じない」といった安否確認，安否未確認のツイートを人手で抽出した．
3月12日12時までのツイート内で，安否確認ツイートと安否未確認ツイートの比率は徒歩帰宅者が[MATH]と帰宅行動間でほぼ差がない結果となった．
そこで，安否確認・安否未確認ツイートの時間帯の分析を行う．
図[REF_fig:FamilyTIme]は徒歩，鉄道，宿泊の意思決定者別の安否確認・安否未確認ツイートの時間帯割合を示している．
安否確認ツイートに関しては18時台までに徒歩は[MATH]，鉄道は[MATH]，宿泊は[MATH]が集中している．
宿泊者の安否確認の割合が相対的に高いが，徒歩と鉄道では同程度の割合である．
一方で，安否未確認ツイートは18時台までに徒歩は[MATH]，鉄道は[MATH]，宿泊は[MATH]であり，安否確認と同様の傾向のように思えるが，「家族と連絡が取れた」という安否確認ツイートと異なり，安否未確認ツイートは安否確認が取れるまでのどの時間帯でも行うことが可能であるため，より各個人の心理的要因が強く反映していると考えることができる．
より早い時間帯に発言することがその個人にとってより重要であるという仮定に立つならば，徒歩帰宅者は鉄道帰宅者よりも家族の安否が未確認であることを問題視し，より早い時間帯での帰宅意思決定を行ったと考察される．
一方で，最も早く安否未確認ツイートを行っている宿泊選択者は距離や鉄道網が動いていないことによる物理的制約の方がより大きかったと考察される．
次に，運行再開情報と帰宅意思決定の関係性を分析する．
冒頭にも述べたように，当日の鉄道路線は20時40分以降，五月雨式に再開された．
職場で待機・宿泊するか，それとも再開した鉄道を利用して帰宅するかは鉄道再開情報の入手有無に依存する．
そこで，表[REF_tab:element_list]の単語を用いて人手でアノテーションを行った鉄道再開関連ツイートの各個人の発言内での割合と帰宅意思決定結果の関係を示したのが図[REF_fig:trainInformation]である．
この図は鉄道選択者が鉄道再開情報を発言しやすいことを示している．
これは必ずしも鉄道再開情報を入手した人が鉄道を利用したという因果関係があることを示すわけではないが，鉄道選択者が鉄道再開情報をツイートすることでフォロワー達に鉄道再開情報を拡散したことは間違いないだろう．
最後に個人の心理的要因と帰宅意思決定の関係性を分析する．
震災当日は「地震怖い」「不安だ」などの自分の心理状況に関する発言が多く見られた．
この心理状況は他者（主に家族）に対する心配要因とは異なるため，これを自分不安と定義する．
自分不安発言は表[REF_tab:element_list]の単語が含まれている発言として定義した．
深夜は余震発生などによる別要因による不安要素が多く含まれるため，地震発生後から3月11日20時までの自分不安発言の発言割合と帰宅意思決定結果の関係性を図[REF_fig:anxiety]に示す．
興味深いのは自分不安発言が[MATH]未満の個人は宿泊が多いのに対し，5%以上の発言割合になると徒歩帰宅が増加している点である．
発言頻度が多ければ多いほど，各個人は強くその意識をもっていると仮定するならば，少し不安感を感じた人々は会社等に宿泊して他者と一緒に過ごすのに対し，大きな不安感を感じた人は徒歩によって帰宅しやすいと考察することができる．
これまでの結果をまとめる．
まず，職場・自宅間のネットワーク距離が帰宅意思決定の大きな影響要因であることを示した．
次に，家族の安否確認・未確認発言ではその発言時間帯が帰宅意思決定に影響を与えた可能性を示唆している．
運行再開情報の発言や自分不安発言も，それぞれの帰宅意思決定と関連があり，特にその発言の頻度割合が帰宅行動と強く相関していることが示された．
3までに作成されたデータをもとに，意思決定モデルの構築を行う．
離散選択モデルの概要を示す．
離散選択モデル(Discrete Choice Model)は計量経済学，交通行動分析，マーケティングなどの分野で用いられる計量モデルであり，ランダム効用モデル(Random Utility Model)とも呼ばれる(Ben-Akiva and Lerman 1985; Train 2003)．
本研究で用いる多項ロジットモデル(Multinomial Logit Model; MNL)は離散選択モデルの中で最も基本的なモデルである．
このモデルは数学的には多クラスロジスティック回帰モデルや対数線形モデル，最大エントロピーモデルと等価であるが，その経済学的な解釈と導出過程が異なる意思決定モデルである．
また，機械学習における分類問題とは異なり，その予測精度のみを評価するのではなく，各変数（機械学習における特徴量）の係数パラメータの吟味を行い，その大小関係や正負の検討，経済学的な解釈を行う点がモデルの利用時に異なる点である．
意思決定者[MATH]が選択肢集合[MATH]に直面しているとする．
意思決定者は各選択肢を選択することから効用を得ることができるとし，個人[MATH]が選択肢[MATH]から得られる効用を[MATH]と定義する．
この効用は意思決定者には観測可能であるが，分析者には観測不可能であるとする．
意思決定者は効用最大化に基づき意思決定を行うので，その行動モデルは次の条件[MATH]が成り立つ場合に限って，選択肢[MATH]を選択する．
各利用者の効用は観測不可能であるが，分析者にはその一部である効用の確定効用項[MATH]は観測可能であるとする．
ここで，[MATH]は個人[MATH]と選択肢[MATH]に関連する説明変数，[MATH]は個人[MATH]特有の説明変数である．
分析者にとって観測不可能な要素を誤差項[MATH]とし，効用は[MATH]と分解可能であるとしよう．
また，[MATH]とする．
分析者は[MATH]がわからないため，確率変数として取り扱う．
そのため，[MATH]が従う確率密度関数を[MATH]とすると，意思決定者[MATH]が選択肢[MATH]を選択する確率は
である．
ここで，[MATH]は括弧内が成り立っていれば[MATH]，そうでなければ[MATH]となるindicator functionである．
誤差項が次の式で表されるi.i.d.なガンベル(Gumbel)分布（type I extreme value分布とも）に従うと仮定する．
f(\varepsilon_{nj}) & = e^{-\varepsilon_{nj}} e^{-e^{-\varepsilon_{nj}}}
F(\varepsilon_{nj}) & = e^{-e^{- \varepsilon_{nj}}}
このとき，意思決定者[MATH]が選択肢[MATH]を選択する確率は
として導かれる．
このようにして導かれる選択確率をもつモデルが最も基本的な離散選択モデルである多項ロジットモデルである．
MNL提案後，選択肢間の誤差項間の相関を考慮したNested Logitモデルや更に緩和を加えたGeneralized Nested Logit Model (Wen and Koppelman 2001)やnetwork GEV Model (Daly and Bierlaire 2006)，また誤差項に正規分布を仮定したProbitモデルやProbit ModelとLogit Modelの良い面を合わせたMixed Logit Model (McFadden and Train 2000)等が提案されている．
本研究では分析の見通しを良くするために，基本的なモデルであるMNLを用いる．
離散選択モデルでは観測可能な確定効用項[MATH]を一般的に[MATH]と定義する．
[MATH]は係数ベクトル，[MATH]は個人[MATH]の選択肢[MATH]に関する説明変数ベクトルである．
これより，線形効用関数として定義したMNLが数学的に対数線形モデルと等価となることが理解される．
本研究ではデータセットとして，SVMによって識別された3307名のデータのうち，不明を除く2672名，選択肢集合は徒歩，鉄道，その他，宿泊の4選択肢を用いる．
1)徒歩の説明変数には徒歩所要時間，自分不安ツイート割合，徒歩選択肢固有定数を採用，2)鉄道の説明変数には鉄道所要時間，職場・自宅間の距離の対数，運行再開情報ツイート割合，17時までに家族の安否確認が行えた場合1となるダミー変数，鉄道選択肢固有定数を採用，4)宿泊の説明変数には自分不安ツイート割合，待機場所ツイート割合，17時までに家族の安否確認ダミー変数，宿泊選択肢固有定数を採用した．
待機場所ツイート割合は各個人のツイートのうち「会社」「職場」「学校」を含むツイートの割合である．
3)その他の効用項は0に基準化している．
個人[MATH]における各選択肢[MATH]の確定効用関数は上記の説明変数の線形和[MATH]として表現される．
このような効用関数を定義することで，式([REF_eq:DCM])における各選択肢の選択確率[MATH]が定式化される．
次に，得られたデータから効用関数の係数パラメータの推定方法について概説する．
MNLモデルはclosed formで定式化されるため，伝統的な最尤推定法が適用可能であり，また大域的に凸であるため(McFadden 1974)，推定パラメータは一意に決定できる．
MNLの対数尤度関数は次のように書くことができる．
ここで，[MATH]は個人[MATH]が選択肢[MATH]を選択したならば[MATH]，そうでなければ[MATH]となるクロネッカーの[MATH]である．
離散選択モデルにおいては，モデルの当てはまりの良さを示すのに尤度比指標（McFaddenの決定係数とも呼ばれる）を一般的に用いる．
この尤度比指標は次のように定義される．
ここで，[MATH]は対数尤度関数に推定パラメータを代入した値，[MATH]は対数尤度関数に[MATH]を代入した値であり，[MATH]が成り立つ．
これは0に近づけば当てはまりが悪く，[MATH]に近づけば当てはまりが良いと解釈できる．
上記の設定の下で，パラメータを推定した結果を表[REF_tab:transition_probability]に示す．
まず，修正済み尤度比指標は[MATH]であり，モデル全体の当てはまりは十分に良い．
また，所要時間の係数パラメータは負である点，職場・自宅間の距離が増加するにつれて鉄道の選択確率が増加する点などこれまでの基礎分析や直感に合う結果となっている．
また，自分不安ツイート割合は徒歩と宿泊で異なるパラメータとして推定を行っているが，自分不安ツイート割合が徒歩選択に対してより大きな影響を与えていることがわかる．
自分不安ツイートと所要時間のパラメータの比より，例えば自分不安ツイートが[MATH]増加することは[MATH]分の所要時間が増加しても宿泊より徒歩を選択することを示している．
待機場所ツイート割合は宿泊選択を促していることから，待機場所の有無が宿泊の重要な要因であることも示された．
加えて，基礎集計からも明らかになったように，運行再開ツイート割合は鉄道選択を促すことを説明している．
家族との関係性については，17時まで（地震発生から2時間14分以内）に家族との安否確認が行えたことの影響は鉄道・宿泊を大幅に選択しやすくなることから，安否確認が冷静な行動（職場などでの一時的な待機）を促すことがこの結果から示された．
以上より，距離や所要時間といった物理的制約と不安や家族との安否確認，待機場所の有無といった震災時特有の制約条件によって震災当日の帰宅意思決定行動をモデル化することができた．
これまでの結果をもとに，感度分析シミュレーションを行おう．
一つは宿泊場所の有無が災害時の帰宅行動へ与える影響の分析，もう一つは早い時間帯での家族との安否確認の有無が帰宅行動へ与える影響の分析である．
その結果を示したのが図[REF_fig:simulation_result02]である．
まず，宿泊場所の確保の影響であるが，すべての外出者に対して宿泊可能な場所が提供された場合を考える．
今回の感度分析では宿泊以外の選択者の待機場所ツイート割合が宿泊選択者の平均値と等しいとして全体のシェアを求めると，宿泊者は[MATH]倍に増加し，全体のシェアも[MATH]から[MATH]へ増加する．
一方で，徒歩，鉄道といった帰宅行動のシェアは[MATH]減少する．
[MATH]の減少は微少な影響のように一見思えるが，交通システムにおける渋滞や混雑は供給される容量の1割超えるだけで長時間の待ち行列が発生すると一般に言われている．
その点から考えると，[MATH]の減少効果は少なくないだろう．
また，総待ち時間の減少だけでなく，駅のホームといった容量制約のあるボトルネック箇所の安全性の面からも社会的便益がある．
交通混雑や震災時の混乱を避けるために，より会社等での一時待機者・宿泊者を増加させるためには待機・宿泊場所の提供のみならず，行政や会社による待機命令が必要となる．
次に，家族間での安否確認の影響を分析する．
今回，2672名のうち，353名に同居の家族（配偶者または子供）がいることが発言内容から確認されている．
この353名がすべて17時までに安否確認が行えた場合，図[REF_fig:simulation_result02]に示すように，鉄道・宿泊が[MATH]倍に増加し，徒歩帰宅者が[MATH]倍に減少する結果となる．
言うまでもなく災害時の家族間の安否確認は緊急性と重要性が高い情報であるが，この情報が入手されないことが帰宅行動という形で首都圏全体の混乱として表出し，更なる二次災害へと繋がる危険性が今回の震災から示唆された．
携帯電話や携帯メール以外の連絡手段が今回の震災では大きな貢献をしたことから，遅延が少なく需要増加に頑健な連絡手段を家族間の連絡手段に採用することで，交通ネットワークへの影響や混乱を一部防ぐことができるだろう．
