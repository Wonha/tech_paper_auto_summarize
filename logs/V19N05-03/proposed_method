本研究で提案する顔文字推薦システムは，大きく分けてカテゴリ推定と顔文字推薦の2種類の処理から構成される．
本節では，それぞれの処理を行う際に必要となる情報が何かを分析し，その結果，必要となる基本情報を定義する．
顔文字推薦のためのカテゴリ推定を行うにあたって，必要な感情カテゴリ，また，コミュニケーションや動作を反映したカテゴリを明らかにするため，調査を行った．
調査データには，きざしラボ[CITE]が提供する顔文字92個を含むTwitterのつぶやき1,722件を収集し使用した．
これらのデータに，極性（ポジティブ，ネガティブ，なしの3種類）と感情カテゴリ（[CITE]，「喜」「怒」「哀」「恥」「怖」「好」「厭」「昂」「安」「驚」の10種類）をそれぞれ分類して付与した．
また，10種類のカテゴリに分類することができず，よく現れるような表現の場合は，新たにカテゴリを定義した．
調査の結果，顔文字推薦に必要な情報として，定義した情報の例を以下に示す．
感情の種類について
「不快」「不安」など，頻出する項目を中心に，感情カテゴリを定義した．
また，Twitterのつぶやきには，期待を表す表現や，疲れを表す表現などを含む文章が多く見られた．
しかし，[CITE]の感情分類にはそれらを表す感情カテゴリはないため，新たに「期待」，「疲れ」という感情カテゴリを定義した．
感情以外の特徴について
``m(__)m ''は，「ごめんなさい」や「申し訳ない」などの謝罪表現を含む文に付与されることが多かった．
しかし，謝罪を表すような感情カテゴリは[CITE]の分類には含まれておらず，また，謝罪は感情とは言い難い側面を持つ．
そこで，感情分類とは別のカテゴリとして，新たに「謝罪」カテゴリを定義した．
このような，誰かとのやり取りや，人に伝えることを前提としたカテゴリが多く存在したため，コミュニケーションタイプとして，新たに定義した．
``(-_-)''や``(*_*)''は，睡眠を表す文章で使用されていた．
睡眠は動作であり，感情ではない．
感情カテゴリに当てはめることはできないので，これも新たに「睡眠」カテゴリを定義した．
この動作を表すカテゴリを，動作タイプとして新たに定義した．
前節の結果に基づき，顔文字推薦に必要な感情，感情以外のカテゴリを決定した．
感情カテゴリの定義を表[REF_table:em]に，感情以外の特徴を，コミュニケーションタイプ，動作タイプとして定義した結果を表[REF_table:com]に示す．
感情カテゴリは全部で27種類ある．
中村の感情分類を基礎カテゴリとして用いて，それら27種類の感情を詳細カテゴリとして10種類の基礎カテゴリに分類した．
また，各詳細カテゴリごとに，極性（ポジティブ／ネガティブ／なし）の設定を行った．
コミュニケーション・動作タイプは全部で10種類ある．
感情には分類できないが，表現としてよく現れるものを分類した．
コミュニケーションタイプは，人とのやり取りや他者に物事を伝えることを中心とした表現のタイプであり，人にどのように伝えるかによって「やりとり型（他者との会話に含まれる表現）」「つぶやき型（他者に見られることを前提としているが，会話にはなっていない文章に含まれる表現）」「不特定多数型（やりとり，つぶやきのどちらにも使われる表現）」の3つに分類しており，それらの分類の下に詳細カテゴリを設定した．
また，感情カテゴリ，コミュニケーションタイプに分類できず，文章の中心が動作表現となるものを動作タイプとして定義した．
現在，動作タイプとして定義できる程度に頻出した動作表現は「睡眠」だけであるため，動作タイプは1種類のみである．
作成したコーパスの文章に付与したカテゴリがどの程度安定しているかを調べるため，第1著者と協力者1名（ともに大学生，女性と男性）が，コーパス中からランダムに選んだ190件について，(1)極性と(2)感情カテゴリ，コミュニケーションタイプ，動作タイプのいずれかを付与した場合の一致度（[MATH]係数）を調べた．
その結果，極性の一致については，[MATH]値が，0.850（almost perfect/ほとんど一致[CITE]），感情カテゴリ，コミュニケーションタイプまたは動作タイプの一致については，[MATH]値が，0.747（substantial/かなり一致[CITE]）となり，付与方針が安定していることを示すことができた．
本カテゴリのような分類体系の関連研究としては，[CITE]の提案がある．
基本的な考え方は，両方の体系で共通しており，菊井の陳述型は，ひとりごと型に対応し，発話行為タイプは，やりとり型に対応すると考えられる．
ただし，その下位のカテゴリの分け方に関しては，本研究では，顔文字を推薦する，という前提のもとに，顔文字のつけやすいカテゴリ体系になっている．
[REF_sec:category]節で定義したカテゴリ体系に基づき，顔文字推薦システムを実現した．
構築した顔文字推薦システムは，カテゴリ推定処理と顔文字推薦処理の2つから成り立っている．
以下に，顔文字推薦システム全体の流れを示す．
ユーザが文章を入力する．
入力文章を用いて，カテゴリ推定を行う（カテゴリ推定処理）．
カテゴリ推定の結果を用いて，顔文字データベースから適切な顔文字を取り出す（顔文字推薦処理）．
取り出した5件の顔文字を推薦候補として，画面に表示する．
本節では，上記の処理に必要なデータの作成について，[REF_subsec:data]節で具体的な内容を紹介する．
(2)(3)の2つの処理については，[REF_subsec:estimate]節，[REF_subsec:recommend]節で説明する．
本研究では，カテゴリ推定処理と顔文字推薦処理に必要なデータとして，顔文字辞書，タグ付きコーパス，手がかり語辞書，顔文字データベースを作成した．
以下，詳細を説明する．
顔文字推薦に使用する顔文字は，予備実験で用いた92個では各感情を表す顔文字を推薦するのに十分な数ではなかったため，アンケートを実施し追加を行い，163種類とした．
[REF_sec:category]節で定義したカテゴリ体系を用いて，感情，コミュニケーションタイプ，動作タイプのタグ付きコーパス（以下，タグ付きコーパス）を作成した．
コーパスの文章は，Twitterの2011年5月1日〜31日，7月1日〜16日のパブリックタイムライン上のツイートから，前述の顔文字163個を含む1,369件（ツイート数）を収集し，それらの文章に，それぞれ(1)極性，(2)感情カテゴリ，コミュニケーションタイプ，動作タイプのいずれかを，[REF_subsec:kappa]節の判定者2名で協議して付与した．
さらに，日常的に顔文字を使用する別の20代の協力者2名と協議しつつ，コーパスの修正と拡張を行い，最終的に，3,975件（各詳細カテゴリごと100件強）とした．
[REF_sec:category]節のカテゴリ体系を用いて，手がかり語辞書を作成した．
手がかり語辞書は感情表現辞典[CITE]，単語感情極性対応表[CITE]を参考にし，全1,440語の項目を設定した．
それぞれの語には，極性（ポジティブ，ネガティブ，なしのいずれか）と感情カテゴリ，コミュニケーションタイプまたは動作タイプのいずれかを付与した．
なお，手がかり語は，おはよう（おはよ，おはよー，おはよ〜，おはしゃす），さようなら（さよーなら，グッバイ，さらば）のような，オンライン上の挨拶表現の変形も含む．
顔文字推薦処理を実装するために，収集した文章に含まれる顔文字の使われ方を分析し，顔文字データベースの作成を行った．
作成したタグ付きコーパスには顔文字が含まれているため，それを分析することで各顔文字の感情ごとの出現頻度を調べた．
なお，単純なコーパス中での出現頻度以外に，同じカテゴリに分類される顔文字でも，文章中の表現の違いで使用のされ方が違う場合には，補足ルールを作成し，補足ルールにおいて設定した下位カテゴリ別の出現頻度も調べた．
補足ルールは2つあり，以下のとおりである．
「あいさつ」カテゴリ「あいさつ」カテゴリでは，どの時間帯のあいさつか（例：おはよう→``(⌒▽⌒)''，おやすみ→``(( __)).
.zzzZZ''），あるいは時間帯に無関係なあいさつ（例：よろしく→
``(‾^‾)ゞ''，さようなら→``(´_ゝ｀)''）かによって，使用頻度の高い顔文字が変わってくる．
そこで，「あいさつ」カテゴリでは，あいさつ表現別に9つの下位カテゴリを作成した．
また，オンライン上の挨拶表現の変形についても，考慮した上で，各顔文字がどの分類に当てはまるのかを分析し，それぞれの分類ごとに出現頻度を計算した．
「感謝」カテゴリ「感謝」カテゴリでは，丁寧な口調の表現を含む場合，泣き顔や申し訳なさを表す顔文字（例：``ヽ(；▽；)ノ''）がより使用されていた．
そこで，「ございます」「ありがたいです」などの言葉を含む文章について，顔文字ごとの頻度を計算した．
また，入力文章がこれらの補足ルールに一致する語を含んでいるかを判断する必要があるため，補足ルールの下位カテゴリごとに，それらを表す表現を集め，補足ルール辞書を作成した．
顔文字データベースは，顔文字とカテゴリを組み合わせて主キーとし，コーパス中でのカテゴリ別の顔文字の出現頻度，補足ルールで指定した下位カテゴリ別の出現頻度を加えて，1レコードとして格納した．
データベースの例を，表[REF_table:database]に示す．
顔文字データベースの傾向を確認するため，CAOシステム[CITE]との比較を行った．
このシステムでは，分類体系は，[CITE]の感情10種類に基づいており，本研究で定義したカテゴリを，表[REF_table:em]の体系に基づき感情10種類により対応付けることで，顔文字に対する感情カテゴリの傾向を比較した．
具体的には，[CITE]の論文で有効と判定されているUnique Frequencyと，本データベースの相対出現頻度との相関係数を調査した．
なお，顔文字は双方で分析可能なもの，かつある程度の出現回数がみられる43個を対象として分析を行った．
その結果，相関係数が0.4以上のものが，53.5%，正の相関を持つものが72.1%となり，ある程度の相関がみられた．
相関係数の低い顔文字は，泣き笑いや，汗付きの笑いを表す顔文字などが含まれており，本研究のデータベースでは，``厭''，``哀''などの感情を表す傾向があるのに対して，CAOシステムでは，他の感情の値の方が大きい傾向がみられる．
これは，CAOシステムではWeb全般やブログを対象としているのに対して，本研究ではマイクロブログを対象としていることから，使用傾向の違いが現れていると考えている．
なお，表[REF_table:com]のコミュニケーション・動作タイプについては，上記のシステムとの比較が行えないことから，この比較には用いていない．
カテゴリ推定を行うために，分類器を構築した．
分類器には[MATH]-NNを用い，文章を入力すると，各学習データとの類似度を計算し，類似している上位[MATH]件の中で最も多い感情を推定結果として返す．
学習データには，[REF_subsec:data]節で説明した，タグ付きコーパスを用いた．
分類器によるカテゴリ推定の手順を以下に示す．
極性（``A.ポジティブ''，``B.ネガティブ''，``C.なし''のいずれか）を推定する．
まず，手がかり語辞書に含まれる語の，入力文における出現頻度を計算する．
(a)の結果から得られた各手がかり語の頻度を用いて，極性ごとに素性ベクトルを構築する．
学習データ中の各文との平方距離を計算する．
平方距離の近い上位[MATH]件のうち，学習データにおいて最も多く付与されている極性を推定結果とする．
推定した極性に対応するカテゴリとして，A.感情（ポジティブ）：嬉しい，めでたい等；B.感情（ネガティブ）：怒り，悲しい等；C.感情（なし）：興奮，安らぎ等か，コミュニケーション・動作タイプ：感謝，謝罪等のいずれかを推定する．
素性ベクトルの構築や各学習データとの距離の計算は，1の(a)--(c)と同様に推定する．
平方距離の近い上位[MATH]件のうち，学習データにおいて最も多く付与されている感情カテゴリ，コミュニケーションタイプ，動作タイプのいずれかを推定結果とする．
また，入力文に複数の手がかり語が含まれる場合，その位置関係によって推定を誤る可能性がある．
たとえば，「おかえり〜今日はありがとね」という文には，「おかえり」と「ありがとう」という2つのコミュニケーションタイプの手がかり語が含まれている．
この文の場合では，文全体のコミュニケーションタイプは，「感謝」になるのだが，「あいさつ」が推定結果として出力されてしまう可能性がある．
各カテゴリの出現頻度を計算して推定すると，どちらも同じ頻度なため，どちらが推定されてもおかしくない．
これは，文章内に現れる手がかり語の位置関係を考慮していないことによる．
この対策として，入力文内に現れる順序によって，手がかり語に重みを付与する，といった処理を追加した．
具体的には，以下のような計算を行う．
なお，[MATH]は入力文内に[MATH]番目に現れる手がかり語，[MATH]は入力文内に現れる手がかり語の総数である．
次に，構築した分類器の推定精度ならびに，重み付け処理による推定精度の向上を評価するため，10分割交差検定により実験を行った．
具体的には，作成したタグ付きコーパス3,975件を，398件を5個，397件を5個の，10個に分割し，10分割の交差検定を行い，推定した極性，カテゴリと，人手でつけた極性，カテゴリがどの程度一致しているかを計算した．
推定精度の評価尺度としては，正確さ(accuracy)を採用した．
実験の結果，重み付け処理を行っていない場合では，極性の推定精度が69.7%，極性とカテゴリの双方が正解していたものが43.0%であったのに対して，重みづけ処理を行った場合では，極性の推定精度が70.2%，極性とカテゴリの双方が正解していたものが43.5%であり，統計的有意差はないが，わずかに精度が向上した．
重みづけ処理の失敗分析を30件を対象に行ったところ，手がかり語を手動で付与した場合には，28件について，最後の手がかり語のカテゴリが文章のカテゴリと一致することがわかり，手がかり語辞書との照合の精度を向上する必要性が明らかになった．
カテゴリの推定精度が十分でない別の理由としては，``報告''カテゴリの分類が難しいことがあげられる．
このカテゴリは，Twitter特有のひとりごとである``〜なう''のような，個別の行動の報告が含まれており，機械学習に適した共通の手がかりが得られにくい．
この辺りのカテゴリの推定精度の向上には，ユーザの履歴，文脈といった情報が必要になると考える．
なお，``報告''カテゴリを含まずに推定した場合には，推定精度は1.1%向上した．
次に，顔文字推薦処理の実装を行った．
顔文字推薦処理では，カテゴリ推定の結果に適合した顔文字を，[REF_subsec:data]節で説明した顔文字データベースを用いて判定し，出現頻度の多い順に，最大5件を推薦する．
また，もしカテゴリ推定の結果が，[REF_subsec:data]節で説明した補足ルールにマッチする場合には，補足ルール用辞書を用いてさらに細かい分類を行い，適合した顔文字を推薦する．
補足ルールに当てはまらないカテゴリであれば，カテゴリ推定の結果だけを用いて，顔文字データベースから顔文字を取り出す．
