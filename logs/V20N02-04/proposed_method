Negation Naive Bayesの導出 \label{Sec:Negation Naive Bayesの導出}

NNBはCNBと同様に補集合を利用して文書分類を行うが，CNBと異なってNBと同じ事後確率最大化の式から導出が可能である．
その結果，事前確率を数学的に正しく考慮することで，クラスごとの文書数が異なっているときにもより正確な文書分類を行えるようにした．
本節ではNBの導出と，CNBの概念について触れた後，提案手法であるNNBの導出について述べる．


\subsection{Naive Bayes分類器}\label{Sec:Naive Bayes分類器}

一般に確率モデルによる文書分類では，分類対象となる文書を$d$，ある一つのクラスを$c$としたとき，
事後確率$P(c|d)$を最大化するクラス$\hat{c}$を求める\cite{Zhang}．
NB分類器を用いた文書分類では，事後確率にBayesの定理を適用する．
文書の取り出される確率$P(d)$はすべてのクラスについて一定であることを考慮すると，
事後確率が最大のクラスを推定することは，クラスの出現確率$P(c)$と各クラスでの文書の出現確率$P(d|c)$の積を最大化するクラスを推定することと等しくなる．
\begin{equation}
\begin{aligned}[b]
\hat{c} & = \argmax_{c} P(c|d)  \\
 & = \argmax_{c} \frac{P(c)P(d|c)}{P(d)}  \\
 & = \argmax_{c} P(c) P(d|c) 
\end{aligned}
\label{eq:bayes}
\end{equation}

式(\ref{eq:bayes})において，$P(c)$は全文書中でクラス$c$に属する文書の割合を用いて容易に推定ができるが，$P(d|c)$を直接推定するのは難しい．
そこで，まず文書$d$を単語列$w_1, w_2, \ldots , w_n$で近似する．
\begin{equation}
P(d|c) \approx P(w_1,w_2,\ldots,w_n|c) \label{eq:bayes2}
\end{equation}

次に，各クラスで単語が独立に生起すると仮定すると，式(\ref{eq:bayes2})は
\begin{equation}
P(w_1,w_2,\ldots,w_n|c)\approx\prod_{i=1}^{n} P(w_i|c) \label{eq:bayes3}
\end{equation}
と近似される．

したがって，$d$の属するクラス$\hat{c}$は最終的に以下の式で求められる．
\begin{equation}
\hat{c}=\argmax_{c} P(c) \prod_{i=1}^{n} P(w_i|c) \label{eq:rnb}
\end{equation}


\subsection{Complement Naive Bayes分類器}
\label{Sec:Complement Naive Bayes分類器}

多項モデルを用いたNB分類器では，クラス間の文書数に大きなばらつきがある場合に，
文書数の小さいクラスで$P(w_i|c)$が大きくなる傾向がある．
$P(w_i|c)$は「そのクラス中に出てきたそのトー
クン$w_i$の数／そのクラス中に出てきたそのトークンの総数」であるため，訓練事例の単語トー
クン数に大きな差ができた結果，大きいクラスの$P(w_i|c)$は比較的小さく，小さいクラスの
$P(w_i|c)$はかなり大きくなることが予想できる．その結果，小さいクラスに出現した単語を含む
文書が出現した場合，その文書は，その単語をもつ小さなクラスに割り当てられることになる．

また，文書数の少ないクラスでは，新規文書に出現した単語がそのクラスに含まれていない割合が多くなり，データがスパースになりやすい．

そこで，学習する文書数のばらつきを抑え，スパースネス問題を緩和するようNBを改良したのが\citeA{Rennie}のCNBである．
具体的には，「クラス$c$に属す訓練事例」ではなく「クラス$c$に属さない訓練事例」
すなわち「$\bar{c}$に属する訓練事例（補集合）」を用いて学習を行う\footnote{Rennieらは文献の中でCNBのほかに5種類のヒューリスティックを導入しているが，本研究では純粋に式の変更による違いを見るため，ヒューリスティックは使用しなかった．}．

\begin{figure}[b]
\begin{center}
\includegraphics{20-2ia4f1.eps}
\end{center}
\caption{NBとCNBでの学習に用いる文書数の違い}
\label{Fig:コンプ文書数変化}
\end{figure}

図\ref{Fig:コンプ文書数変化}は，NBとCNBでの学習に用いる文書数の違いを表している．
文書数10，10，20，40の4つのクラスがある場合，NBではこの文書数を自身のクラスの学習に使う．
そのため，文書数が最も少ないクラスと最も多いクラスでは学習に使用する文書数に4倍の差がある．

一方，CNBでは自身のクラスに属する文書以外の文書から学習を行うため，
学習に用いる文書数は最小のもので40，最大のもので70となり，NBに比べてばらつきが小さくなる．

CNBは，文書内にある単語の出現確率の積から尤度を計算し，分類するクラスを決めるという点ではNBと同じである．
つまり，式(\ref{eq:rnb})を用いて文書$d$の属するクラス$\hat{c}$を推定する．
しかし，CNBでは$P(w_i|c)$を最尤推定で求めるのではなく，$c$以外のクラス$\bar{c}$の尤度の積から推定する．
つまり，$d$の属するクラス$\hat{c}$は最終的に以下の式で求められる．
\begin{equation}
\hat{c}=\argmax_{c} P(c) \prod_{i=1}^{n} \frac{1}{P(w_i|\bar{c})} \label{eq:cnb}
\end{equation}


\subsection{Negation Naive Bayes分類器}
\label{Sec:Negation Naive Bayes分類器}

前節で説明したCNBは，NBの持つ「クラス間の文書数のばらつきによって分類結果が偏る」という特徴を緩和する手法である．
しかし，CNBはヒューリスティックによる解決法であって，事後
確率最大化の式から導出することはできない．

そこで本研究では，事後確率最大化の式から導出でき，かつ，CNBの「訓練にクラスの補集合を
利用する」という長所をもつ分類器を作成する．
以下でNBと同様の，事後確率最大化の式（式
(\ref{eq:bayes})）からの式の変形について述べる．

まず，事後確率$P(c|d)$を最大化するクラス$\hat{c}$を求める式を補集合を利用するように変形する．
\begin{equation}
\begin{aligned}[b]
\hat{c}  & = \argmax_{c} P(c|d) \\
  & =  \argmax_{c} (1-P(\bar{c}|d)) \\
  & =  \argmin_{c} P(\bar{c}|d) 
\end{aligned}
\label{eq:eqnnb1}
\end{equation}
次に，Bayesの定理を用いて式(\ref{eq:eqnnb1})を変形する．
\begin{equation}
\begin{aligned}[b]
 \hat{c} & =  \argmin_{c} \frac{P(\bar{c})P(d|\bar{c})} {P(d)} \\
   & =  \argmin_{c} P(\bar{c})P(d|\bar{c}) 
\end{aligned}
\label{eq:eqnnb2}
\end{equation}

そして，式(\ref{eq:eqnnb2})を近似する．$P(d|\bar{c})$は式(\ref{eq:bayes2})，(\ref{eq:bayes3})と同様に
\begin{equation}
P(d|\bar{c})\approx\prod_{i=1}^{n} P(w_i|\bar{c}) \label{eq:eqnnb3}
\end{equation}
と近似される．
したがって，文書$d$の属するクラス$\hat{c}$を以下の式で推定する．
\begin{equation}
\hat{c} =\argmin_{c} P(\bar{c}) \prod_{i=1}^{n} P(w_i|\bar{c}) \label{eq:nnb}
\end{equation}

なお，$P(\bar{c})=1-P(c)$であり，CNBと同じく最大化で表現すると以下の式になる．
\begin{equation}
\hat{c} =\argmax_{c} \frac{1}{1-P(c)} \prod_{i=1}^{n} \frac{1}{P(w_i|\bar{c})} \label{eq:nnb2}
\end{equation}

式 (\ref{eq:cnb}) と比較すると，$\frac{1}{1-P(c)}$の最大化の部分，つまり事前確率$P(c)$の部分が異なっていることが分かる．
式(\ref{eq:nnb2})は事後確率最大化の式から求められたため，事前確率を数学的に正しく考慮し
た式となっている．なお，Rennie らの研究では，式(\ref{eq:cnb})において事前確率の扱いについてあま
り注意を払っていないが，我々はクラスごとに単語数の偏りが大きいデータセットについて分
類を行う場合には，$P(c)$を利用するか$\frac{1}{1-P(c)}$を利用するかの影響は必ずしも無視して良いとは
言えないと考える．また，Rennieらの研究では，$P(c)$は$P(w_i|\bar{c})$に比べて分類結果への影響が
小さいと判断し，事前確率は計算してもしなくても結果は同じと考え，実際の分類には$P(c)$を
無視して$P(w_i|\bar{c})$のみを計算しているため，P(c)なしのCNBについても参考として実験を行う．



結果 \label{Sec:結果}

\tabref{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率}と\tabref{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}に
全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率のマイクロ平
均とマクロ平均をそれぞれ示し，
\tabref{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率}と\tabref{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}に
名詞だけを使用したオークションのカテゴリ分類実験の分類正解率のマイクロ平均とマクロ平均をそれぞれ示す．
また，\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率}と\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率（マクロ）}に
ニュースグループの分類実験において，一文書あたりの単語数を減らした実験の分類正解率のマイクロ平均
とマクロ平均をそれぞれ示し，
\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率}と\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率（マクロ）}に
同分類実験において，クラスごとの文書数を不均一にした実験の分類正解率のマイクロ平均とマクロ平均をそれぞれ示す．
なお，正解率は，（分類
に成功したもの）／（実験データ数）として求めた．
同じ文書集合の実験で，NB，CNB，NNBのうちで最も良かった正解率を太字で示した．さらに，次に良かった正解率との差がカイ二乗検定で有意だったものに関しては
下線を引いた．また，$P(c)$なしのCNBとSVMに関しては，上記の三手法のうち最も良かった手法と同じか，それよりも良いものは太字で示し，
その優劣にかかわらず，差がカイ二乗検定で有意だったものに関しては下線を引いた．
さらに，参考として最頻出カテゴリ（クラス）を答えた場合の正解率も併記した．

\begin{table}[b]
\caption{全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率（マイクロ平均）}
\label{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率}
\input{04table06.txt}
\end{table}
\begin{table}[b]
\caption{全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率（マクロ平均）}
\label{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}
\input{04table07.txt}
\end{table}


\begin{table}[p]
\caption{名詞だけを使用したオークションのカテゴリ分類実験の分類正解率（マイクロ平均）}
\label{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率}
\input{04table08.txt}
\end{table}
\begin{table}[p]
\caption{名詞だけを使用したオークションのカテゴリ分類実験の分類正解率（マクロ平均）}
\label{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}
\input{04table09.txt}
\end{table}
\begin{table}[p]
\hangcaption{ニュースグループの分類実験において一文書あたりの単語数を減らした実験の分類正解率{\break}（マイクロ平均）}
\label{Tab:一文書あたりの単語数を減らした実験の分類正解率}
\begin{center}
\input{04table10.txt}
\end{table}
\begin{table}[p]
\hangcaption{ニュースグループの分類実験において一文書あたりの単語数を減らした実験の分類正解率{\break}（マクロ平均）}
\label{Tab:一文書あたりの単語数を減らした実験の分類正解率（マクロ）}
\input{04table11.txt}
\end{table}

\tabref{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率}と
\tabref{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率}から，オークションのカテゴリ分類実験において，
マイクロ平均を比較した際，
NNBが常にNBとCNBを有意に上回っていることが分かる．
また同じ二つの表から，NNBが$P(c)$なしのCNBよりも大抵（名詞だけの実験の
「デスクトップ」が例外である）上回っていることが分かる．このうち，「記念切手」の実験では，全単語使用した場合，名詞だけを使用した場合に拘わらず，カイ二乗検定によりその差が有意であった．
しかし，これらの実験において最も良い結果なのはSVMであり，NNBを有意に上回っている．

\begin{table}[t]
\hangcaption{ニュースグループの分類実験においてクラスごとの文書数を不均一にした実験の分類正解率{\break}（マイクロ平均）}
\label{Tab:クラスごとの文書数を不均一にした実験の分類正解率}
\input{04table12.txt}
\end{table}
\begin{table}[t]
\hangcaption{ニュースグループの分類実験においてクラスごとの文書数を不均一にした実験の分類正解率{\break}（マクロ平均）}
\label{Tab:クラスごとの文書数を不均一にした実験の分類正解率（マクロ）}
\input{04table13.txt}
\end{table}

また，\tabref{Tab:全ての品詞を使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}と\tabref{Tab:名詞だけを使用したオークションのカテゴリ分類実験の分類正解率（マクロ）}
から，
オークションのカテゴリ分類実験において，マクロ平均においても，
有意ではないながら，NNBが常にNBとCNBを上回っていることが分かる．また同じ二つの
表から，$P(c)$なしのCNBが有意ではないものの，NNBを上回っていることが分かる．さらに，
SVMは「デスクトップ」と「記念切手」においては有意に，「赤ちゃん用の玩具」では有意
ではないものの，NNBを上回った．

また，\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率}と\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率}から，ニュースグループの分類実験においても，
マイクロ平均で比較した場合，
常にNBBがNBとCNBを上回ることが分かる．ただし，その差が有意なのは，クラスごとの文書数を不均一にした実験（\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率}）
のパラメータが1のときと3のときだけである．
また，これらの実験において，$P(c)$なしのCNBはしばしばNNBを上回っているが，有意に上回っていることは一度もなかった．
さらに\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率}の一文書あたりの単語数を減らした実験では，
パラメータ0，1，2のとき，NNBの分類正解率がSVMを有意に上回っている．しかし，パラメータ3，4のときはSVMが最高であり，NNBと比較してその差は有意であった．
一方，\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率}から，クラスごとの文書数を不均一にした実験では，
全ての実験設定のときにNNBがSVMを上回っている．この差はカイ二乗検定により有意であった．

これに対し，\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率（マクロ）}と\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率（マクロ）}
から，ニュースグループの分類実験において，マクロ平均におい
ても，NNBが常にNBとCNBを上回っていることが分かる．また同じ二つの表から，$P(c)$な
しのCNBがNNBを上回っていることが分かるが，これらの差はいずれも有意ではない．さら
に，\tabref{Tab:一文書あたりの単語数を減らした実験の分類正解率（マクロ）}の一文書あたりの単語数を減らした実験では，
常に有意でないながらもNNBの分類正解率がSVMを上回っている．しかし，パラ
メータ3，4のときは，マイクロ平均と同様にSVMが最高であり，NNBと比較してその差は有
意であった．一方，\tabref{Tab:クラスごとの文書数を不均一にした実験の分類正解率（マクロ）}から，クラスごとの文書数を不均一にした実験では，全ての実験設定
のときにNNBがSVMを上回っている．この差はパラメータ0と1のとき，カイ二乗検定に
より有意であった．



